Fancy.modules.grid=!0,Fancy.Mixin("Fancy.grid.mixin.PrepareConfig",{prepareConfig:function(e,t){var i=this;return e._plugins=e._plugins||[],e.renderOuter&&(e.renderTo=e.renderOuter),e=i.generateColumnsFromData(e,t),e=i.copyColumns(e,t),e=i.prepareConfigScroll(e,t),e=i.prepareConfigData(e,t),e=i.prepareConfigTheme(e,t),e=i.prepareConfigLang(e,t),e=i.prepareConfigSpark(e,t),e=i.prepareConfigPaging(e,t),e=i.prepareConfigInfinite(e,t),e=i.prepareConfigBars(e),e=i.prepareConfigTBar(e),e=i.prepareConfigSubTBar(e),e=i.prepareConfigExpander(e),e=i.prepareConfigColumnMinMaxWidth(e),e=i.prepareConfigGrouping(e),e=i.prepareConfigGroupHeader(e),e=i.prepareConfigSorting(e),e=i.prepareConfigEdit(e),e=i.prepareConfigSelection(e),e=i.prepareConfigLoadMask(e,t),e=i.prepareConfigDefaults(e),e=i.prepareConfigFilter(e,t),e=i.prepareConfigSearch(e),e=i.prepareConfigSummary(e),e=i.prepareConfigState(e,t),e=i.prepareConfigExporter(e),e=i.prepareConfigSmartIndex(e),e=i.prepareConfigActionColumn(e),e=i.prepareConfigWidgetColumn(e),e=i.prepareConfigChart(e,t),e=i.prepareConfigCellTip(e),e=i.prepareConfigHeaderCellTip(e),e=i.prepareConfigColumnsWidth(e),e=i.prepareConfigSize(e,t),e=i.prepareConfigContextMenu(e,t),e=i.prepareConfigColumns(e),e=i.prepareConfigColumnsResizer(e),e=i.prepareConfigFooter(e),e=i.prepareConfigDD(e)},copyColumns:function(e,t){return e.columns&&(e.columns=Fancy.Array.copy(e.columns,!0)),t.columns&&(t.columns=Fancy.Array.copy(t.columns)),e},generateColumnsFromData:function(e,t){if(!e.columns&&e.data&&e.data.length&&Fancy.isArray(e.data[0])){var i=e.data[0]||e.data[0],n=[],r=[];Fancy.each(i,function(e,t){n.push({index:"autoIndex"+t}),r.push("autoIndex"+t)}),e.columns=n,e.data={items:e.data,fields:r},t.data=e.data}return e},prepareConfigScroll:function(e,t){return Fancy.isIE&&!1!==t.nativeScroller&&(e.nativeScroller=!0),e},prepareConfigSpark:function(e){var t=this;return Fancy.each(e.columns,function(i){var n=i.sparkConfig;if(n&&n.legend)switch(n.legend.type){case"tbar":case"bbar":case"buttons":var r=n.legend.type,l=i.index;e[r]=e[r]||[],e[r]=e[r].concat(t._generateLegendBar(n.title,l,n.legend.style,i))}}),e},_generateLegendBar:function(e,t,i,n){for(var r=0,l=e.length,o=[],s=this,a={length:0},d=function(t){var i,n=s;Fancy.each(s.columns,function(e,t){e.index===s.columns[t].index&&(i=t)}),(t.hasCls("fancy-legend-item-disabled")||e.length-1!==a.length)&&(t.toggleCls("fancy-legend-item-disabled"),t.hasCls("fancy-legend-item-disabled")?(a[t.index]=!0,n.disableLegend(i,t.index),a.length++):(n.enableLegend(i,t.index),delete a[t.index],a.length--))};r<l;r++){var c=t[r];Fancy.isString(n.index)&&(c=n.index+"."+r);var h={handler:d,index:c,imageColor:Fancy.COLORS[r],text:e[r]};0===r&&i&&(h.style=i),o.push(h)}return o},prepareConfigData:function(e){if(e.data||(e.data=[]),Fancy.isArray(e.data)&&0===e.data.length&&e.columns){var t=[],i={};Fancy.each(e.columns,function(e){if(e.index)if(/\./.test(e.index)){var n=e.index.split(".");i[n[0]]||(t.push(n[0]),i[n[0]]=!0)}else t.push(e.index||e.key);e.columns&&Fancy.each(e.columns,function(e){e.index&&t.push(e.index||e.key)})}),e.data={fields:t,items:[]}}return e},prepareConfigLoadMask:function(e){var t,i=!1!==e.loadMask;return Fancy.isString(e.loadMask)&&(t=e.loadMask),e._plugins.push({type:"grid.loadmask",showOnWaitingServer:i,loadText:t}),e},reConfigStore:function(e){var t=this.store,i=this.getFieldsFromData(e),n="Fancy.model."+Fancy.id();Fancy.define(n,{extend:Fancy.Model,fields:i}),this.model=n,t.model=n,this.fields=i,t.fields=i,t.setModel()},prepareConfigDefaults:function(e){return e.defaults=e.defaults||{},void 0===e.defaults.type&&(e.defaults.type="string"),Fancy.each(e.defaults,function(t,i){Fancy.each(e.columns,function(t){switch(t.type){case"select":case"order":case"expand":case"rowdrag":return}void 0===t[i]&&(t[i]=e.defaults[i]),"width"===i&&t.flex&&delete t.width})}),e},prepareConfigColumnMinMaxWidth:function(e){return Fancy.each(e.columns,function(e){void 0===e.width&&!e.flex&&e.minWidth&&(e.width=e.minWidth)}),e},prepareConfigCellTip:function(e){return Fancy.each(e.columns,function(t){if(t.cellTip)return e._plugins.push({type:"grid.celltip"}),!0}),e},prepareConfigHeaderCellTip:function(e){return Fancy.each(e.columns,function(t){if(t.headerCellTip)return e._plugins.push({type:"grid.headercelltip"}),!0}),e},prepareConfigDD:function(e){if(e.gridToGrid){var t={type:"grid.dragdrop"};Fancy.apply(t,e.gridToGrid),e._plugins.push(t)}if(e.rowDragDrop){t={type:"grid.rowdragdrop"};Fancy.apply(t,e.rowDragDrop),e._plugins.push(t)}return e},prepareConfigColumns:function(e,t){for(var i=e.columns,n=[],r=[],l=0,o=i.length,s=!1,a=!1,d=!1;l<o;l++){var c=i[l];if(c.draggable&&(s=!0),"tree"===c.type&&(a=!0),"rowdrag"!==c.type&&!c.rowdrag||e.rowDragDrop||(e.rowDragDrop=!0),c.headerCheckBox&&(c.sortable=!1),c.autoHeight&&(d=!0),c.select&&(this.checkboxRowSelection=!0,this.multiSelect=!0,0),!1!==t&&void 0===c.id&&(c.index?c.id=this.getColumnId(c.index):c.id=Fancy.id(null,"col-id-")),!c.title&&c.index&&!Fancy.isArray(c.index))switch(c.type){case"string":case"number":case"currency":case"date":case"combo":case"checkbox":case"text":c.title=Fancy.String.upFirstChar(c.index)}switch(c.type){case"select":this.checkboxRowSelection=!0,this.multiSelect=!0,i[l].index="$selected",i[l].editable=!0,0;break;case"order":i[l].editable=!1,i[l].sortable=!1,i[l].index="$order",i[l].cellAlign="right",0;break;case"rowdrag":i[l].editable=!1,i[l].sortable=!1,i[l].resizable=!1,i[l].width=30,i[l].index="$rowdrag",0;break;case"checkbox":void 0===c.cellAlign&&(c.cellAlign="center");break;case"currency":void 0===c.format&&(c.format="number"),!1!==c.ellipsis&&(c.ellipsis=!0),c.editFormat||(c.editFormat="currency"),c.beforeSaveFormat||(c.beforeSaveFormat="currency");break;case"string":case"number":case"text":case"date":case"combo":case"tree":!1!==c.ellipsis&&(c.ellipsis=!0)}!1!==t&&(c.locked?(n.push(c),i.splice(l,1),l--,o--):c.rightLocked&&(r.push(c),i.splice(l,1),l--,o--))}if(!1===t)return e;if(d&&e._plugins.push({type:"grid.rowheight"}),s&&e._plugins.push({type:"grid.columndrag"}),a){var h={type:"grid.tree"};e.singleExpand&&(h.singleExpand=e.singleExpand),e._plugins.push(h),e.isTreeData=!0}return e.leftColumns=n,e.rightColumns=r,e},prepareConfigColumnsWidth:function(e){var t,i=this,n=e.columns,r=e.width,l=[],o=[],s=100,a=0,d=!1,c=!1,h=!1,u=Fancy.get(e.renderTo||document.body);if((e.width<1||void 0===e.width)&&"body"!==u.prop("tagName").toLocaleLowerCase()&&(h=u.closest(".tab-pane"))&&h.css({display:"block",visibility:"hidden"}),void 0!==r&&"fit"!==r||(r=Fancy.get(e.renderTo||document.body).width()),r-=2*e.panelBorderWidth,!1!==e.flexScrollSensitive)r-=e.bottomScrollHeight;else{var g=this.theme;Fancy.isString(e.theme)?g=e.theme:Fancy.isObject(e.theme)&&e.theme.name&&(g=e.theme.name),"bootstrap-no-borders"!==g&&(r-=1)}Fancy.each(n,function(t,n){switch(t.autoWidth&&(e.autoColumnWidth=!0),t.flex&&(e.hasFlexColumns=!0),t.type){case"select":void 0===t.width&&(t.width=35);break;case"order":void 0===t.width&&(t.width=40);break;case"rowdrag":void 0===t.width&&(t.width=30);break;case"expand":void 0===t.width&&(t.width=38);break;case"combo":t.data||(t.data=[],setTimeout(function(){i.on("init",function(){var e=i.store.getColumnUniqueData(t.index);i.setColumnComboData(t.index,e)})},1))}t.locked&&(d=!0),t.rightLocked&&(c=!0),t.hidden?void 0===t.width&&(t.width=100):void 0===t.width?(t.flex&&(a+=t.flex,o.push(n)),l.push(n)):Fancy.isNumber(t.width)&&(r-=t.width)}),e.hasFlexColumns&&e._plugins.push({type:"grid.columnresizer"}),d&&c&&(r-=2);var f=parseInt(r/l.length);f<50&&(f=50),f>100&&(s=100),f<50&&(s=50);var p=!1,m=r;if(Fancy.each(l,function(e){void 0===(t=n[e]).flex&&(m-=s)}),a){var v=parseInt(m/a);Fancy.each(o,function(e){m-=v*n[e].flex})}return m<0&&(p=!0),Fancy.each(l,function(e){void 0===(t=n[e]).flex&&(t.width=s,r-=s)}),a&&(Fancy.each(o,function(e){(t=n[e]).width=p?s*t.flex:r/a*t.flex,t.width=parseInt(t.width),t.minWidth&&t.width<t.minWidth&&(t.width=t.minWidth)}),m>=1&&Fancy.each(o,function(e){if(m<1)return!0;(t=n[e]).width+=1,m-=1})),h&&h.css({display:"",visibility:""}),e},prepareConfigActionRender:function(e){return function(t){return Fancy.each(e.items,function(e){var i=e.text||"",n=Fancy.styleToString(e.style),r=e.cls||"";t.value+=['<div class="fancy-grid-column-action-item '+r+'" style="'+n+'">',i,"</div>"].join(" "),e.render&&(t=e.render(t))}),t}},prepareConfigSmartIndex:function(e){return Fancy.each(e.columns,function(e){if(/\+|\-|\/|\*|\[|\./.test(e.index)){var t=e.index;switch(t){case"xAxis.categories":case"yAxis.categories":case"zAxis.categories":return}t="return "+(t=t.replace(/(\w+)/g,function(e,t,i,n){return"."===n[i-1]?t:isNaN(Number(t))?"data."+t:t}))+";",e.smartIndexFn=new Function("data",t)}}),e},prepareConfigActionColumn:function(e){for(var t=this,i=e.columns,n=0,r=i.length;n<r;n++){var l=i[n];if("action"===l.type){l.sortable=!1,l.editable=!1,l.render=t.prepareConfigActionRender(l);var o=l.items;if(void 0!==o&&0!==o.length)for(var s,a=0,d=o.length;a<d;a++)switch((s=o[a]).action){case"remove":void 0===s.handler&&(s.handler=function(e,t){e.remove(t)});break;case"dialog":!function(e){if(void 0===e.handler){for(var n=[],r=0,l=i.length,o=87;r<l;r++){var s=i[r];switch(s.type){case"action":continue}n.push({label:s.title||"",type:s.type,name:s.index}),o+=38}e.handler=function(i,r){e.dialog?(e.dialog.show(),e.dialog.set(r.data)):e.dialog=new FancyForm({window:!0,draggable:!0,modal:!0,title:{text:"Edit",tools:[{text:"Close",handler:function(){this.hide()}}]},width:300,height:o,items:n,buttons:["side",{text:"Clear",handler:function(){this.clear()}},{text:"Save",handler:function(){var e=this.get();e.id&&(t.getById(e.id).set(e),t.update())}}],events:[{init:function(){this.show(),this.set(r.data)}}]})}}}(s)}}}return e},prepareConfigWidgetColumn:function(e){for(var t=this,i=e.columns,n=0,r=i.length;n<r;n++){var l=i[n];l.widget&&(l.render=function(e){var i,n=e.cell.select("."+Fancy.FIELD_CLS),r=e.cell.dom,l={vtype:(o=e.column).vtype,style:{padding:"0px","margin-top":"-10px","margin-left":"-1px"},label:!1,renderTo:r,value:e.value,emptyText:o.emptyText};if(n.length)(i=Fancy.getWidget(n.dom.id)).get()!=e.value&&i.set(e.value);else{var o,s=e.column.width,a=(o=e.column).index;switch(e.column.type){case"number":case"currency":Fancy.apply(l,{spin:o.spin,min:o.min,max:o.max,events:[{change:function(i,n){t.set(e.rowIndex,a,n),t.updater.updateRow()}}]}),i=new Fancy.NumberField(l);break;case"string":case"image":Fancy.apply(l,{events:[{change:function(i,n){t.set(e.rowIndex,a,n),t.updater.updateRow()}}]}),i=new Fancy.StringField(l);break;case"combo":Fancy.apply(l,{displayKey:e.column.displayKey,valueKey:e.column.displayKey,padding:!1,checkValidOnTyping:!0,data:e.column.data,events:[{change:function(i,n){t.set(e.rowIndex,a,n),t.updater.updateRow()}}]}),i=new Fancy.Combo(l)}switch(e.column.type){case"number":case"string":case"currency":case"image":i.setInputSize({width:s+1,height:33});break;case"combo":i.size({width:s+1,height:33})}}return e})}return e},prepareConfigSorting:function(e){return(e.defaults||{}).sortable?(e._plugins.push({type:"grid.sorter"}),e):(Fancy.each(e.columns,function(t){t.sortable&&e._plugins.push({type:"grid.sorter"})}),e)},prepareConfigSelection:function(e){var t=!1,i={type:"grid.selection"},n=!1;if((e.trackOver||e.columnTrackOver||e.cellTrackOver)&&(t=!0),e.selModel){t=!0;var r=!1,l=!1,o=!1,s=!0,a=!1,d=!0,c=!1,h=!1,u=!1,g=!1,f=!1,p=!1,m=!1;if(Fancy.isObject(e.selModel)){r=!!e.selModel.checkOnly,m=!!e.selModel.activeCell,("cell"===e.selModel.type||"cells"===e.selModel.type||m)&&(e.selModel.selectBottomCellAfterEdit&&(c=!0),e.selModel.selectRightCellOnEnd&&(h=!0),e.selModel.selectLeftCellOnLeftEnd&&(u=!0),e.selModel.selectUpCellOnUp&&(g=!0),e.selModel.selectBottomCellOnDown&&(f=!0),e.selModel.continueEditOnEnter&&(p=e.selModel.continueEditOnEnter));var v=!1,C=!1;if(Fancy.each(e.columns,function(e){"tree"===e.type&&(v=!0),e.select&&(C=!0),"select"===e.type&&(C=!0)}),v&&C&&(r=!0),!e.selModel.type)throw new Error("[FancyGrid Error 5]: Type for selection is not set");void 0!==e.selModel.mouseMoveSelection&&(d=e.selModel.mouseMoveSelection),l=!0===e.selModel.memory,e.selModel.disabled&&(n=!0),e.selModel.selectLeafsOnly&&(o=!0),void 0!==e.selModel.allowDeselect&&(a=!0),void 0!==e.selModel.keyNavigation&&(s=e.selModel.keyNavigation),e.selModel=e.selModel.type}"rows"===e.selModel&&(e.multiSelect=!0),e.selection=e.selection||{},e.selection.selModel=e.selModel,e.selection[e.selModel]=!0,e.selection.checkOnly=r,e.selection.memory=l,e.selection.memoryPerformance=!0,e.selection.disabled=n,e.selection.selectLeafsOnly=o,e.selection.keyNavigation=s,e.selection.allowDeselect=a,e.selection.mouseMoveSelection=d,e.selection.selectBottomCellAfterEdit=c,e.selection.selectRightCellOnEnd=h,e.selection.selectLeftCellOnLeftEnd=u,e.selection.selectUpCellOnUp=g,e.selection.selectBottomCellOnDown=f,e.selection.continueEditOnEnter=p,e.selection.activeCell=m}return e.selection&&(t=!0,Fancy.isObject(e.selection)&&Fancy.apply(i,e.selection)),!0===t&&e._plugins.push(i),e},prepareConfigEdit:function(e){var t=e.defaults||{},i={type:"grid.edit"},n=!1,r=t.editable;return void 0!==e.clicksToEdit&&(i.clicksToEdit=e.clicksToEdit),r&&(n||e._plugins.push(i),e._plugins.push({type:"grid.celledit"}),n=!0),e.rowEdit&&e._plugins.push({type:"grid.rowedit"}),Fancy.each(e.columns,function(t){switch(void 0===t.index&&void 0===t.key&&(t.editable=!1),t.type){case"image":t.sortable=!1;break;case"sparklineline":case"sparklinebar":case"sparklinetristate":case"sparklinediscrete":case"sparklinebullet":case"sparklinepie":case"sparklinebox":t.editable=!1,t.sortable=!1}t.editable&&!1===n&&(e._plugins.push(i),e._plugins.push({type:"grid.celledit"}))}),e},prepareConfigExpander:function(e){if(e.expander){var t=e.expander;Fancy.apply(t,{type:"grid.expander"}),e.expanded={},e.grouping&&(t.expanded=!1),e._plugins.push(t)}return e},prepareConfigGrouping:function(e){if(e.grouping){var t=e.grouping;!0===t&&(t={}),Fancy.apply(t,{type:"grid.grouping"}),e.expanded={},e._plugins.push(t)}return e},prepareConfigSummary:function(e){if(e.summary){var t=e.summary;!0===t&&(t={}),Fancy.apply(t,{type:"grid.summary"}),e._plugins.push(t)}return e},prepareConfigContextMenu:function(e){if(e.contextmenu){var t=e.contextmenu;Fancy.isArray(e.contextmenu)&&Fancy.each(e.contextmenu,function(t){"export"===t&&(e.exporter=!0)}),!0===t&&(t={}),Fancy.isArray(t)&&(t={items:t}),Fancy.apply(t,{type:"grid.contextmenu"}),e._plugins.push(t)}return e},prepareConfigExporter:function(e){if(e.exporter){var t=e.exporter;!0===t&&(t={}),Fancy.apply(t,{type:"grid.exporter"}),e._plugins.push(t)}return e},prepareConfigFilter:function(e){var t=e.columns,i=!1,n=!1,r=!1,l={type:"grid.filter"};return e.filter&&(!0===e.filter&&(i=!0,e.filter={}),Fancy.apply(l,e.filter)),Fancy.each(t,function(e){e.filter&&(i=!0,e.filter.header&&(n=!0,e.grouping&&(r=!0)))}),l.header=n,l.groupHeader=r,i&&(e._plugins.push(l),e.filterable=!0),e},prepareConfigSearch:function(e){var t={type:"grid.search"},i=!1;return e.searching&&(i=!0,Fancy.apply(t,e.searching)),i&&e._plugins.push(t),e},prepareConfigGroupHeader:function(e){var t=e.columns,i=0,n=t.length,r=[],l=!1,o=[];if(Fancy.each(t,function(e){e.columns&&(l=!0,r.push(e))}),l){for(i=0;i<n;i++){var s=t[i];if(s.columns){for(var a=0,d=s.columns.length,c=s.text||s.title||"  ";a<d;a++)s.locked&&(s.columns[a].locked=!0),s.rightLocked&&(s.columns[a].rightLocked=!0),s.columns[a].grouping=c,s.defaults&&(Fancy.applyIf(s.columns[a],s.defaults),s.defaults.width&&s.columns[a].flex&&delete s.columns[a].width);o=o.concat(s.columns)}else o=o.concat(t.slice(i,i+1))}var h={};Fancy.each(r,function(e){h[e.title||e.text||""]=e}),e.columns=o,e._plugins.push({type:"grid.groupheader",groups:r,groupsMap:h}),e.isGroupedHeader=!0}return e},prepareConfigPaging:function(e,t){var i=e.lang,n=e.paging,r="bbar",l="last";if(!n)return e;if(void 0!==n.barType)switch(n.barType){case"bbar":case"tbar":case"both":r=n.barType;break;case!1:case"none":r="none";break;default:throw new Error("[FancyGrid Error]: - not supported bar type for paging")}return n.pageOverFlowType&&(l=n.pageOverFlowType),e._plugins.push({i18n:t.i18n,type:"grid.paging",barType:r,pageOverFlowType:l}),"both"===r?(e.tbar=this.generatePagingBar(n,i),e.bbar=this.generatePagingBar(n,i)):"none"===r||(e[r]=this.generatePagingBar(n,i)),e},prepareConfigInfinite:function(e){return e.infinite?(e.nativeScroller=!1,e._plugins.push({type:"grid.infinite"}),e):e},generatePagingBar:function(e,t){var i=this,n=[],r="fancy-bar-button-disabled",l="material"===i.theme?8:3,o={float:"left","margin-right":"5px","margin-top":l+"px"};if(n.push({imageCls:"fancy-paging-first",disabledCls:r,role:"first",handler:function(){i.paging.firstPage()},style:{float:"left","margin-left":"5px","margin-right":"5px","margin-top":l+"px"}}),n.push({imageCls:"fancy-paging-prev",disabledCls:r,role:"prev",handler:function(){i.paging.prevPage()},style:o}),n.push("|"),n.push({type:"text",text:t.paging.page}),n.push({type:"number",label:!1,padding:!1,style:{float:"left","margin-left":"-1px","margin-right":"8px","margin-top":l+1+"px"},role:"pagenumber",min:1,width:e.inputWidth||30,listeners:[{enter:function(e){0===parseInt(e.getValue())&&e.set(1);var t=parseInt(e.getValue())-1,n=i.paging.setPage(t);t!==n&&e.set(n)}},{up:function(e,t){var n=i.store.pages;(t=Number(t)+1)>n&&(t=n),e.set(t)}},{down:function(e,t){i.store.pages;(t=Number(t)-1)<1&&(t=1),e.set(t)}}]}),n.push({type:"text",text:"",role:"ofText"}),n.push("|"),n.push({imageCls:"fancy-paging-next",disabledCls:r,role:"next",style:o,handler:function(){i.paging.nextPage()}}),n.push({imageCls:"fancy-paging-last",disabledCls:r,role:"last",style:o,handler:function(){i.paging.lastPage()}}),Fancy.isObject(e)&&!0===e.refreshButton&&(n.push("|"),n.push({imageCls:"fancy-paging-refresh",disabledCls:r,role:"refresh",style:o,handler:function(){i.paging.refresh()}})),e&&Fancy.isArray(e.pageSizeData)){for(var s=e.pageSizeData,a=[],d=0,c=s.length,h=0;d<c;d++)a.push({index:d,value:s[d]}),e.pageSize===s[d]&&(h=d);var u=Fancy.Object.copy(o);u["margin-top"]=l+1+"px",n.push({editable:!1,width:50,type:"combo",role:"size",style:u,data:a,displayKey:"value",valueKey:"index",value:h,subSearch:!1,events:[{change:function(e,t){i.scroll(0,0),i.paging.setPageSize(s[t])}},{render:function(e){i.store.on("changepages",function(){var t;i.store.pageSize!==Number(e.input.dom.value)&&(Fancy.each(e.data,function(e){if(e.value===i.store.pageSize)return t=e.index,!0}),void 0!==t&&e.setValue(t,!1))})}}]})}return n.push("side"),n.push({type:"text",role:"info",text:""}),n},prepareConfigState:function(e){var t=this;if(e.stateful){var i={};Fancy.isObject(e.stateful)&&(i=e.stateful);var n=e.state||{},r=e.stateId||this.getStateName(),l=localStorage.getItem(r);if(l||(t.memoryInitialColumns(r,e.columns),e.defaults&&t.memoryInitialDefaults(r,e.defaults)),l&&(t.wasColumnsCodeChanged(r,e.columns)||t.wasDefaultChanged(r,e.defaults))&&(localStorage.clear(r),localStorage.clear(r+"memory-columns"),l=null,t.memoryInitialColumns(r,e.columns),e.defaults&&t.memoryInitialDefaults(r,e.defaults)),l){for(var o in l=JSON.parse(l))Fancy.isString(l[o])&&(l[o]=JSON.parse(l[o]));var s=l.columns;for(var o in s&&(Fancy.each(s,function(t){Fancy.each(t,function(i,n){if("FUNCTION"===i||"OBJECT"===i||"ARRAY"===i){var r=t.index;Fancy.each(e.columns,function(e){if(e.index===r)return t[n]=e[n],!0})}})}),e.columns=s),l)"columns"!==o&&void 0===n[o]&&(n[o]=l[o])}e._plugins.push({type:"grid.state",stateful:!0,startState:n,log:i})}else e.state&&e._plugins.push({type:"grid.state",startState:e.state});return e},prepareConfigColumnsResizer:function(e){if((e.defaults||{}).resizable)return e._plugins.push({type:"grid.columnresizer"}),e;var t=[].concat(e.columns).concat(e.leftColumns).concat(e.rightColumns);return Fancy.each(t,function(t){if(t.resizable||t.autoWidth)return e._plugins.push({type:"grid.columnresizer"}),!0}),e},prepareConfigBars:function(e){var t=function(t){for(var i=0,n=t.length;i<n;i++)switch(t[i].type){case"date":if(!t[i].format){var r=e.lang.date;t[i].format={read:r.read,write:r.write,edit:r.edit}}e.i18n&&(t[i].i18n=e.i18n)}};return t(e.tbar||[]),t(e.subTBar||[]),t(e.bbar||[]),t(e.buttons||[]),e},prepareConfigTBar:function(e){var t=this,i=e.tbar;if(i)for(var n=0,r=i.length;n<r;n++){switch(i[n].type){case"search":e.searching=e.searching||{},e.filter=e.filter||!0;break;case"date":e.i18n&&(i[n].i18n=e.i18n)}switch(i[n].action){case"add":void 0===i[n].handler&&(i[n].handler=function(){t.insert(0,{}),t.scroll(0)});break;case"undo":void 0===i[n].handler&&(i[n].handler=function(){t.undo()});break;case"undoall":void 0===i[n].handler&&(i[n].handler=function(){t.undoAll()});break;case"redo":void 0===i[n].handler&&(i[n].handler=function(){t.redo()});break;case"remove":void 0===i[n].handler&&(i[n].disabled=!0,i[n].handler=function(){Fancy.each(t.getSelection(),function(e){t.remove(e)}),t.selection.clearSelection()},i[n].events=[{render:function(){var e=this;setTimeout(function(){var t=Fancy.getWidget(e.el.parent().parent().parent().select("."+Fancy.GRID_CLS).dom.id);t.on("select",function(){0===t.getSelection().length?e.disable():e.enable()}),t.on("clearselect",function(){e.disable()})},10)}}])}}return e},prepareConfigSubTBar:function(e){var t=e.subTBar;if(t)for(var i=0,n=t.length;i<n;i++)switch(t[i].type){case"search":e.searching=e.searching||{},e.filter=e.filter||!0}return e},prepareConfigChart:function(e){var t=e.data,i=t.chart;return Fancy.isObject(i)&&(i=[i]),t&&t.chart&&(e._plugins.push({type:"grid.chartintegration",chart:i,toChart:!!t.items||!!t.proxy}),Fancy.each(i,function(t){var i=t.type;switch(i){case"highchart":case"highcharts":e._plugins.push({type:"grid.highchart"});break;case void 0:throw new Error("[FancyGrid Error] - type of chart is undefined");default:throw new Error("[FancyGrid Error] - type of chart "+i+" does not exist")}})),e},prepareConfigSize:function(e){var t,i,n,r=this,l=e.renderTo,o=!!(e.title||e.subTitle||e.tbar||e.bbar||e.buttons||e.panel),s=e.panelBodyBorders,a=e.gridWithoutPanelBorders,d=e.gridBorders;if(void 0===e.width){if(l){if(e.responsive=!0,e.responsiveWidth=!0,i=Fancy.get(l),e.width=parseInt(i.width()),e.width<1&&"body"!==i.prop("tagName").toLocaleLowerCase()){var c=i.closest(".tab-pane");c?(c.css({display:"block",visibility:"hidden"}),e.width=parseInt(i.width()),c.css({display:"",visibility:""})):e.width=i.parent().width()}0===e.width&&(e.width=parseInt(i.parent().width()))}}else if("fit"===e.width){var h=0,u=!1;this.fitWidth=!0,Fancy.each(e.columns,function(e){e.hidden||(h+=e.width),e.locked&&(u=!0)}),e.title||e.subTitle?h+=s[1]+s[3]+d[1]+d[3]:h+=a[1]+a[3]+d[1]+d[3],u&&h--,e.width=h}if(void 0===e.height)l&&(e.responsiveHeight=!0,(n=parseInt(i.height()))<50&&(n=parseInt(i.parent().css("height"))),e.height=n);else if("fit"===e.height){var g=1;t=0,Fancy.each(e.columns,function(e){e.grouping&&(g<2&&(g=2),e.filter&&e.filter.header&&g<3&&(g=3)),e.filter&&e.filter.header&&g<2&&(g=2)}),Fancy.isArray(e.data)?t=e.data.length:e.data&&Fancy.isArray(e.data.items)&&(t=e.data.items.length),n=t*e.cellHeight,e.title&&(n+=e.titleHeight),e.tbar&&(n+=e.tbarHeight||e.barHeight),e.tabs&&(n+=e.barHeight),e.bbar&&(n+=r.bbarHeight||e.barHeight),e.buttons&&(n+=e.buttonsHeight||e.barHeight),e.subTBar&&(n+=e.subTBarHeight||e.barHeight),e.footer&&(n+=e.barHeight),!1!==e.header&&(n+=e.cellHeaderHeight*g),n+=o?s[0]+s[2]+d[0]+d[2]:a[0]+a[2]+d[0]+d[2],e.minHeight&&n<e.minHeight&&(n=e.minHeight),e.heightFit=!0,e.height=n}return o&&!e.title&&(e.panelBodyBorders=[0,0,0,0],setTimeout(function(){r.panel&&r.panel.css("border-bottom-width",0)},1)),e},wasDefaultChanged:function(e,t){e+="-memory-defaults";var i=JSON.parse(localStorage.getItem(e));if(!i||!t)return!1;for(var n in i){switch(Fancy.typeOf(i[n])){case"number":case"string":case"boolean":break;default:continue}if(t[n]!==i[n])return!0}for(var n in t){switch(Fancy.typeOf(t[n])){case"number":case"string":case"boolean":break;default:continue}if(void 0===i[n])return!0}return!1},wasColumnsCodeChanged:function(e,t){e+="-memory-columns";var i=JSON.parse(localStorage.getItem(e));if(!i)return!1;if(t.length!==i.length)return!0;var n=!1;return Fancy.each(i,function(e,i){for(var r in e)if(e[r]!==t[i][r]){if("width"===r&&e.autoWidth)continue;return n=!0,!0}}),Fancy.each(t,function(e,t){for(var r in e)switch(Fancy.typeOf(e[r])){case"number":case"string":case"boolean":if(void 0===i[t][r])return n=!0,!0}}),n},memoryInitialDefaults:function(e,t){e+="-memory-defaults";var i={};for(var n in t)switch(Fancy.typeOf(t[n])){case"string":case"number":case"boolean":i[n]=t[n]}localStorage.setItem(e,JSON.stringify(i))},memoryInitialColumns:function(e,t){e+="-memory-columns";var i=[];Fancy.each(t,function(e){var t={};for(var n in e)switch(Fancy.typeOf(e[n])){case"string":case"number":case"boolean":t[n]=e[n]}i.push(t)}),localStorage.setItem(e,JSON.stringify(i))}}),Fancy.Mixin("Fancy.grid.mixin.ActionColumn",{initActionColumnHandler:function(){this.on("cellclick",this.onCellClickColumnAction,this)},onCellClickColumnAction:function(e,t){var i,n,r=t.column,l=r.items;"action"===r.type&&(i=this.getActiveActionColumnItem(t),l&&void 0!==i&&(n=l[i]).handler&&n.handler(this,t))},getActiveActionColumnItem:function(e){for(var t=Fancy.get(e.cell),i=e.e.target,n=t.select("."+Fancy.GRID_COLUMN_ACTION_ITEM_CLS),r=0,l=n.length;r<l;r++)if(n.item(r).within(i))return r}}),function(){var e,t=Fancy,i=t.TOUCH_CLS,n=t.HIDDEN_CLS,r=t.GRID_CLS,l=t.GRID_STATE_SORTED_CLS,o=t.GRID_STATE_FILTERED_CLS,s=t.GRID_CENTER_CLS,a=t.GRID_LEFT_CLS,d=t.GRID_RIGHT_CLS,c=t.GRID_HEADER_CLS,h=t.GRID_BODY_CLS,u=t.PANEL_BODY_INNER_CLS,g=t.GRID_UNSELECTABLE_CLS,f=t.GRID_LEFT_EMPTY_CLS,p=t.GRID_RIGHT_EMPTY_CLS,m=t.GRID_COLUMN_SORT_ASC,v=t.GRID_COLUMN_SORT_DESC,C=t.GRID_ROW_GROUP_CLS,y=t.GRID_ROW_GROUP_COLLAPSED_CLS,w=t.PANEL_CLS,b=t.PANEL_TBAR_CLS,x=t.PANEL_SUB_TBAR_CLS,S=t.PANEL_BBAR_CLS,I=t.PANEL_BUTTONS_CLS,T=t.PANEL_GRID_INSIDE_CLS,E=t.ANIMATE_DURATION;t.GRID_ANIMATION_CLS;t.Mixin("Fancy.grid.mixin.Grid",{tabScrollStep:80,waitingForFilters:!1,tpl:['<div class="'+a+" "+f+'"></div>','<div class="'+s+'"></div>','<div class="'+d+" "+p+'"></div>','<div class="fancy-grid-editors"></div>'],initStore:function(){var e,i,n,r=this,l=r.getFieldsFromData(r.data),o="Fancy.model."+t.id(),s=r.data,a=!1,d=r.state;r.data.items&&(s=r.data.items),e=r.data.remoteSort,i=r.data.remoteFilter,(n=r.data.remotePage)&&(n="server"),t.define(o,{extend:t.Model,fields:l}),r.isGroupable()&&void 0!==r.grouping.collapsed&&(a=r.grouping.collapsed);var c={widget:r,model:o,data:s,paging:r.paging,remoteSort:e,remoteFilter:i,pageType:n,collapsed:a,multiSort:r.multiSort};r.multiSortLimit&&(c.multiSortLimit=r.multiSortLimit),r.infinite&&(c.infinite=!0),d&&d.filters&&(c.filters=d.filters),!0!==r.filterable||c.filters||(c.filters={}),s.pageSize&&(c.pageSize=s.pageSize),r.store=new t.Store(c),r.model=o,r.fields=l},initDebug:function(){t.DEBUG&&(this.panel?this.panel.addCls("fancy-debug"):this.addCls("fancy-debug"))},initTouch:function(){var e=this;t.isTouch&&window.FastClick&&(e.panel?(FastClick.attach(e.panel.el.dom),e.panel.addCls(i)):(FastClick.attach(e.el.dom),e.addCls(i)))},initElements:function(){var e=this;!1!==e.header&&(e.leftHeader=new t.grid.Header({widget:e,side:"left"}),e.header=new t.grid.Header({widget:e,side:"center"}),e.rightHeader=new t.grid.Header({widget:e,side:"right"})),e.leftBody=new t.grid.Body({widget:e,side:"left"}),e.body=new t.grid.Body({widget:e,side:"center"}),e.rightBody=new t.grid.Body({widget:e,side:"right"}),e.leftEl=e.el.select("."+a),e.centerEl=e.el.select("."+s),e.rightEl=e.el.select("."+d)},getFieldsFromData:function(e){var i=e.items||e;if(e.fields)return this.isTreeData&&(e.fields.push("$deep"),e.fields.push("leaf"),e.fields.push("parentId"),e.fields.push("expanded"),e.fields.push("child"),e.fields.push("filteredChild")),e.fields;i||t.error("Data is empty and not set fields of data to build model",4);var n=i[0],r=[];for(var l in n)r.push(l);return this.isTreeData&&(r.push("$deep"),r.push("leaf"),r.push("parentId"),r.push("expanded"),r.push("child")),r},render:function(){var e=this,i=Fancy.get(e.renderTo||document.body),n=t.get(document.createElement("div")),r=e.panelBodyBorders;e.renderOuter&&(n=i),i.dom||t.error("Could not find renderTo element: "+e.renderTo,1),n.addCls(t.cls,e.widgetCls,e.cls),Fancy.loadingStyle&&(e.panel?(e.panel.el.css("opacity",0),e.intervalStyleLoad=setInterval(function(){Fancy.loadingStyle||(clearInterval(e.intervalStyleLoad),e.panel.el.animate({opacity:1,force:!0}))},100)):(n.css("opacity",0),e.intervalStyleLoad=setInterval(function(){Fancy.loadingStyle||(clearInterval(e.intervalStyleLoad),e.el.animate({opacity:1,force:!0}))},100))),n.attr("role","grid"),n.attr("id",e.id),void 0===e.panel&&e.shadow&&n.addCls("fancy-panel-shadow"),!1===e.columnLines&&n.addCls("fancy-grid-disable-column-lines"),!1===e.rowLines&&n.addCls("fancy-grid-disable-row-lines"),"default"===e.theme||e.panel||n.addCls(Fancy.getThemeCSSCls(e.theme)),e.treeFolder&&n.addCls("fancy-grid-tree-folder");var l=0;e.panel&&(l=r[1]+r[3]),n.css({width:e.width-l+"px",height:e.height-0+"px"}),e.initTpl(),n.update(e.tpl.getHTML({})),e.renderOuter?e.el=n:e.el=t.get(i.dom.appendChild(n.dom)),e.setHardBordersWidth(),setTimeout(function(){Fancy.nojQuery&&e.el.addCls(Fancy.GRID_ANIMATION_CLS)},100),e.rendered=!0},setHardBordersWidth:function(){var e=this,t=e.panel?e.gridBorders:e.gridWithoutPanelBorders;e.wrapped&&(t=e.gridBorders),e.css({"border-top-width":t[0],"border-right-width":t[1],"border-bottom-width":t[2],"border-left-width":t[3]})},update:function(e){var t=this;if(!t.store.loading){t.expander&&t.expander.reSet();var i="default";if(e&&e.type&&(i=e.type),t.updater.update(i),t.fire("update"),t.heightFit&&t.fitHeight(),t.setBodysHeight(),t.paging&&t.paging.update(),e&&e.flash){var n=t.store.changed;for(var r in n){var l=n[r],o=t.getRowById(r);if(void 0!==o)for(var s in l)switch(s){case"length":break;default:var a=t.getColumnOrderByKey(s);switch(e.flash){case!0:t.flashCell(o,a.order,a.side);break;case"plusminus":t.flashCell(o,a.order,a.side,{type:"plusminus",delta:l[s].value-l[s].originValue})}}}t.clearDirty()}else t.scroller.update();t._setColumnsAutoWidth()}},lightStartUpdate:function(){var e=this;e.rowheight&&e.rowheight.onUpdate(),e.bugFixReFreshChartColumns("left"),e.bugFixReFreshChartColumns("center"),e.bugFixReFreshChartColumns("right")},bugFixReFreshChartColumns:function(e){var i=this.getBody(e),n=this.getColumns(e);t.each(n,function(e,t){switch(e.type){case"grossloss":i.renderGrossLoss(t);break;case"hbar":i.renderHBar(t)}})},getColumnsWidth:function(e){switch(e){case"center":case void 0:return this.getCenterFullWidth();case"left":return this.getLeftFullWidth();case"right":return this.getRightFullWidth()}},setSides:function(){var e=this,t=e.leftColumns,i=e.rightColumns,n=e.getLeftFullWidth(),r=e.getCenterFullWidth(),l=e.getRightFullWidth(),o=e.gridBorders,u=e.panelBodyBorders,g=e.gridWithoutPanelBorders;t.length>0&&e.leftEl.removeCls(f),i.length>0&&e.rightEl.removeCls(p),r=e.wrapped?e.width-o[1]-o[3]:e.panel?e.width-o[1]-o[3]-u[1]-u[3]:e.width-g[1]-g[3],0===n&&0===l||(0===l?r-=n:0===n?r-=l:e.width>n+r+l?r-=n:r-=n+l),e.leftEl.css({width:n+"px"}),e.centerEl.css({left:n+"px",width:r+"px"}),e.header&&(e.el.select("."+a+" ."+c).css({width:n+"px"}),e.el.select("."+s+" ."+c).css({width:r+"px"})),e.el.select("."+s+" ."+h).css({width:r+"px"}),e.width>n+r+l?e.rightEl.css({right:"0px"}):e.rightEl.css({left:"",right:"0px"}),e.rightEl.css({width:l}),e.header&&e.el.select("."+d+" ."+c).css({width:l+"px"}),e.startWidths={center:r,left:n,right:l}},setColumnsPosition:function(){this.body.setColumnsPosition(),this.leftBody.setColumnsPosition(),this.rightBody.setColumnsPosition()},setSidesHeight:function(e){var t=this,i=t.store,n=1,r=t.cellHeaderHeight;!1!==t.header&&(n+=r,t.filter&&t.filter.header&&(t.groupheader?t.filter.groupHeader&&(n+=r):n+=r),t.groupheader&&(t.filter&&t.filter.header,n+=r)),t.isGroupable()&&(n+=t.grouping.groups.length*t.groupRowHeight),t.expander&&(n+=t.expander.plusHeight),t.summary&&(n+=t.summary.topOffSet),t.rowheight&&t.rowheight.totalHeight&&(e=t.rowheight.totalHeight),n+=e||i.getLength()*t.cellHeight-1,t.paging&&t.summary&&"bottom"===t.summary.position&&(n=t.height),t.leftEl.css({height:n+"px"}),t.centerEl.css({height:n+"px"}),t.rightEl.css({height:n+"px"})},setBodysHeight:function(){this.body.setHeight(),this.leftBody.setHeight(),this.rightBody.setHeight()},preRender:function(){var e=this;(e.title||e.subTitle||e.tbar||e.bbar||e.buttons||e.panel)&&e.renderPanel()},renderPanel:function(){var e=this,i={renderTo:e.renderTo,renderOuter:e.renderOuter,title:e.title,subTitle:e.subTitle,width:e.width,height:e.height,titleHeight:e.titleHeight,subTitleHeight:e.subTitleHeight,barHeight:e.barHeight,subTBarHeight:e.subTBarHeight||e.barHeight,tbarHeight:e.tbarHeight||e.barHeight,bbarHeight:e.bbarHeight||e.barHeight,buttonsHeight:e.buttonsHeight||e.barHeight,theme:e.theme,shadow:e.shadow,style:e.style||{},window:e.window,modal:e.modal,frame:e.frame,items:[e],draggable:e.draggable,resizable:e.resizable,minWidth:e.minWidth,minHeight:e.minHeight,panelBodyBorders:e.panelBodyBorders,barContainer:e.barContainer,barScrollEnabled:e.barScrollEnabled,tabScrollStep:e.tabScrollStep},n=e.panelBodyBorders;e.bbar&&(i.bbar=e.bbar,e.bbarHidden?i.bbarHidden=!0:e.height-=e.bbarHeight||e.barHeight),e.tbar&&(i.tbar=e.tbar,e.tbarHidden?i.tbarHidden=!0:e.height-=e.tbarHeight||e.barHeight),e.subTBar&&(i.subTBar=e.subTBar,e.subTBarHidden?i.subTBarHidden=!0:e.height-=e.subTBarHeight||e.barHeight),e.buttons&&(i.buttons=e.buttons,e.buttonsHidden?i.buttonsHidden=!0:e.height-=e.buttonsHeight||e.barHeight),e.footer&&(i.footer=e.footer,e.height-=e.barHeight),e.panel=new t.Panel(i),e.bbar=e.panel.bbar,e.tbar=e.panel.tbar,e.subTBar=e.panel.subTBar,e.buttons=e.panel.buttons,e.wrapped||e.panel.addCls(T),e.title&&(e.height-=e.titleHeight),e.subTitle&&(e.height-=e.subTitleHeight,e.height+=n[2]),e.height-=n[0]+n[2],e.renderTo=e.panel.el.select("."+u).dom,e.resizable&&e.panel.on("resize",function(){e.setBodysHeight()})},getBodyHeight:function(){var e=this,t=e.height,i=1,n=e.gridBorders,r=e.gridWithoutPanelBorders;return e.groupheader&&(i=2),e.filter&&e.filter.header&&(e.groupheader?(e.filter.groupHeader&&!e.subHeaderFilter&&i++,e.subHeaderFilter&&(t-=e.cellHeight)):e.subHeaderFilter?t-=e.cellHeight:i++),!1!==e.header&&(t-=e.cellHeaderHeight*i),e.panel?t-=n[0]+n[2]:t-=r[0]+r[2],e.summary&&(t-=e.summary.topOffSet,t-=e.summary.bottomOffSet),t},ons:function(){var e=this,i=e.store,n=t.get(document);i.on("set",e.onSetStore,e),i.on("insert",e.onInsertStore,e),i.on("remove",e.onRemoveStore,e),i.on("beforesort",e.onBeforeSortStore,e),i.on("sort",e.onSortStore,e),i.on("beforeload",e.onBeforeLoadStore,e),i.on("load",e.onLoadStore,e),n.on("mouseup",e.onDocMouseUp,e),n.on("click",e.onDocClick,e),n.on("mousemove",e.onDocMove,e),i.on("servererror",e.onServerError,e),i.on("serversuccess",e.onServerSuccess,e),e.responsive&&e.once("render",e.initResponsiveness,e),e.on("activate",e.onActivate,e),e.on("deactivate",e.onDeActivate,e),e.on("filter",e.onFilter,e),e.on("sort",e.onSort,e)},onServerError:function(e,t,i,n){this.fire("servererror",t,i,n)},onServerSuccess:function(e,t,i){this.fire("serversuccess",t,i)},onBeforeLoadStore:function(){this.fire("beforeload")},onRemoveStore:function(e,t,i){this.fire("remove",t,i)},onInsertStore:function(e,t){this.fire("insert",t)},onLoadStore:function(){var e=this;setTimeout(function(){e.fire("load"),e.stateIsWaiting||(e.UPDATING_AFTER_LOAD=!0,e.store.changeDataView({reSort:!0}),e.update(),e.setSidesHeight(),delete e.UPDATING_AFTER_LOAD)},1)},onSetStore:function(e,t){this.fire("set",t),this.fire("change",t)},onBeforeSortStore:function(e,t){this.fire("beforesort",t)},onSortStore:function(e,t){this.fire("sort",t)},getCellsViewHeight:function(){var e=this,t=e.store,i=0,r=0;return e.isGroupable()&&(e.grouping.calcPlusScroll(),i+=e.grouping.plusScroll),e.expander&&(i+=e.expander.plusScroll),!e.scroller.scrollBottomEl||e.scroller.scrollBottomEl.hasCls(n)||(r=e.scroller.cornerSize),(e.rowheight?e.rowheight.totalHeight:e.cellHeight*t.dataView.length)+r+i},onDocMouseUp:function(){this.fire("docmouseup")},onDocClick:function(e){this.fire("docclick",e)},onDocMove:function(e){this.fire("docmove",e)},getCenterViewWidth:function(){var e=this.centerEl.width();if(0===e){for(var t=0,i=this.columns,n=0,r=i.length;n<r;n++){var l=i[n];l.hidden||(t+=l.width)}return t}return e},getCenterFullWidth:function(){for(var e=0,t=this.columns,i=0,n=t.length;i<n;i++){var r=t[i];r.hidden||(e+=r.width)}return e},getLeftFullWidth:function(){for(var e=0,t=this.leftColumns,i=0,n=t.length;i<n;i++){var r=t[i];r.hidden||(e+=r.width)}return e},getRightFullWidth:function(){for(var e=0,t=this.rightColumns,i=0,n=t.length;i<n;i++){var r=t[i];r.hidden||(e+=r.width)}return e},getColumns:function(e){var t=this,i=[];switch(e){case"left":i=t.leftColumns;break;case"center":i=t.columns;break;case"right":i=t.rightColumns;break;case void 0:i=i.concat(t.leftColumns).concat(t.columns).concat(t.rightColumns)}return i},setColumnsLinksToSide:function(e,t){switch(t){case"left":this.leftColumns=e;break;case"center":case void 0:this.columns=e;break;case"right":this.rightColumns=e}},getBody:function(e){var t;switch(e){case"left":t=this.leftBody;break;case"center":t=this.body;break;case"right":t=this.rightBody}return t},getHeader:function(e){var t;switch(e){case"left":t=this.leftHeader;break;case"center":t=this.header;break;case"right":t=this.rightHeader}return t},getHeaderCell:function(e,i){var n,r;if(t.isString(e)){var l=this.getColumnOrderByKey(e);if(!(r=this.getHeader(l.side)))return;n=r.getCell(l.order)}else{if(i=i||"center",!(r=this.getHeader(i)))return;n=r.getCell(e)}return n},getDomRow:function(e){for(var t=this,i=t.leftBody,n=t.body,r=t.rightBody,l=t.leftColumns,o=t.columns,s=t.rightColumns,a=0,d=l.length,c=[];a<d;a++)c.push(i.getDomCell(e,a));for(a=0,d=o.length;a<d;a++)c.push(n.getDomCell(e,a));for(a=0,d=s.length;a<d;a++)c.push(r.getDomCell(e,a));return c},initTextSelection:function(){!1===this.textSelection&&this.addCls(g)},setTrackOver:function(e,t){switch(e){case"cell":this.cellTrackOver=t;break;case"column":this.columnTrackOver=t;break;case"row":this.trackOver=t}},setSelModel:function(e){var t=this.selection;t.cell=!1,t.cells=!1,t.row=!1,t.rows=!1,t.column=!1,t.columns=!1,t[e]=!0,t.selModel=e,this.multiSelect="rows"===e,t.clearSelection()},getSelection:function(e){return this.selection.getSelection(e)},selectCell:function(e){return this.selection.selectCell(e)},selectCellLeft:function(){return this.selection.moveLeft()},selectCellRight:function(){return this.selection.moveRight()},selectCellDown:function(){return this.selection.moveDown()},selectCellUp:function(){return this.selection.moveUp()},clearSelection:function(){var e=this.selection;e&&e.clearSelection()},destroy:function(e){var i=this,n=i.store,r=t.get(document);r.un("mouseup",i.onDocMouseUp,i),r.un("click",i.onDocClick,i),r.un("mousemove",i.onDocMove,i),i.el&&i.el.dom&&(i.body.destroy(),i.leftBody.destroy(),i.rightBody.destroy(),i.header.destroy(),i.leftHeader.destroy(),i.rightHeader.destroy(),i.scroller.destroy(),!1===e?i.panel?Fancy.each(i.panel.el.child(),function(e){e.destroy()}):Fancy.each(i.el.child(),function(e){e.destroy()}):(i.el.destroy(),i.panel&&i.panel.el.destroy())),n.destroy(),i.responsiveOverver&&i.responsiveOverver.stop&&(i.responsiveOverver.stop(),delete i.responsiveOverver)},clearData:function(){this.setData([]),this.update(),this.scroller.update()},showAt:function(){this.panel&&this.panel.showAt.apply(this.panel,arguments)},show:function(){var e=this;setTimeout(function(){e.panel?e.panel.show.apply(e.panel,arguments):e.el.show()},30)},hide:function(){var e=this;if(e.panel?e.panel.hide.apply(e.panel,arguments):e.el.hide(),e.celledit){var t=e.celledit.activeEditor;t&&t.hide()}},initDateColumn:function(){var e=this,i=function(i){for(var n=0,r=i.length;n<r;n++){var l=i[n];if("date"===l.type){l.format=l.format||{};var o={type:"date"};t.applyIf(o,e.lang.date),t.applyIf(l.format,o)}}return i};e.columns=i(e.columns),e.leftColumns=i(e.leftColumns),e.rightColumns=i(e.rightColumns)},stopEditor:function(){this.edit.stopEditor()},getById:function(e){return this.store.getById(e)},get:function(e,t){var i=this.store;return void 0!==t?i.get(e,t):void 0===e?i.get():i.getItem(e)},getRowById:function(e){return this.store.getRow(e)},getTotal:function(){return this.store.getTotal()},getViewTotal:function(){return this.store.getLength()},getDataView:function(){return this.store.getDataView()},getData:function(){return this.store.getData()},selectRow:function(e,t,i){this.selection.selectRow(e,t,i)},deSelectRow:function(e){this.selection.selectRow(e,!1,!0)},selectById:function(e,t,i){this.selection.selectById(e,t,i)},selectColumn:function(e){var t,i,n=this.leftColumns||[],r=this.columns||[],l=this.rightColumns||[],o=function(t){for(var n=0,r=t.length;n<r;n++){if(t[n].index===e)return i=n,!0}return!1};o(n)?t="left":o(r)?t="center":o(l)&&(t="right"),t&&this.selection.selectColumn(i,t)},getColumnByIndex:function(e){for(var t=this.getColumns(),i=0,n=t.length;i<n;i++){var r=t[i];if(r.index===e)return r}},getColumn:function(e){return this.getColumnByIndex(e)},getColumnById:function(e){for(var t=this.getColumns(),i=0,n=t.length;i<n;i++){var r=t[i];if(r.id===e)return r}},getColumnOrderByKey:function(e){var i,n=this.leftColumns||[],r=this.columns||[],l=this.rightColumns||[],o="";return t.each(r,function(t,n){t.index===e&&(o="center",i=n)}),o||(t.each(n,function(t,n){t.index===e&&(o="left",i=n)}),o||t.each(l,function(t,n){t.index===e&&(o="right",i=n)})),{side:o,order:i}},getColumnOrderById:function(e){var i,n=this.leftColumns||[],r=this.columns||[],l=this.rightColumns||[],o="";return t.each(r,function(t,n){t.id===e&&(o="center",i=n)}),o||(t.each(n,function(t,n){t.id===e&&(o="left",i=n)}),o||t.each(l,function(t,n){t.id===e&&(o="right",i=n)})),{side:o,order:i}},load:function(e){this.store.loadData(e)},save:function(){this.store.save()},onWindowResize:function(){var e,i=this,n=i.renderTo;i.panel&&(n=i.panel.renderTo),((e=i.responsive?t.get(n):i.panel?i.panel.el:t.get(n)).hasClass(w)||e.hasClass(r))&&(e=e.parent());var l=e.width();if(void 0!==e.dom){if(0===l&&(l=e.parent().width()),i.responsive?i.setWidth(l):i.fitWidth,i.responsiveHeight){var o=parseInt(e.height());0===o&&(o=parseInt(e.parent().height())),i.setHeight(o)}i.setBodysHeight(),i.updateColumnsWidth(),i.scroller.scrollDelta(0),i.scroller.update()}},updateColumnsWidth:function(){var e=this,t=function(e,t,i){Fancy.each(e,function(e,i){if(!e.hidden&&e.flex)t.getCell(i)})};t(e.columns,e.header),t(e.leftColumns,e.leftHeader),t(e.rightColumns,e.rightHeader)},setWidth:function(e){var t,i=this,n=i.el,r=i.gridBorders,l=i.gridWithoutPanelBorders,o=i.panelBodyBorders,a=i.body,d=i.header,c=function(e){for(var t=0,i=e.length,n=0;t<i;t++){e[t].hidden||(n+=e[t].width)}return n},h=c(i.leftColumns),u=c(i.rightColumns),g=e-h-u-o[1]-o[3];i.wrapped?(t=e,g=e-h-u,g-=r[1]+r[3],i.css({width:t})):i.panel?(g=e-h-u-o[1]-o[3],i.panel.el.width(e),g-=r[1]+r[3],t=e-o[1]-o[3],i.css({width:t})):(g=e-h-u-l[1]-l[3],n.css("width",e)),g<100&&(g=100),n.select("."+s).css("width",g),d.css("width",g),a.css("width",g),i.hasFlexColumns&&(i.reCalcColumnsWidth(),i.columnresizer.updateColumnsWidth()),i.scroller.setScrollBars(),i.fire("changewidth",e)},getWidth:function(){return this.panel?parseInt(this.panel.css("width")):parseInt(this.css("width"))},getHeight:function(){return this.panel?parseInt(this.panel.css("height")):parseInt(this.css("height"))},setHeight:function(e,t){var i=this,n=e,r=i.gridBorders;i.panelBodyBorders;i.panel&&!1!==t&&i.panel.setHeight(e),i.title&&(e-=i.titleHeight),i.subTitle&&(e-=i.subTitleHeight),i.footer&&(e-=i.barHeight),i.bbar&&!i.bbarHidden&&(e-=i.bbarHeight||i.barHeight),i.tbar&&!i.tbarHidden&&(e-=i.tbarHeight||i.barHeight),i.subTBar&&!i.subTBarHidden&&(e-=i.subTBarHeight||i.barHeight),i.buttons&&!i.buttonsHidden&&(e-=i.buttonsHeight||i.barHeight);var l=e;i.header&&(l-=i.cellHeaderHeight,i.groupheader&&(l-=i.cellHeaderHeight)),i.panel?l-=2:l-=r[0]+r[2],i.summary&&(i.summary.el?l-=i.summary.el.dom.clientHeight:l-=i.cellHeight),i.body&&i.body.css("height",l),i.leftBody&&i.leftBody.css("height",l),i.rightBody&&i.rightBody.css("height",l),i.el.css("height",e),i.height=e,i.scroller.update(),i.fire("changeheight",n)},find:function(e,t,i){return this.store.find(e,t,i)},findItem:function(e,t){return this.store.findItem(e,t)},each:function(e,t){this.store.each(e,t)},onActivate:function(){var i=this,n=t.get(document);e&&e.id!==i.id&&e.fire("deactivate"),setTimeout(function(){n.on("click",i.onDeactivateClick,i)},100),e=i},onDeActivate:function(){var e=this,i=t.get(document);e.activated=!1,i.un("click",e.onDeactivateClick,e),e.selection&&e.selection.activeCell&&e.selection.clearActiveCell()},onDeactivateClick:function(e){for(var i=0,n=t.get(e.target);i<20;i++){if(!n.dom)return;if(!n.dom.tagName||"body"===n.dom.tagName.toLocaleLowerCase())return void this.fire("deactivate");if(void 0===n.hasCls)return void this.fire("deactivate");if(n.hasCls(h))return;n=n.parent()}},search:function(e,t){this.searching.search(e,t)},stopSelection:function(){this.selection&&this.selection.stopSelection()},enableSelection:function(e){this.selection&&this.selection.enableSelection(e)},hideColumn:function(e,i,n){var r=this;void 0!==i||t.isArray(i)||t.isArray(e)||(i=e,(e=this.getSideByColumnIndex(i))||((l=r.getColumnOrderById(i)).side||t.error("Column does not exist"),n=r.getColumnById(i),e=l.side));if(void 0===i&&(i=e,e=void 0),t.isArray(i))t.each(i,function(t){e?r.hideColumn(e,t):r.hideColumn(t)});else{if(n){var l=r.getColumnOrderById(n.id);if(e=l.side,n.hidden)return}var o,s=r.getBody(e),a=r.getHeader(e),d=r.getColumns(e),c=0,h=d.length,u=r.centerEl,g=r.leftEl,f=r.leftHeader,p=r.rightEl,m=r.rightHeader;if(n)o=l.order,n.hidden=!0;else if(t.isNumber(i)){if((n=d[i]).hidden)return;o=i,n.hidden=!0}else for(;c<h;c++)if((n=d[c]).index===i){if(n.hidden)return;o=c,n.hidden=!0;break}if(a.hideCell(o),s.hideColumn(o),r.rowedit&&r.rowedit.hideField(o,e),r.leftColumns.length||r.rightColumns.length){var v=r.calcCurrentLeftWidth(),C=r.calcCurrentRightWidth(),y=parseInt(r.el.css("width"))-v-C;r.panel?y-=r.gridBorders[1]+r.gridBorders[3]:y-=r.gridWithoutPanelBorders[1]+r.gridWithoutPanelBorders[3],g.animate({width:v},E),f.el.animate({width:v},E),u.animate({left:v},E),u.animate({width:y},E),r.body.el.animate({width:y},E),r.header.el.animate({width:y},E),p.animate({width:C},E),m.el.animate({width:C},E),0===C&&setTimeout(function(){p.css("display","none")},E)}r.isGroupable()&&r.grouping.updateGroupRows(),"right"!==e&&"left"!==e||(clearInterval(r.intervalScrollUpdate),r.intervalScrollUpdate=setTimeout(function(){r.scroller.update(),delete r.intervalScrollUpdate},E)),r.onWindowResize(),r.fire("columnhide",{column:n,side:e,orderIndex:o})}},showColumn:function(e,i,n){var r=this;void 0!==i||t.isArray(i)||t.isArray(e)||(i=e,(e=this.getSideByColumnIndex(i))||((l=r.getColumnOrderById(i)).side||t.error("Column "+i+" does not exist"),n=r.getColumnById(i),e=l.side));if(void 0===i&&(i=e,e=void 0),t.isArray(i))t.each(i,function(t){e?r.showColumn(e,t):r.showColumn(t)});else{if(n){var l=r.getColumnOrderById(n.id);if(e=l.side,!n.hidden)return}var o,s=r.getBody(e),a=r.getHeader(e),d=r.getColumns(e),c=0,h=d.length,u=r.centerEl,g=r.leftEl,f=r.leftHeader,p=r.rightEl,m=r.rightHeader;if(n)o=l.order,n.hidden=!1;else if(t.isNumber(i)){if(!(n=d[i]).hidden)return;o=i,n.hidden=!1}else for(;c<h;c++)if((n=d[c]).index===i){if(!n.hidden)return;o=c,delete n.hidden;break}if(a.showCell(o,n.width),s.showColumn(o,n.width),r.rowedit&&r.rowedit.showField(o,e),r.leftColumns.length||r.rightColumns.length){var v=r.calcCurrentLeftWidth(),C=r.calcCurrentRightWidth(),y=parseInt(r.el.css("width"))-v-C;r.panel?y-=r.gridBorders[1]+r.gridBorders[3]:y-=r.gridWithoutPanelBorders[1]+r.gridWithoutPanelBorders[3],"none"===p.css("display")&&p.show(),g.animate({width:v},E),f.el.animate({width:v},E),u.animate({left:v},E),u.animate({width:y},E),r.body.el.animate({width:y},E),r.header.el.animate({width:y},E),p.animate({width:C},E),m.el.animate({width:C},E)}r.isGroupable()&&r.grouping.updateGroupRows(),"right"!==e&&"left"!==e||(clearInterval(r.intervalScrollUpdate),r.intervalScrollUpdate=setTimeout(function(){r.scroller.update(),delete r.intervalScrollUpdate},E)),r.onWindowResize(),r.fire("columnshow",{column:n,side:e,orderIndex:o})}},removeColumn:function(e,i){var n,r=this,l=r.leftEl,o=r.leftHeader,s=r.leftBody,a=r.centerEl,d=r.body,c=r.header,h=r.rightEl,u=r.rightBody,g=r.rightHeader;if(void 0===i&&(i="center"),t.isString(e))if((p=r.getColumnOrderById(e)).side)e=p.order,i=p.side;else{var f=r.getColumns(i);t.each(f,function(t,i){if(t.index===e)return e=i,!0}),t.isString(e)&&"center"===i&&(f=r.getColumns("left"),t.each(f,function(t,n){if(t.index===e)return e=n,i="left",!0}),t.isString(e)&&(f=r.getColumns("right"),t.each(f,function(t,n){if(t.index===e)return e=n,i="right",!0}),t.isString(e)&&t.error("Column was not found for method removeColumn",7)))}else if(t.isObject(e)){var p=r.getColumnOrderById(e.id);n=e,e=p.order,i=p.side}switch(i){case"left":n=r.leftColumns[e],r.leftColumns.splice(e,1),o.removeCell(e),s.removeColumn(e),l.css("width",parseInt(l.css("width"))-n.width),a.css("left",parseInt(a.css("left"))-n.width),a.css("width",parseInt(a.css("width"))+n.width),d.css("width",parseInt(d.css("width"))+n.width),c.css("width",parseInt(c.css("width"))+n.width),0===r.leftColumns.length&&r.leftEl.addCls(Fancy.GRID_LEFT_EMPTY_CLS);break;case"center":n=r.columns[e],r.columns.splice(e,1),c.removeCell(e),d.removeColumn(e);break;case"right":var m=0;n=r.rightColumns[e],r.rightColumns.splice(e,1),g.removeCell(e),u.removeColumn(e),h.css("width",parseInt(h.css("width"))-n.width),a.css("width",parseInt(a.css("width"))+n.width),c.css("width",parseInt(c.css("width"))+n.width),0===r.rightColumns.length&&(r.rightEl.addCls(Fancy.GRID_RIGHT_EMPTY_CLS),t.nojQuery&&(m=2)),d.css("width",parseInt(d.css("width"))+n.width-m)}return n.grouping&&delete n.grouping,r.summary&&r.summary.removeColumn(e,i),r.fire("columnremove"),clearInterval(r.removeColumnScrollInt),r.removeColumnScrollInt=setTimeout(function(){delete r.removeColumnScrollInt,r.scroller.update()},Fancy.ANIMATE_DURATION),n.index===n.id?delete r.columnsIdsSeed[n.index]:new RegExp(n.index).test(n.id)&&(1===r.columnsIdsSeed[n.index]?delete r.columnsIdsSeed[n.index]:r.columnsIdsSeed[n.index]--),n},insertColumn:function(e,i,n,r){var l=this,o=l.store,s=l.leftEl,a=l.leftBody,d=l.leftHeader,c=l.centerEl,h=l.body,u=l.header,g=l.rightEl,m=l.rightBody,v=l.rightHeader,C=0;switch(e.index&&o.addField(e.index),n=n||"center"){case"center":delete e.rightLocked,delete e.locked,l.columns.splice(i,0,e),u.insertCell(i,e),h.insertColumn(i,e);break;case"left":e.locked=!0,C=0;var y=0,w=0;0===l.leftColumns.length?(t.nojQuery||(C=1,w=2),l.leftEl.removeCls(f)):w=2,t.nojQuery||(y=0);var b=s.dom.clientWidth+e.width+w;b-parseInt(s.css("width"))-e.width<-10&&(b=parseInt(s.css("width"))+e.width),l.leftColumns.splice(i,0,e),d.insertCell(i,e),d.css("width",parseInt(d.css("width"))+y),a.insertColumn(i,e),s.css("width",b),c.css("width",parseInt(c.css("width"))-e.width),c.css("left",parseInt(c.css("left"))+e.width+C),h.el.css("width",parseInt(h.el.css("width"))-e.width),u.el.css("width",parseInt(u.el.css("width"))-e.width);break;case"right":e.rightLocked=!0;w=0;0===l.rightColumns.length&&(t.nojQuery||(C=1,w=2),l.rightEl.removeCls(p)),l.rightColumns.splice(i,0,e),v.insertCell(i,e),m.insertColumn(i,e),g.css("width",parseInt(g.css("width"))+e.width),c.css("width",parseInt(c.css("width"))-e.width-C),h.css("width",parseInt(h.css("width"))-e.width-w),u.css("width",parseInt(u.css("width"))-e.width-w)}if(e.menu)if(e._menu)e.menu=e._menu;else{var x=!0;t.each(e.menu,function(e){t.isString(e)||t.isObject(e)&&e._isConfigApplied&&(x=!1)}),x||(e.menu=!0)}if(l.isGroupable()){switch(n){case"left":1===l.leftColumns.length&&l.grouping.softRenderGroupedRows("left");break;case"right":1===l.rightColumns.length&&l.grouping.softRenderGroupedRows("right")}l.grouping.updateGroupRows(),l.grouping.setCellsPosition(i,n)}e.rowEditor&&("left"===n&&i--,l.rowedit.moveEditor(e,i,n,r)),l.summary&&l.summary.insertColumn(i,n),l.header.destroyMenus(),l.leftHeader.destroyMenus(),l.rightHeader.destroyMenus(),l.sorter&&l.sorter.updateSortedHeader(),l.filter&&(clearInterval(l.intFilterFieldsUpdate),l.intFilterFieldsUpdate=setTimeout(function(){l.filter.updateFields(),delete l.intFilterFieldsUpdate},t.ANIMATE_DURATION))},addColumn:function(e,t,i,n){var r=this;!1!==n?setTimeout(function(){r._addColumn(e,t,i)},1):r._addColumn(e,t,i)},_addColumn:function(e,i,n){var r=this;(i=i||"center",e.type||(e.type="string"),e.width||(e.width=r.defaultColumnWidth),void 0===n)&&(n=r.getColumns(i).length);void 0===e.id&&(e.index&&!{$selected:!0,$order:!0,$rowdrag:!0}[e.index]?e.id=r.getColumnId(e.index):e.id=Fancy.id(null,"col-id-")),r.defaults&&t.applyIf(e,r.defaults),r.insertColumn(e,n,i),r.scroller.update(),r.fire("columnadd")},disableLegend:function(e,t){this.columns[e].disabled=this.columns[e].disabled||{},this.columns[e].disabled[t]=!0,this.update()},enableLegend:function(e,t){this.columns[e].disabled=this.columns[e].disabled||{},delete this.columns[e].disabled[t],this.update()},fitHeight:function(){var e=this,t=e.store,i=e.panelBodyBorders,n=e.gridBorders,r=t.getLength()*e.cellHeight,l=1,o=e.columns.concat(e.leftColumns||[]).concat(e.rightColumns||[]);Fancy.each(o,function(e){e.grouping&&(l<2&&(l=2),e.filter&&e.filter.header&&l<3&&(l=3)),e.filter&&e.filter.header&&l<2&&(l=2)}),e.getCenterFullWidth()>e.getCenterViewWidth()&&!e.nativeScroller&&!Fancy.isIE&&(r+=e.bottomScrollHeight),e.title&&(r+=e.titleHeight),e.tbar&&(r+=e.tbarHeight||e.barHeight),e.summary&&(r+=e.cellHeight),e.bbar&&(r+=e.bbarHeight||e.barHeight),e.buttons&&(r+=e.buttonsHeight||e.barHeight),e.subTBar&&(r+=e.subTBarHeight||e.barHeight),e.footer&&(r+=e.barHeight),!1!==e.header&&(r+=e.cellHeaderHeight*l),e.isGroupable()&&(r+=e.grouping.groups.length*e.groupRowHeight),e.panel?r+=i[0]+i[2]+n[0]+n[2]:r+=n[0]+n[2],e.setHeight(r)},addFilter:function(e,i,n,r){var l=this,o=l.store.filters[e],s=!1===l.waitingForFilters;if(t.isFunction(i)&&(n="fn"),n=n||"",void 0===o&&(o={}),t.isDate(i)){var a=this.getColumnByIndex(e).format;o.type="date",o.format=a,i=Number(i)}o[n]=i,l.store.filters[e]=o,s&&(clearInterval(l.intervalUpdatingFilter),l.intervalUpdatingFilter=setTimeout(function(){l.WAIT_FOR_STATE_TO_LOAD?l.filter.updateStoreFilters(!1):l.filter.updateStoreFilters(),delete l.intervalUpdatingFilter},1)),!1!==r?l.filter.addValuesInColumnFields(e,i,n):l.searching},clearFilter:function(e,i,n){var r=this,l=r.store,o=!1===r.waitingForFilters;null==e?l.filters={}:null==i?l.filters&&l.filters[e]&&delete l.filters[e]:r.filter&&l.filters&&l.filters[e]&&void 0!==l.filters[e][i]&&(delete l.filters[e][i],t.Object.isEmpty(l.filters[e])&&delete l.filters[e]),t.Object.isEmpty(l.filter)&&(delete l.filteredData,delete l.filterOrder,delete l.filteredDataMap),r.searching&&void 0===e&&void 0===i&&(r.searching.clearBarField(),r.search(""),r.expander&&r.expander.reSet()),o&&(clearInterval(r.intervalUpdatingFilter),r.intervalUpdatingFilter=setTimeout(function(){if(l.remoteFilter)return l.once("serversuccess",function(){r.fire("filter",l.filters),delete r.intervalUpdatingFilter}),void l.serverFilter();if(l.grouping&&l.grouping.by){var e=r.grouping;l.isFiltered()?(l.changeDataView(),e.initGroups("filteredData")):e.initGroups(),e.reFreshExpanded(),e.initOrder(),l.changeDataView(),e.updateGroupRows(),e.setCellsPosition(),e.setPositions(),e.reFreshGroupTexts(),e.update()}else l.changeDataView();l.grouping&&l.grouping.by||r.update(),r.setSidesHeight(),delete r.intervalUpdatingFilter},100)),r.filter&&!1!==n&&r.filter.clearColumnsFields(e,i),o&&(r.fire("filter",l.filters),r.setSidesHeight())},updateFilters:function(){delete this.waitingForFilters,this.filter.updateStoreFilters()},updateFilter:function(){this.updateFilters()},showLoadMask:function(e){this.loadmask.show(e)},clearSorter:function(){this.sorter&&this.sorter.clearSort()},hideLoadMask:function(){this.loadmask.hide()},prevPage:function(){this.paging.prevPage()},nextPage:function(){this.paging.nextPage()},setPage:function(e,t){--e<0&&(e=0),this.paging.setPage(e,t)},firstPage:function(){this.paging.firstPage()},lastPage:function(){this.paging.lastPage()},setPageSize:function(e){this.paging.setPageSize(e)},getPage:function(){return this.store.showPage+1},getPages:function(){return this.store.pages},getPageSize:function(){return this.store.pageSize},refresh:function(){this.paging.refresh()},scroll:function(e,t,i){var n=this.scroller;void 0!==t&&t>0&&(t=-t);var r=n.getScrollHeight();e>r&&(e=r,this.nativeScroller&&n.isRightScrollable()&&(e+=17));var l=n.getScrollWidth();Math.abs(t)>l&&(t=-l),!1===n.isBottomScrollable()?t=0:this.nativeScroller&&n.isRightScrollable()&&(t-=17),n.scroll(e,t,i),n.scrollBottomKnob(),n.scrollRightKnob()},getDataFiltered:function(){return this.store.filteredData},reCalcColumnsWidth:function(){var e=this;if(e.hasFlexColumns){var t,i,n=e.scroller,r=e.getCenterViewWidth(),l=e.columns,o=0,s=0,a=l.length,d=r;for(!1!==e.flexScrollSensitive&&n.isRightScrollable()&&!n.nativeScroller&&(d-=e.bottomScrollHeight);s<a;s++)(i=l[s]).hidden||(i.flex?o+=i.flex:d-=i.width);if(0!==o)for(t=d/o,s=0;s<a;s++)(i=l[s]).hidden||i.flex&&(i.width=Math.floor(i.flex*t),i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.minWidth&&i.width<i.minWidth?i.width=i.minWidth:i.width<e.minColumnWidth&&(i.width=e.minColumnWidth))}},getDisplayedData:function(e,i,n,r,l){var o=this,s=o.getViewTotal(),a=[],d=0,c=o.leftColumns,h=o.columns,u=o.rightColumns,g={};l&&(l=this.getSelection()),n&&t.each(n,function(e){g[e]=!0}),e&&(s=o.getTotal());var f=function(e){if(!(void 0===e.index||"$selected"===e.index||e.hidden||r&&!1===e.exportable)){if(/spark/.test(e.type))return!1;switch(e.type){case"select":case"action":case"expand":case"grossloss":case"hbar":case"rowdrag":break;case"order":p.push(d+1);break;default:if(l)var t=(n=l[d])[e.index];else{var n=o.get(d);t=o.get(d,e.index)}e.exportFn&&r?(n&&n.data&&(n=n.data),p.push(e.exportFn({value:t,data:n}).value)):e.render&&!0!==i?(n&&n.data&&(n=n.data),t=e.render({value:t,data:n}).value.replace(/<\/?[^>]+(>|$)/g,""),p.push(t)):l?p.push(t):p.push(o.get(d,e.index))}}};for(l&&(d=0,s=l.length);d<s;d++){var p=[];if(n){var m=o.get(d);if(!m||!g[m.id])continue}t.each(c,f),t.each(h,f),t.each(u,f),a.push(p)}return a},getAllDisplayedData:function(){for(var e=this,i=e.getViewTotal(),n=[],r=0,l=e.leftColumns,o=e.columns,s=e.rightColumns,a=function(t){if(void 0!==t.index&&"$selected"!==t.index&&!t.hidden)switch(t.type){case"order":d.push(r+1);break;default:if(t.render){var i=e.get(r),n=e.get(r,t.index);d.push(t.render({value:n,data:i}).value)}else d.push(e.get(r,t.index))}};r<i;r++){var d=[];t.each(l,a),t.each(o,a),t.each(s,a),n.push(d)}return n},setData:function(e){var t=this,i=t.store;i.isTree?i.initTreeData(e):i.setData(e),i.sorters&&i.reSort(),i.filterOrder&&t.filter.updateStoreFilters(!1),i.clearDirty(),(i.sorters||i.filterOrder)&&i.changeDataView({doNotFired:!0}),t.setSidesHeight(),t.filter&&t.filter.waitForComboData&&t.filter.updateFilterComboData()},exportToExcel:function(e){this.exporter&&this.exporter.exportToExcel(e)},getDataAsCsv:function(e){if(this.exporter)return this.exporter.getDataAsCsv(e)},getDataAsCSV:function(e){return this.getDataAsCsv(e)},exportToCSV:function(e){if(this.exporter)return this.exporter.exportToCSV(e)},exportToCsv:function(e){return this.exportToCSV(e)},disableSelection:function(){this.selection.disableSelection()},setParams:function(e){var i=this.store;i.proxy&&(i.proxy.params=i.proxy.params||{},t.apply(i.proxy.params,e))},setUrl:function(e){var i=this.store;if(t.isString(e)){if(i.proxy&&i.proxy.api)if("rest"===i.proxy.type)for(var n in i.proxy.api)i.proxy.api[n]=e;else i.proxy.api.read=e}else i.proxy&&i.proxy.api&&t.apply(i.proxy.api,e)},getSideByCell:function(e){var t;return this.centerEl.within(e)?t="center":this.leftEl.within(e)?t="left":this.rightEl.within(e)&&(t="right"),t},getSideEl:function(e){switch(e){case"left":return this.leftEl;case"center":return this.centerEl;case"right":return this.rightEl}},addChild:function(e,i){var n=this,r=n.store;if(void 0===i)e.$deep=1,void 0===e.child&&(e.child=[]),n.add(e);else{t.isNumber(e)&&(e=n.getById(e));var l=!1;!0===e.get("leaf")&&(e.set("leaf",!1),e.set("expanded",!0),e.set("child",[]),l=!0);var o=e.get("$deep"),s=e.get("child"),a=n.getRowById(e.id)+s.length+1;if(i.$deep=o+1,i.parentId=e.id,l){var d=e.get("parentId");if(d){var c=n.getById(d);t.each(c.data.child,function(t){if(t.id===e.id)return t.leaf=!1,t.expanded=!0,t.child=[i],!0})}}s.push(new r.model(i)),e.set("child",s),!0===e.get("expanded")&&n.insert(a,i)}},expand:function(e,i){var n,r=this;switch(t.typeOf(e)){case"number":case"string":n=r.getById(e)}if(n)if(!0!==n.get("expanded")){if(r.tree&&r.tree.expandRow(n),r.expander){if(i&&this.expander._expandedIds[e])return void this.collapse(e);var l=r.getRowById(e);r.expander.expand(l)}}else i&&this.collapse(e)},toggleExpand:function(e){this.expand(e,!0)},collapse:function(e,i){var n,r=this;switch(t.typeOf(e)){case"number":case"string":n=r.getById(e)}if(!1!==n.get("expanded")){if(r.tree&&r.tree.collapseRow(n),r.expander){var l=!this.expander._expandedIds[e];if(!l&&this.expander._expandedIds[e].hidden&&(l=!0),i&&l)return void this.expand(e);var o=r.getRowById(e);r.expander.collapse(o)}}else i&&this.expand(e)},toggleCollapse:function(e){this.collapse(e,!0)},collapseAll:function(){var e=this;if(e.tree){var i=e.findItem("$deep",1);t.each(i,function(t){e.collapse(t.id)})}else e.expander&&e.expander.collapseAll()},expandAll:function(){var e=this,i=e.findItem("expanded",!1);t.each(i,function(t){e.expand(t.id)}),(i=e.findItem("expanded",!1)).length&&e.expandAll()},copy:function(e){this.selection&&this.selection.copy(e)},sort:function(e,i,n){var r,l,o=this.getColumnByIndex(e),s=this.getColumnOrderByKey(e);if(void 0===n&&(n=!0),s.side)if(l=(r=this.getHeader(s.side)).getCell(s.order),i){switch(i=i||"ASC",l=r.getCell(s.order),i=i.toLocaleLowerCase()){case"asc":l.removeCls(v),l.addCls(m);break;case"desc":l.removeCls(m),l.addCls(v);break;case"drop":l.removeCls(m),l.removeCls(v);break;default:t.error("sorting type is not right - "+i)}this.sorter.sort(i,e,s.side,o,l,n)}else l.dom.click()},flashRow:function(e){var i=this.getDomRow(e);t.each(i,function(e){(e=t.get(e)).addCls("fancy-grid-cell-flash")}),setTimeout(function(){t.each(i,function(e){(e=t.get(e)).addCls("fancy-grid-cell-animation")})},200),setTimeout(function(){t.each(i,function(e){(e=t.get(e)).removeCls("fancy-grid-cell-flash"),e.removeCls("fancy-grid-cell-animation")})},700)},flashCell:function(e,t,i,n){i=i||"center";var r=this.getBody(i),l=700,o=Fancy.isObject(e)?e:r.getCell(e,t);if(n)switch(n.duration&&(l=n.duration),n.type){case"plusminus":n.delta>0?(o.addCls("fancy-grid-cell-flash-plus"),setTimeout(function(){o.removeCls("fancy-grid-cell-flash-plus"),o.removeCls("fancy-grid-cell-animation")},l)):(o.addCls("fancy-grid-cell-flash-minus"),setTimeout(function(){o.removeCls("fancy-grid-cell-flash-minus"),o.removeCls("fancy-grid-cell-animation")},l))}else o.addCls("fancy-grid-cell-flash"),setTimeout(function(){o.removeCls("fancy-grid-cell-flash"),o.removeCls("fancy-grid-cell-animation")},700);setTimeout(function(){o.addCls("fancy-grid-cell-animation")},200)},scrollToRow:function(e){var t=this.body.getCell(e,0);this.scroller.scrollToCell(t.dom,!1,!0),this.scroller.update(),this.flashRow(e)},getStateSorters:function(){var e={},i=JSON.parse(localStorage.getItem(this.getStateName()));if(i){if(!i.sorters)return{};var n=JSON.parse(i.sorters);return t.each(n,function(t){e[t.key]=t}),e}},getStateName:function(){var e=this.id,t=location.host+"-"+location.pathname;return this.stateId?this.stateId:e+"-"+t},setWidthFit:function(){var e=this,t=e.panelBodyBorders,i=e.gridWithoutPanelBorders,n=e.gridBorders,r=0,l=!1,o=[].concat(e.leftColumns).concat(e.columns).concat(e.rightColumns);Fancy.each(o,function(e){e.hidden||(r+=e.width),e.locked&&(l=!0)}),e.panel?r+=t[1]+t[3]+n[1]+n[3]:r+=i[1]+i[3]+n[1]+n[3],l&&r--,e.setWidth(r)},setColumnTitle:function(e,t,i){i=i||"center";var n,r=this.getHeader(i),l=r.getColumns();Fancy.isString(e)&&(e=this.getColumnOrderByKey(e).order),(n=l[e]).title=t,r.getCell(e).select("."+Fancy.GRID_HEADER_CELL_TEXT_CLS).item(0).update(t),this.fire("columntitlechange",{orderIndex:e,index:n.index,value:t,side:i})},clearDirty:function(){this.store.clearDirty(),this.body.clearDirty(),this.leftBody.clearDirty(),this.rightBody.clearDirty()},isDirty:function(){return this.store.isDirty()},hideBar:function(e){var i,n,r=this;r.barHeight;switch(e){case"tbar":i=b,r.tbarHidden=!0,r.tbarHeight&&r.tbarHeight;break;case"subtbar":i=x,r.subTBarHidden=!0,r.subTBarHeight&&r.subTBarHeight;break;case"bbar":i=S,r.bbarHidden=!0,r.bbarHeight&&r.bbarHeight;break;case"buttons":i=I,r.buttonsHidden=!0,r.buttonsHeight&&r.buttonsHeight;break;default:t.error("Bar does not exist")}if("none"!==(n=r.panel.el.select("."+i)).css("display")){n.hide();var l=parseInt(r.panel.el.css("height"));r.setHeight(l)}},showBar:function(e){var i,n,r=this;r.barHeight;switch(e){case"tbar":i=b,delete r.tbarHidden,r.tbarHeight&&r.tbarHeight;break;case"subtbar":i=x,delete r.subTBarHidden,r.subTBarHeight&&r.subTBarHeight;break;case"bbar":i=S,delete r.bbarHidden,r.bbarHeight&&r.bbarHeight;break;case"buttons":i=I,delete r.buttonsHidden,r.buttonsHeight&&r.buttonsHeight;break;default:t.error("Bar does not exist")}if("none"==(n=r.panel.el.select("."+i)).css("display")){n.show();var l=parseInt(r.panel.el.css("height"));r.setHeight(l)}},initResponsiveness:function(){var e=this,i=function(){e.onWindowResize(),clearInterval(e.intWindowResize),e.intWindowResize=setTimeout(function(){e.onWindowResize(),delete e.intWindowResize,setTimeout(function(){e.onWindowResize()},300)},30)};"ResizeObserver"in window?(setTimeout(function(){var n,r;e.nativeResizeObserver?n=new ResizeObserver(i):(n=new t.ResizeObserver(i),e.responsiveOverver=n),(r=e.panel?e.panel.el.parent().dom:e.el.parent().dom)&&n.observe(r)},100),t.$(window).bind("resize",i)):(setTimeout(function(){var n=new t.ResizeObserver(i),r=e.el.parent().dom;r&&(e.responsiveOverver=n,n.observe(r))},100),t.$(window).bind("resize",i))},getNumOfVisibleCells:function(){var e=this;if(!e.numOfVisibleCells)try{e.numOfVisibleCells=Math.ceil(e.getBodyHeight()/e.cellHeaderHeight)}catch(t){e.numOfVisibleCells=0}return e.numOfVisibleCells},getSideByColumnIndex:function(e){var i;return t.each(this.columns,function(t){t.index===e&&(i="center")}),t.each(this.leftColumns,function(t){t.index===e&&(i="left")}),t.each(this.rightColumns,function(t){t.index===e&&(i="right")}),i},setColumnWidth:function(e,i,n){var r=this;if(n=n||"center",t.isArray(e))t.each(e,function(e){r.setColumnWidth(e.index,e.width,e.side)});else{var l=r.getColumns(n);t.isNumber(e)?l[e].width=i:r.getColumnByIndex(e).width=i}clearInterval(r.intervalUpdateColumnsWidth),r.intervalUpdateColumnsWidth=setTimeout(function(){r.columnresizer&&(r.columnresizer.updateColumnsWidth("all"),delete this.intervalUpdateColumnsWidth,setTimeout(function(){r.scroller.update()},Fancy.ANIMATE_DURATION))},100)},isLoading:function(){return this.store.loading},getChanges:function(){var e=this.store,t={};return t.changed=e.changed,t.removed=e.removed,t.inserted=e.inserted,t},autoSizeColumn:function(e,i,n){var r,l=this;if(t.isBoolean(i)?i=(r=l.getColumnOrderById(e)).side:(r=l.getColumnOrderByKey(e))&&void 0!==r.order||(i=(r=l.getColumnOrderById(e)).side),r&&void 0!==r.order){i=i||r.side;var o,s=l.getBody(i),a=t.get(s.getDomColumn(r.order)),d=a.css("width");if(d>500&&(d=100),a.css("width",""),o=a.dom.offsetWidth+2,n&&n.maxWidth&&n.maxWidth<o?o=n.maxWidth:n&&n.minWidth&&n.minWidth>o?o=n.minWidth:n&&n.maxAutoWidth&&n.maxAutoWidth<o&&(o=n.maxAutoWidth),a.css("width",d),l.header){var c=l.getHeaderCell(r.order,i);d=c.css("width"),c.css("width","");var h=c.dom.offsetWidth+25;c.css("width",d),h>o&&(o=h)}l.setColumnWidth(r.order,o,i)}else t.error("Column index was not found")},autoSizeColumns:function(){var e=this,i=e.getColumns();t.each(i,function(t){e.isServiceColumn(t)||t.id&&e.autoSizeColumn(t.id,!0,t)})},onFilter:function(){this.store.hasFilters()?this.addCls(o):this.removeCls(o)},onSort:function(){var e=this.store;e.sorters&&e.sorters.length?this.addCls(l):this.removeCls(l)},isServiceColumn:function(e){switch(e.type){case"order":case"select":case"expand":case"rowdrag":return!0}return!1},getFilter:function(e,t){if(void 0===e&&void 0===t)return this.store.filters;var i=this.store.filters[e];return void 0===t?i||void 0:i&&i[t]?i[t]:void 0},getSorter:function(e){var i;return void 0!==e?(t.each(this.store.sorters,function(t){if(t.key===e)return i=t,!0}),i):this.store.sorters},setColumnComboData:function(e,i){var n=this.getColumns();t.each(n,function(n){if(n.index===e||n.id===e){if(n.data=i,n.editor&&delete n.editor,n.filterField){var r=[];t.isObject(i[0])?r=i:t.each(i,function(e,t){r.push({value:t,text:e})}),n.filterField.setData(r)}if(n.rowEditor){r=[];t.isObject(i[0])?r=i:t.each(i,function(e,t){r.push({value:t,text:e})}),n.rowEditor.setData(r)}}})},clearGroup:function(){var e=this,t=e.store;t.clearGroup(),e.grouping.clearGroup(),t.changeDataView(),e.update(),e.setSidesHeight(),e.scroller.update()},addGroup:function(e,t){var i=this,n=i.store,r=!i.grouping.by;n.addGroup(e),n.sorters&&n.reSort(),n.filterOrder,i.grouping.addGroup(r),i.setSidesHeight(),t&&i.expandGroup(),i.scroller.update(),i.scroll(0,0)},isGroupable:function(){return this.grouping&&this.grouping.by},expandGroup:function(e){var i=this,n=i.store,r=i.grouping,l=r.groups;e?(i.el.select("."+C+'[group="'+e+'"]').removeCls(y),r.expand(r.by,e)):(t.each(l,function(e){i.el.select("."+C+'[group="'+e+'"]').removeCls(y)}),r.expand(r.by,l)),(n.sorters||n.filterOrder)&&n.changeDataView({doNotFired:!0}),n.filterOrder&&n.grouping&&n.grouping.by&&i.filter.reGroupAccordingToFilters(),r.update()},collapseGroup:function(e){var i=this,n=i.grouping,r=n.groups;e?(i.el.select("."+C+'[group="'+e+'"]').addCls(y),n.collapse(n.by,e)):t.each(r,function(e){i.el.select("."+C+'[group="'+e+'"]').addCls(y),n.collapse(n.by,e)}),n.update()},calcCurrentLeftWidth:function(){var e=this.getColumns("left"),i=0;return t.each(e,function(e){e.hidden||(i+=e.width)}),i},calcCurrentRightWidth:function(){var e=this.getColumns("right"),i=0;return t.each(e,function(e){e.hidden||(i+=e.width)}),i},setColumns:function(e){var t=this;e=Fancy.Array.copy(e,!0),e=t.prepareConfigColumnMinMaxWidth({columns:e}).columns,t.defaults&&(e=t.prepareConfigDefaults({defaults:t.defaults,columns:e}).columns),t.refreshcolumns.setColumns(e),t._setColumnsAutoWidth(),setTimeout(function(){Fancy.each(["left","center","right"],function(e){var i=t.getHeader(e),n=t.getBody(e);i.reSetColumnsAlign(),i.reSetColumnsCls(),n.reSetColumnsAlign(),n.reSetColumnsCls(),n.reSetIndexes()})},1)}}),t.ResizeObserver=function(e){this.fn=e},t.ResizeObserver.prototype.observe=function(e){this.el=e,this.init()},t.ResizeObserver.prototype.init=function(){var e=this;e.width=e.el.clientWidth,e.height=e.el.clientHeight,e.interval=setInterval(function(){var t=e.el.clientWidth,i=e.el.clientHeight;t===e.width&&i===e.height||(e.fn(),e.width=e.el.clientWidth,e.height=e.el.clientHeight)},100)},t.ResizeObserver.prototype.stop=function(){clearInterval(this.interval),delete this.width,delete this.height}}(),Fancy.define("Fancy.grid.plugin.Updater",{extend:Fancy.Plugin,ptype:"grid.updater",inWidgetName:"updater",constructor:function(e){Fancy.applyConfig(this,e),this.Super("const",arguments)},init:function(){},update:function(e){var t=this.widget;e=e||"",t.leftColumns&&t.leftColumns.length&&t.leftBody.update(e),t.body.update(e),t.rightColumns&&t.rightColumns.length&&t.rightBody.update(e)},updateRow:function(e){var t=this.widget;t.leftBody.updateRows(e),t.body.updateRows(e),t.rightBody.updateRows(e)}}),function(){var e=Fancy,t=e.HIDDEN_CLS,i=e.GRID_COLUMN_CLS,n=e.GRID_CENTER_CLS;e.define("Fancy.grid.plugin.Scroller",{extend:e.Plugin,ptype:"grid.scroller",inWidgetName:"scroller",rightKnobDown:!1,bottomKnobDown:!1,minRightKnobHeight:35,minBottomKnobWidth:35,cornerSize:12,scrollLeft:0,scrollTop:0,constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var t=this,i=t.widget,n=e.getMouseWheelEventName();i.once("render",function(){t.render(),i.leftBody.el.on(n,t.onMouseWheel,t),i.nativeScroller&&(i.leftBody.el.on(n,t.onMouseWheelLeft,t),i.rightBody.el.on(n,t.onMouseWheelRight,t)),i.body.el.on(n,t.onMouseWheel,t),i.rightBody.el.on(n,t.onMouseWheel,t),i.once("init",t.onGridInit,t),i.nativeScroller?(i.body.el.on("scroll",t.onNativeScrollBody,t),i.leftBody.el.on("scroll",t.onNativeScrollLeftBody,t),i.rightBody.el.on("scroll",t.onNativeScrollRightBody,t)):(i.panel&&i.panel.on("resize",t.onPanelResize,t),i.body.el.on("scroll",t.onScrollBodyBugFix,t))}),t.on("render",t.onRender,t),i.store.on("change",t.onChangeStore,t)},destroy:function(){var t=this,i=t.widget,n=i.leftBody,r=i.body,l=i.rightBody,o=e.get(document),s=e.getMouseWheelEventName();o.un("mouseup",t.onMouseUpDoc,t),o.un("mousemove",t.onMouseMoveDoc,t),n.el.un(s,t.onMouseWheel,t),r.el.un(s,t.onMouseWheel,t),l.el.un(s,t.onMouseWheel,t),i.nativeScroller||(t.scrollBottomEl.un("mousedown",t.onMouseDownBottomSpin,t),t.scrollRightEl.un("mousedown",t.onMouseDownRightSpin,t)),e.isTouch&&(n.el.un("touchstart",t.onBodyTouchStart,t),n.el.un("touchmove",t.onBodyTouchMove,t),r.el.un("touchstart",t.onBodyTouchStart,t),r.el.un("touchmove",t.onBodyTouchMove,t),l.el.un("touchstart",t.onBodyTouchStart,t),l.el.un("touchmove",t.onBodyTouchMove,t),o.un("touchend",t.onBodyTouchEnd,t))},onGridInit:function(){var t=this,i=t.widget,n=i.store,r=e.get(document);t.setScrollBars(),r.on("mouseup",t.onMouseUpDoc,t),r.on("mousemove",t.onMouseMoveDoc,t),i.on("columnresize",t.onColumnResize,t),i.on("lockcolumn",t.onLockColumn,t),i.on("rightlockcolumn",t.onRightLockColumn,t),i.on("unlockcolumn",t.onUnLockColumn,t),n.on("changepages",t.onChangePages,t),i.on("columndrag",t.onColumnDrag,t),setTimeout(function(){t.update()},1)},render:function(){var i=this,n=i.widget,r=n.body,l=e.get(document.createElement("div")),o=e.get(document.createElement("div")),s=e.get(document.createElement("div"));n.nativeScroller?n.el.addCls("fancy-grid-native-scroller"):(l.addCls("fancy-scroll-right"),o.addCls("fancy-scroll-bottom",t),l.update(['<div class="fancy-scroll-right-inner"></div>'].join(" ")),l.select(".fancy-scroll-right-inner").css("margin-top",n.knobOffSet),o.update(['<div class="fancy-scroll-bottom-inner"></div>'].join(" ")),e.get(r.el.append(l.dom)),i.scrollRightEl=r.el.select(".fancy-scroll-right"),e.get(r.el.append(o.dom)),i.scrollBottomEl=r.el.select(".fancy-scroll-bottom"),n.doubleHorizontalScroll&&(s.addCls("fancy-scroll-top",t),s.update(['<div class="fancy-scroll-top-inner"></div>'].join(" ")),e.get(r.el.append(s.dom)),i.scrollTopEl=r.el.select(".fancy-scroll-top"))),i.fire("render")},onMouseWheel:function(t){var i,n=this.widget,r=n.store,l=e.getWheelDelta(t.originalEvent||t);if(n.infinite)return t.preventDefault(),(i=l<0?r.infiniteScrolledToRow+1:r.infiniteScrolledToRow-1)>r.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)&&(i=r.getNumOfInfiniteRows()-(n.numOfVisibleCells-1)),i<0&&(i=0),r.infiniteScrolledToRow=i,n.update(),void(n.selection&&n.selection.updateSelection());0!=this.isRightScrollable()&&(n.stopProp&&t.stopPropagation(),n.nativeScroller||(this.scrollDelta(l)&&t.preventDefault(),this.scrollRightKnob()))},onRender:function(){var t=this,i=t.widget;!0!==i.nativeScroller&&(t.scrollRightEl.hover(function(){!0!==t.bottomKnobDown&&t.scrollRightEl.addCls("fancy-scroll-right-hover")},function(){t.scrollRightEl.removeCls("fancy-scroll-right-hover")}),t.scrollBottomEl.hover(function(){!0!==t.rightKnobDown&&t.scrollBottomEl.addCls("fancy-scroll-bottom-hover")},function(){t.scrollBottomEl.removeCls("fancy-scroll-bottom-hover")}),i.doubleHorizontalScroll&&t.scrollTopEl.hover(function(){!0!==t.bottomKnobDown&&t.scrollTopEl.addCls("fancy-scroll-top-hover")},function(){!0!==t.bottomKnobDown&&t.scrollTopEl.removeCls("fancy-scroll-top-hover")}),t.initRightScroll(),t.initBottomScroll()),e.isTouch&&t.initTouch()},initTouch:function(){var t=this,i=t.widget,n=i.leftBody,r=i.body,l=i.rightBody,o=e.get(document);n.el.on("touchstart",t.onBodyTouchStart,t),n.el.on("touchmove",t.onBodyTouchMove,t),r.el.on("touchstart",t.onBodyTouchStart,t),r.el.on("touchmove",t.onBodyTouchMove,t),l.el.on("touchstart",t.onBodyTouchStart,t),l.el.on("touchmove",t.onBodyTouchMove,t),o.on("touchend",t.onBodyTouchEnd,t)},onBodyTouchStart:function(e){e=e.originalEvent||e;var t=this,i=t.widget,n=e.changedTouches[0];i.nativeScroller||(Fancy.nojQuery&&(i.panel?i.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):i.el.removeCls(Fancy.GRID_ANIMATION_CLS)),e.preventDefault(),t.rightKnobDown=!0,t.bottomKnobDown=!0,t.mouseDownXY={x:n.pageX,y:n.pageY},t.rightKnobTop=parseInt(t.rightKnob.css("margin-top")),t.scrollRightEl.addCls("fancy-scroll-right-active"),t.bottomKnobLeft=parseInt(t.bottomKnob.css("margin-left")),t.scrollBottomEl.addCls("fancy-scroll-bottom-active"),i.doubleHorizontalScroll&&t.scrollTopEl.addCls("fancy-scroll-top-active"))},onBodyTouchEnd:function(){var e=this,t=e.widget;if(e.onMouseUpDoc(),!0!==t.nativeScroller&&e.spyOnSwipe){var i=e.spyOnSwipe.swipedX,n=e.spyOnSwipe.swipedY;n&&i?"top"===e.touchScrollDirection?e.swipeTop():"left"===e.touchScrollDirection&&e.swipeLeft():n?e.swipeTop():i&&e.swipeLeft()}delete e.spyOnSwipe,delete e.touchScrollDirection},swipeTop:function(){var e=this.widget,t=this.scrollTop+10*this.spyOnSwipe.swipedY;this.isRightScrollable()&&(t<0&&(t=0),e.scroll(t,!1,!0))},swipeLeft:function(){var e=this.widget,t=this.scrollLeft+10*this.spyOnSwipe.swipedX;this.isBottomScrollable()&&(t<0&&(t=0),e.scroll(!1,t,!0))},onBodyTouchMove:function(t){var i=this,n=i.widget,r=(t=t.originalEvent||t).changedTouches[0],l=!0;if(n.nativeScroller){if(e.isTouch)return;i.onMouseMoveDoc({pageX:r.pageX,pageY:r.pageY})}else{var o=i.scrollLeft,s=i.scrollTop;i.onMouseMoveDoc({pageX:r.pageX,pageY:r.pageY}),l=o!==i.scrollLeft||s!==i.scrollTop,t.preventDefault()}!0===i.rightKnobDown&&l&&t.preventDefault(),!0===i.bottomKnobDown&&l&&t.preventDefault()},initRightScroll:function(){var e=this;e.rightKnob=e.scrollRightEl.select(".fancy-scroll-right-inner"),e.scrollRightEl.on("mousedown",e.onMouseDownRightSpin,e)},initBottomScroll:function(){var e=this,t=e.widget;e.bottomKnob=e.scrollBottomEl.select(".fancy-scroll-bottom-inner"),e.scrollBottomEl.on("mousedown",e.onMouseDownBottomSpin,e),t.doubleHorizontalScroll&&(e.topKnob=e.scrollTopEl.select(".fancy-scroll-top-inner"),e.scrollTopEl.on("mousedown",e.onMouseDownBottomSpin,e))},onMouseDownRightSpin:function(t){var i=this,n=i.widget;e.isTouch||(Fancy.nojQuery&&(n.panel?n.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):n.el.removeCls(Fancy.GRID_ANIMATION_CLS)),t.preventDefault(),i.rightKnobDown=!0,i.mouseDownXY={x:t.pageX,y:t.pageY},i.rightKnobTop=parseInt(i.rightKnob.css("margin-top")),i.scrollRightEl.addCls("fancy-scroll-right-active"))},onMouseDownBottomSpin:function(t){var i=this,n=i.widget,r=e.get(t.target);t.preventDefault(),Fancy.nojQuery&&(n.panel?n.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):n.el.removeCls(Fancy.GRID_ANIMATION_CLS)),i.bottomKnobDown=!0,i.mouseDownXY={x:t.pageX,y:t.pageY},i.bottomKnobLeft=parseInt(i.bottomKnob.css("margin-left")),i.scrollBottomEl.addCls("fancy-scroll-bottom-active"),r.hasClass()&&i.scrollTopEl.addCls("fancy-scroll-top-inner")},onMouseUpDoc:function(){var e=this,t=e.widget;e.mouseDownXY={},delete e.mouseMoveInitXY,!1!==e.rightKnobDown||!1!==e.bottomKnobDown?(Fancy.nojQuery&&t.addCls(Fancy.GRID_ANIMATION_CLS),e.scrollRightEl.removeCls("fancy-scroll-right-active"),e.scrollBottomEl.removeCls("fancy-scroll-bottom-active"),e.rightKnobDown=!1,e.bottomKnobDown=!1,t.doubleHorizontalScroll&&(e.scrollTopEl.removeCls("fancy-scroll-top-active"),e.scrollTopEl.removeCls("fancy-scroll-top-hover"))):t.nativeScroller&&Fancy.nojQuery&&t.addCls(Fancy.GRID_ANIMATION_CLS)},onMouseMoveDoc:function(t){var i,n,r,l,o=this,s=o.widget,a=!1,d=!1,c=s.knobOffSet,h=t.pageX,u=t.pageY;if(!e.isTouch||o.mouseMoveInitXY){if(e.isTouch&&!o.touchScrollDirection){if(i=o.mouseMoveInitXY.x-h,n=o.mouseMoveInitXY.y-u,!o.touchScrollDirection&&Math.abs(n)<5&&Math.abs(i)<5)return;Math.abs(n)>Math.abs(i)?o.touchScrollDirection="top":o.touchScrollDirection="left"}clearInterval(o.scrollInterval),o.spyOnSwipe?(Math.abs(o.spyOnSwipe.x-h)>1?o.spyOnSwipe.swipedX=o.spyOnSwipe.x-h:delete o.spyOnSwipe.swipedX,Math.abs(o.spyOnSwipe.y-u)>1?o.spyOnSwipe.swipedY=o.spyOnSwipe.y-u:delete o.spyOnSwipe.swipedY,o.spyOnSwipe.x=h,o.spyOnSwipe.y=u):o.spyOnSwipe={x:h,y:u},o.scrollInterval=setTimeout(function(){if(o.rightKnobDown&&"left"!==o.touchScrollDirection&&(e.isTouch?(n=o.mouseDownXY.y-u,r=n+Math.ceil(o.rightKnobTop*o.rightScrollScale)):(n=u-o.mouseDownXY.y,r=n+o.rightKnobTop),e.isTouch?o.bodyViewHeight<r/o.rightScrollScale+o.rightKnobHeight&&(r=o.bodyFullViewHeight-o.bodyViewHeight):o.bodyViewHeight<r+o.rightKnobHeight&&(r=o.bodyViewHeight-o.rightKnobHeight),r<0&&(r=0),e.isTouch?(a=r,o.rightKnob.css("margin-top",r/o.rightScrollScale+c+"px")):(a=o.rightScrollScale*r,o.rightKnob.css("margin-top",r+c+"px")),s.doubleHorizontalScroll&&"none"!==o.scrollBottomEl.css("display")&&r<o.cornerSize&&(r=o.cornerSize),s.infinite&&s.selection&&(s.selection.updateSelection(),s.selection.clearActiveCell())),o.bottomKnobDown&&"top"!==o.touchScrollDirection&&(e.isTouch?(i=o.mouseDownXY.x-h,n=o.mouseDownXY.y-u,l=i+Math.ceil(o.bottomKnobLeft*Math.abs(o.bottomScrollScale))):(i=h-o.mouseDownXY.x,n=u-o.mouseDownXY.y,l=i+o.bottomKnobLeft),l<1&&(l=1),e.isTouch?o.bodyViewWidth-2<Math.abs(l/o.bottomScrollScale)+o.bottomKnobWidth&&(l=o.bodyFullViewWidth-o.bodyViewWidth-2):o.bodyViewWidth-2<l+o.bottomKnobWidth&&(l=o.bodyViewWidth-o.bottomKnobWidth-2),o.bottomScrollScale<0&&l<0&&(l=0,o.bottomScrollScale=0),e.isTouch?(d=-l-1,o.bottomKnob.css("margin-left",Math.abs(l/o.bottomScrollScale)+"px")):(d=Math.ceil(o.bottomScrollScale*(l-1)),o.bottomKnob.css("margin-left",l+"px")),s.doubleHorizontalScroll&&o.topKnob.css("margin-left",l+"px")),e.isTouch)switch(o.touchScrollDirection){case"top":o.scroll(a);break;case"left":o.scroll(!1,d)}else!1!==a&&!1!==d?o.scroll(a,d):!1!==a?o.scroll(a):!1!==d&&o.scroll(!1,d)},1)}else o.mouseMoveInitXY={x:h,y:u}},setScrollBars:function(e){var t=this,i=t.widget;i.rowheight&&void 0===e||(setTimeout(function(){t.checkRightScroll(e)},1),t.checkBottomScroll()||t.scrollTop&&!i.infinite&&i.scroll(!1,0),i.nativeScroller||setTimeout(function(){t.checkCorner(),t.setRightKnobSize(e),t.setBottomKnobSize()},1))},checkRightScroll:function(e){var i=this.widget,n=i.body,r=i.gridBorders,l=i.getBodyHeight(),o=(e||i.getCellsViewHeight())-r[0]-r[2];i.nativeScroller?l>=o?n.el.css("overflow-y","hidden"):n.el.css("overflow-y","scroll"):l>=o?this.scrollRightEl.addCls(t):this.scrollRightEl.removeCls(t)},isRightScrollable:function(){var e=this.widget;return e.nativeScroller?"scroll"===e.body.el.css("overflow-y"):!this.scrollRightEl.hasCls(t)},isBottomScrollable:function(){var e=this.widget;return e.nativeScroller?"scroll"===e.body.el.css("overflow-x"):!this.scrollBottomEl.hasCls(t)},setRightKnobSize:function(e){var t=this,i=t.widget;if(!i.nativeScroller){var n=i.getBodyHeight()-(t.corner?t.cornerSize:0)-2,r=(e||i.getCellsViewHeight())-(t.corner?t.cornerSize:0),l=n*((100-(r-n)/(n/100))/100),o=i.knobOffSet;l<t.minRightKnobHeight&&(l=t.minRightKnobHeight,i.doubleHorizontalScroll&&(l+=t.minRightKnobHeight)),!1===t.corner&&(n-=o),t.rightKnob.css({height:l}),t.rightKnobHeight=l,t.bodyViewHeight=n,t.bodyFullViewHeight=r,t.rightScrollScale=(r-n)/(n-l)}},checkBottomScroll:function(){var e,i=this,n=i.widget,r=n.body,l=n.getCenterViewWidth(),o=n.getCenterFullWidth()-2;return n.nativeScroller?l>o?(e=!1,r.el.css("overflow-x","hidden")):(e=!0,r.el.css("overflow-x","scroll")):l>o?(e=!1,i.scrollBottomEl.addCls(t),n.doubleHorizontalScroll&&i.scrollTopEl.addCls(t)):(e=!0,i.scrollBottomEl.removeCls(t),n.doubleHorizontalScroll&&i.scrollTopEl.removeCls(t)),e},checkCorner:function(){this.widget.nativeScroller||(this.corner=!this.scrollRightEl.hasCls(t)&&!this.scrollBottomEl.hasCls(t))},setBottomKnobSize:function(){var t=this,i=t.widget;if(!i.nativeScroller){var n=i.getCenterViewWidth()-(t.corner?t.cornerSize:0),r=i.getCenterFullWidth()-(t.corner?t.cornerSize:0),l=n*((100-(r-n)/(r/100))/100)-2;l<t.minBottomKnobWidth&&(l=t.minBottomKnobWidth),t.bottomKnob.css({width:l}),i.doubleHorizontalScroll&&t.topKnob.css({width:l},e.ANIMATE_DURATION),t.bottomKnobWidth=l,t.bodyViewWidth=n,t.bottomScrollScale=(n-r)/(n-l-2-1),t.bodyFullViewWidth=r}},scroll:function(t,i,n){var r,l=this.widget;if(i>0&&(i=0),l.nativeScroller)return null!=t&&(l.body.el.dom.scrollTop=t),null!=i&&(l.body.el.dom.scrollLeft=Math.abs(i),l.header&&l.header.scroll(i,!0)),void l.fire("scroll");n&&(l.el.addCls("fancy-grid-columns-animation"),setTimeout(function(){l.el.removeCls("fancy-grid-columns-animation")},e.ANIMATE_DURATION+150)),l.leftBody.scroll(t),r=l.body.scroll(t,i,n),l.rightBody.scroll(t),void 0!==r.scrollTop&&(this.scrollTop=Math.abs(r.scrollTop)),void 0!==r.scrollLeft&&(this.scrollLeft=Math.abs(r.scrollLeft)),l.fire("scroll"),e.isTouch&&(l._preventTouchDown=!0)},scrollDelta:function(e){var t,i=this.widget;if(i.leftBody.wheelScroll(e),t=i.body.wheelScroll(e),i.rightBody.wheelScroll(e),void 0!==t)return this.scrollTop=Math.abs(t.newScroll),i.fire("scroll"),t.scrolled},scrollRightKnob:function(){var e=this,t=e.widget,i=(t.store,e.getScroll()/e.rightScrollScale+t.knobOffSet);e.rightKnob&&(t.doubleHorizontalScroll&&(i+=e.cornerSize),t.infinite,e.rightKnob.css("margin-top",i+"px"))},scrollBottomKnob:function(){var e=this,t=e.widget,i=e.getBottomScroll(),n=i/e.bottomScrollScale+t.knobOffSet;0===i&&(n=-1),e.bottomKnob&&(e.bottomKnob.css("margin-left",-n+"px"),t.doubleHorizontalScroll&&e.topKnob.css("margin-left",-n+"px"))},getScroll:function(){var e=this.widget,t=e.store;if(e.nativeScroller)return e.body.el.dom.scrollTop;if(e.infinite)return Math.abs(t.infiniteScrolledToRow*e.cellHeight);if(0===e.columns.length){if(e.leftColumns.length)return Math.abs(parseInt(e.leftBody.el.select("."+i).item(0).css("top")));if(e.rightColumns.length)return Math.abs(parseInt(e.rightBody.el.select("."+i).item(0).css("top")))}var n=e.body.el.select("."+i);return 0===n.length?0:Math.abs(parseInt(n.item(0).css("top")))},getBottomScroll:function(){var e=this.widget;if(e.nativeScroller)return e.body.el.dom.scrollLeft;if(0===e.columns.length){if(e.leftColumns.length)return Math.abs(parseInt(e.leftBody.el.select("."+i).item(0).css("left")));if(e.rightColumns.length)return Math.abs(parseInt(e.rightBody.el.select("."+i).item(0).css("left")))}var t=e.body.el.select("."+i);return 0===t.length?0:Math.abs(parseInt(t.item(0).css("left")))},update:function(e){this.setScrollBars(e),this.checkScroll(e),this.scrollRightKnob(),this.scrollBottomKnob()},onChangeStore:function(){this.update()},onColumnResize:function(){var e=this;e.setScrollBars(),setTimeout(function(){e.setScrollBars()},Fancy.ANIMATE_DURATION+20)},getScrollHeight:function(){var e=this,t=e.widget,i=t.getBodyHeight()-(e.corner?e.cornerSize:0),n=t.getCellsViewHeight()-(e.corner?e.cornerSize:0);return i>n?i:n-i},getScrollWidth:function(){var e=this,t=e.widget,i=t.getCenterViewWidth()-(e.corner?e.cornerSize:0),n=t.getCenterFullWidth()-(e.corner?e.cornerSize:0);return i>n?i:n-i},checkScroll:function(t){var i=this,n=i.widget,r=i.getScroll(),l=n.getBodyHeight()-(i.corner?i.cornerSize:0),o=(t||n.getCellsViewHeight())-(i.corner?i.cornerSize:0),s=n.getCenterFullWidth(),a=n.getCenterViewWidth(),d=i.getScrollTop(),c=i.getScrollLeft();s<c+a?setTimeout(function(){d=i.getScrollTop(),c=i.getScrollLeft();var e=s-(c+a);c+e<0?n.scroll(d,0):n.scroll(d,c+e)},e.nojQuery?10:e.ANIMATE_DURATION):r&&o<l&&(i.scroll(0),n.nativeScroller||i.scrollRightKnob())},scrollToCell:function(t,i,r){if(void 0!==t){var l=this,o=l.widget,s=o.store,a=o.cellHeight,d=e.get(t),c=d.parent(),h=Number(d.attr("index")),u=Number(c.attr("index")),g=l.getScroll(),f=a*(h+1),p=o.getBodyHeight(),m=l.getBottomScroll(),v=o.getSideByCell(t),C=o.getColumnsWidth(v),y=parseInt(o.body.el.css("width")),w=0,b=c.parent().parent().hasCls(n);if(o.rowheight&&(f=o.rowheight.rowIndexesSum[h]),!o.nativeScroller||i){if(o.infinite&&(h+=s.infiniteScrolledToRow,f+=a*s.infiniteScrolledToRow),0===h&&0===u){if(0===l.scrollLeft||"row"!==o.selModel&&"rows"!==o.selModel||o.selection&&o.selection.activeCell)if(o.selection&&o.selection.activeCell)"center"!==o.selection.getActiveCellInfo().side?l.scroll(0):l.scroll(0,0);else l.scroll(0,0);else l.scroll(0);return l.scrollBottomKnob(),void l.scrollRightKnob()}if(0!==h||0===l.scrollTop){if(o.isGroupable()&&(f+=o.grouping.getSpecialRowsAbove(h)*o.groupRowHeight),o.expander&&(f+=o.expander.getBeforeHeight(h)),r){var x=o.getCellsViewHeight();x-(g=f-a)<p&&(g-=Math.abs(x-g-p)),l.scroll(g)}else if(f-g>p){var S=5;o.nativeScroller&&(S=20),g=f-p+S,l.scroll(g)}else f-g<o.cellHeight&&((g=f-a-5)<0&&(g=0),l.scroll(g));if(b){for(var I=o.columns,T=0;T<=u;T++)I[T].hidden||(w+=I[T].width);w-m>y?I[T]?l.scroll(g,-(m+(w-m)-y)):l.scroll(g,-(C-y)):w-m<I[u].width?((m=-(w-I[u].width))>0&&(m=0),l.scroll(g,m)):0!==m&&0===u&&l.scroll(g,0),l.scrollBottomKnob()}l.scrollRightKnob()}else l.scroll(0)}}},onNativeScrollBody:function(){var t=this.widget,i=t.body.el.dom.scrollTop,n=t.body.el.dom.scrollLeft;t.header&&t.header.scroll(-n),t.leftBody&&(t.leftBody.el.dom.scrollTop=i),t.rightBody&&(t.rightBody.el.dom.scrollTop=i),t.leftColumns.length&&t.leftBody.el.dom.scrollTop!==t.body.el.dom.scrollTop?t.body.el.dom.scrollTop=t.leftBody.el.dom.scrollTop:t.rightColumns.length&&t.rightBody.el.dom.scrollTop!==t.body.el.dom.scrollTop&&(t.body.el.dom.scrollTop=t.rightBody.el.dom.scrollTop),Fancy.nojQuery&&(t.panel?t.panel.el.select("."+Fancy.GRID_ANIMATION_CLS).removeCls(Fancy.GRID_ANIMATION_CLS):t.el.removeCls(Fancy.GRID_ANIMATION_CLS)),t.summary&&t.summary.scrollLeft(-n),t.subHeaderFilter&&t.filter.scrollLeft(-n),t.fire("nativescroll"),e.isTouch&&(t._preventTouchDown=!0)},onNativeScrollLeftBody:function(){var e=this.widget;e.leftBody.el.dom.scrollTop!==e.body.el.dom.scrollTop&&this.onNativeScrollBody()},onNativeScrollRightBody:function(){var e=this.widget;e.rightBody.el.dom.scrollTop!==e.body.el.dom.scrollTop&&this.onNativeScrollBody()},onMouseWheelLeft:function(t){var i=this.widget,n=e.getWheelDelta(t.originalEvent||t)*i.cellHeight;i.leftBody.el.dom.scrollTop-=n,i.body.el.dom.scrollTop-=n,i.rightBody.el.dom.scrollTop-=n},onMouseWheelRight:function(t){var i=this.widget,n=e.getWheelDelta(t.originalEvent||t)*i.cellHeight;i.leftBody.el.dom.scrollTop-=n,i.body.el.dom.scrollTop-=n,i.rightBody.el.dom.scrollTop-=n},onLockColumn:function(){var t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(function(){t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION)},onColumnDrag:function(){var t=this;e.nojQuery&&setTimeout(function(){t.update()},e.ANIMATE_DURATION)},onRightLockColumn:function(){var t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(function(){t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION)},onUnLockColumn:function(){var t=this;t.update(),t.widget.setColumnsPosition(),setTimeout(function(){t.update(),t.widget.setColumnsPosition()},e.ANIMATE_DURATION+100)},onPanelResize:function(){this.widget.scroll(0,0)},onChangePages:function(){var e=this;!e.widget.nativeScroller&&e.scrollTop&&setTimeout(function(){e.scrollDelta(0)},1)},onScrollBodyBugFix:function(){var e=this.widget,t=e.body,i=t.el.dom.scrollLeft;t.el.dom.scrollLeft=this.scrollLeft,e.scroll(this.scrollTop,-this.scrollLeft-i)},getScrollTop:function(){var e=this.widget;return e.nativeScroller?e.body.el.dom.scrollTop:this.scrollTop},getScrollLeft:function(){var e=this.widget;return e.nativeScroller?e.body.el.dom.scrollLeft:this.scrollLeft}})}(),function(){var e,t=Fancy,i={title:function(e,t,i,n){e.setColumnTitle(i,t,n)},width:function(e,t,i,n){e.setColumnWidth(i,t,n)},hidden:function(e,t,i,n,r){t?e.hideColumn(r):e.showColumn(r)},render:function(t,i,n,r,l){clearInterval(e),t.getColumnById(l).render=i,e=setTimeout(function(){t.update()},1)}};t.define("Fancy.grid.plugin.RefreshColumn",{extend:t.Plugin,ptype:"grid.refreshcolumns",inWidgetName:"refreshcolumns",constructor:function(){this.Super("const",arguments)},setColumns:function(e){var i=this.widget;this.applyChanges(e),e=i.prepareConfigColumnsWidth({columns:e,width:i.width}).columns,e=i.prepareConfigColumns({columns:e},!1).columns,this.setColumnsByOrder(e),i.filter&&(clearInterval(i.intFilterFieldsUpdate),i.intFilterFieldsUpdate=setTimeout(function(){delete i.intFilterFieldsUpdate,i.filter.updateFields()},t.ANIMATE_DURATION))},applyChanges:function(e){var i={},n=[];t.each(e,function(e){e.id?i[e.id]=e:e.index?i[e.index]=e:n.push(e)}),this.setChangesByIds(i),this.setChangesWithoutIds(n),this.setChangesToNotCheckedColumns(e)},setChangesByIds:function(e){var n=this.widget,r=n.getColumns();for(var l in t.each(r,function(t){!t.id||/col-id-/.test(t.id)||e[t.id]||n.removeColumn(t.id)}),e){var o=n.getColumnById(l),s=n.getColumnOrderById(l),a=e[l];if(o){for(var d in i)void 0!==a[d]&&o[d]!==a[d]&&i[d](n,a[d],s.order,s.side,l);a.$checked=!0,o.$checked=!0}}},setChangesWithoutIds:function(e){var n=this.widget,r=n.getColumns();t.each(e,function(e){if(e.render){var l=[],o=e.render.toString();if(t.each(r,function(e){e.render&&o===e.render.toString()&&l.push(e)}),1===l.length){var s=l[0],a=n.getColumnOrderById(s.id);for(var d in i)void 0!==e[d]&&s[d]!==e[d]&&i[d](n,e[d],a.order,a.side,s.id);e.$checked=!0,s.$checked=!0}}})},setChangesToNotCheckedColumns:function(e){var i=this.widget,n=i.getColumns(),r=[],l={},o={};for(var s in t.each(n,function(e){e.$checked||(r.push(e),l[e.type]=l[e.type]||[],l[e.type].push(e))}),t.each(e,function(e){e.$checked||(o[e.type]=o[e.type]||[],o[e.type].push(e))}),l){var a=l[s];t.each(a,function(e){var i=o[s];t.each(i,function(t){var n=!0;for(var r in t)if(t[r]!==e[r]){n=!1;break}n&&(i.$checked=!0,e.$checked=!0)})})}r=[],t.each(n,function(e){e.$checked||r.push(e)}),t.each(r,function(e){i.removeColumn(e.id)}),t.each(e,function(e){delete e.$checked}),t.each(n,function(e){delete e.$checked})},setColumnsByOrder:function(e){var i=[],n=[],r=[];t.each(e,function(e){e.locked?i.push(e):e.rightLocked?n.push(e):r.push(e)}),this.setColumnsByOrderInSide(r,"center"),this.setColumnsByOrderInSide(i,"left"),this.setColumnsByOrderInSide(n,"right")},setColumnsByOrderInSide:function(e,i){var n=this.widget,r=n.getColumns(i);t.each(e,function(e,t){var l=!0,o=r[t];if(void 0!==o)for(var s in e){if(void 0!==e.id&&e.id===o.id)break;switch(s){case"width":case"hidden":continue}if(e[s]!==o[s]){l=!1;break}}else l=!1;if(!l)if(o&&o.index===e.index)n.removeColumn(o.id),n.addColumn(e,i,t,!1);else if(!e.id){var a=n.getColumnByIndex(e.index);a&&n.removeColumn(a.id),n.addColumn(e,i,t,!1)}})}})}(),Fancy.define("Fancy.grid.plugin.LoadMask",{extend:Fancy.Plugin,ptype:"grid.loadmask",inWidgetName:"loadmask",cls:"fancy-loadmask",innerCls:"fancy-loadmask-inner",imageCls:"fancy-loadmask-image",textCls:"fancy-loadmask-text",constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var e=this,t=e.widget,i=t.store;t.once("render",function(){e.render(),i.loading&&e.onBeforeLoad(),t.on("beforeload",e.onBeforeLoad,e),t.on("load",e.onLoad,e)})},render:function(){var e,t,i=this,n=i.widget,r=n.el,l=Fancy.get(document.createElement("div")),o=n.lang;n.panel&&(r=n.panel.el),e=r.width(),t=r.height(),l.addCls(i.cls),"default"!==n.theme&&l.addCls(Fancy.getThemeCSSCls(n.theme)),l.css({width:e,height:t,opacity:0}),i.loadText?l.update(['<div class="'+i.innerCls+'"><div class="'+i.textCls+'">'+i.loadText+"</div></div>"].join(" ")):l.update(['<div class="'+i.innerCls+'"><div class="'+i.imageCls+'"></div><div class="'+i.textCls+'">'+o.loadingText+"</div></div>"].join(" ")),i.el=Fancy.get(r.dom.appendChild(l.dom)),i.innerEl=i.el.select("."+i.innerCls),i.textEl=i.el.select("."+i.textCls);var s=i.innerEl.width(),a=i.innerEl.height(),d=e/2-s/2;d<10&&(i.intLeft=setInterval(function(){"none"===i.el.css("display")&&clearInterval(i.intLeft),s=i.innerEl.width(),a=i.innerEl.height(),(d=e/2-s/2)<10||(i.innerEl.css({left:d}),clearInterval(i.intLeft))},100)),i.innerEl.css({left:d,top:t/2-a/2}),!0!==n.store.loading?l.css("display","none"):!1===i.showOnWaitingServer?l.css("display","none"):l.css("display","block")},onBeforeLoad:function(){this.showOnWaitingServer&&this.show()},onLoad:function(){var e=this,t=e.widget;e.showOnWaitingServer&&t.once("update",function(){e.hide()})},show:function(e){var t=this,i=t.el,n=t.widget.lang;if(i.stop(),i.css("opacity",1),t.el.css("display","block"),t.updateSize(),e)return t.textEl.update(e),void t.el.css("display","block");t.loaded=!1,setTimeout(function(){!0!==t.loaded&&(t.textEl.update(t.loadText||n.loadingText),t.el.css("display","block"))},50)},hide:function(){var e=this,t=e.el;t.stop(),t.css("opacity",1),t.animate({opacity:0,force:!0},{complete:function(){e.loaded=!0,t.css("display","none")}})},updateSize:function(){var e=this,t=e.widget,i=t.getWidth(),n=t.getHeight();e.el.css({height:n,width:i});var r=i/2-Math.abs(e.innerEl.width())/2,l=n/2-Math.abs(e.innerEl.height())/2;e.innerEl.css({left:r,top:l})}}),function(){var e=Fancy,t=e.get,i=e.FIELD_CLS,n=e.GRID_RESIZER_LEFT_CLS,r=e.GRID_RESIZER_RIGHT_CLS,l=e.GRID_HEADER_CELL_TRIGGER_CLS,o=e.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,s=e.GRID_HEADER_CELL_CLS,a=e.GRID_COLUMN_RESIZER_CLS,d=e.GRID_COLUMN_CLS,c=e.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,h=e.GRID_STATE_RESIZE_COLUMN_CLS,u=e.ANIMATE_DURATION;e.define("Fancy.grid.plugin.ColumnResizer",{extend:e.Plugin,ptype:"grid.columnresizer",inWidgetName:"columnresizer",constructor:function(){this.Super("const",arguments)},init:function(){var e=this,t=e.widget;e.Super("init",arguments),t.header&&t.on("render",function(){e.render(),e.ons()})},ons:function(){var e=this,t=e.widget;t.on("headercellmousemove",e.onCellMouseMove,e),t.on("headercellmousedown",e.onHeaderCellMouseDown,e),t.on("docclick",e.onDocClick,e),t.on("docmove",e.onDocMove,e),t.on("docmouseup",e.onDocMouseUp,e)},onCellMouseMove:function(e,n){var r=this,s=r.widget,a=n.e,d=t(n.cell),c=a.offsetX,h=d.width(),u=t(a.target),g=u.hasCls(l),f=u.hasCls(o),p=d.select("."+l).item(0),m=d.select("."+o).item(0),v=t(a.target).closest("."+i).hasCls(i),C=parseInt(p.css("width")),y=parseInt(m.css("width")),w=h,b=7;if(g&&(w=C),f&&(w=y),!s.startResizing)if(f)r.removeCellResizeCls(n.cell);else if("left"===n.side&&n.index===s.leftColumns.length-1&&w-c<b+2&&(b+=2),!g&&!f&&"right"===n.side&&0===n.index&&c<b)r.isColumnResizable(n)&&(v||r.addCellResizeCls(n.cell));else if(!g&&!f&&c<b&&"center"===n.side&&0===n.index&&s.leftColumns.length)n.side="left",n.index=s.leftColumns.length-1,r.isColumnResizable(n)&&(v||r.addCellResizeCls(n.cell));else if(g||f||!(w-c<b||c<b)||0===n.index)w-c<b?f?y-c>2?r.removeCellResizeCls(n.cell):r.addCellResizeCls(n.cell):r.isColumnResizable(n)&&r.addCellResizeCls(n.cell):r.removeCellResizeCls(n.cell);else{var x=c<b;r.isColumnResizable(n,x)&&(v||r.addCellResizeCls(n.cell))}},addCellResizeCls:function(e){var i=this.widget.columndrag;i&&"dragging"===i.status||(t(e).addCls(a),t(e).select("."+l).addCls(a))},removeCellResizeCls:function(e){t(e).removeClass(a),t(e).select("."+l).item(0).removeClass(a)},onHeaderCellMouseDown:function(n,r){n=r.e;var s=this,a=s.widget,d=t(n.target),c=t(r.cell),h=n.offsetX,u=c.width(),g=c.select("."+i),f=d.hasCls(l),p=d.hasCls(o),m=c.select("."+l).item(0),v=c.select("."+o).item(0),C=parseInt(m.css("width")),y=parseInt(v.css("width")),w=u,b=7;f&&(w=C),p?w=y:g.length>0&&g.item(0).within(d.dom)||("left"===r.side&&r.index===a.leftColumns.length-1&&w-h<b+2&&(b+=2),!f&&!p&&"right"===r.side&&0===r.index&&h<b?(a.startResizing=!0,e.apply(s,{cell:r.cell,activeSide:r.side,clientX:n.clientX,columnIndex:r.index,moveLeftResizer:!0})):h<7&&"center"===r.side&&0===r.index&&a.leftColumns.length?(a.startResizing=!0,r.side="left",r.index=a.leftColumns.length-1,e.apply(s,{cell:s.getCell(r),activeSide:r.side,clientX:n.clientX,columnIndex:r.index})):!f&&!p&&h<b&&0!==r.index?(a.startResizing=!0,e.apply(s,{cell:s.getPrevCell(r),activeSide:r.side,clientX:n.clientX,columnIndex:r.index-1})):w-h<b&&(a.startResizing=!0,e.apply(s,{cell:r.cell,activeSide:r.side,clientX:n.clientX,columnIndex:r.index})),a.startResizing&&s.isColumnResizable())},isColumnResizable:function(e,t){var i,n,r,l=this,o=l.widget;if(e){if(i=o.getColumns(e.side),r=e.index,t&&(n=i[--r],r>0&&i[r].hidden&&r--),isNaN(r))return;return n=i[r],!(0===r&&n.hidden&&("center"!==e.side||!o.leftColumns))&&(!n.hidden&&!0===n.resizable)}!0!==(i=o.getColumns(l.activeSide))[l.columnIndex].resizable&&(o.startResizing=!1,delete l.cell,delete l.activeSide,delete l.clientX,delete l.columnIndex)},getMinColumnWidth:function(){var e,t=this.widget,i=t.minCellWidth;return void 0===this.columnIndex?i:(e=t.getColumns(this.activeSide)[this.columnIndex]).minWidth?e.minWidth:i},getMaxColumnWidth:function(){var e,t=this.widget;return void 0!==this.columnIndex&&(!!(e=t.getColumns(this.activeSide)[this.columnIndex]).maxWidth&&e.maxWidth)},onDocClick:function(){this.widget.startResizing=!1},onDocMove:function(e,t){this.widget.startResizing&&this.moveResizeEls(t)},render:function(){var e=this.widget,i=t(document.createElement("div")),l=t(document.createElement("div"));i.addCls(n),l.addCls(r),this.leftEl=t(e.el.dom.appendChild(i.dom)),this.rightEl=t(e.el.dom.appendChild(l.dom))},moveResizeEls:function(i){var n=this,r=n.widget,l=t(n.cell),o=parseInt(l.css("left")),s=n.getMinColumnWidth(),a=n.getMaxColumnWidth();switch(r.header.hideMenu&&r.header.hideMenu(),r.el.addCls(h),e.get(document.body).addCls(h),n.activeSide){case"left":break;case"center":o+=parseInt(r.leftEl.css("width"));break;case"right":o+=parseInt(r.leftEl.css("width")),o+=parseInt(r.centerEl.css("width"))}var d=i.clientX,c=d-n.clientX,u=l.width()+c;u<s&&(u=s),a&&u>a&&(u=a),n.deltaWidth=l.width()-u,n.moveLeftResizer?(c=d-n.clientX,(u=l.width()-c)<s&&(u=s),n.deltaWidth=l.width()-u,n.leftEl.css({display:"block",left:o+c+"px"}),n.rightEl.css({display:"block",left:o+l.width()-1+"px"})):(n.leftEl.css({display:"block",left:o+"px"}),n.rightEl.css({display:"block",left:o+u+"px"})),n.cellWidth=u},onDocMouseUp:function(){var t=this,i=t.widget;!1!==i.startResizing&&(i.el.removeCls(h),e.get(document.body).removeCls(h),t.leftEl.css({display:"none"}),t.rightEl.css({display:"none"}),t.fixSidesWidth(),i.startResizing=!1,t.moveLeftResizer=!1,delete t.cellWidth,i.scroller.update())},fixSidesWidth:function(){var i,n,r,l,o=this,a=o.widget,h=o.cellWidth,g=o.columnIndex,f=o.deltaWidth,p=a.leftEl,m=a.centerEl,v=a.rightEl,C=a.leftHeader.el,y=a.header.el,w=a.rightHeader.el,b=a.body.el,x={},S={},I=o.minCenterWidth;if(void 0!==h){var T=1;switch(e.nojQuery&&(T=0),o.activeSide){case"left":if((l=parseInt(m.css("width"))+f+T)<I)return;r=a.leftColumns[g],a.leftColumns[o.columnIndex].width=h,i=a.leftBody.el.select("."+d),n=a.leftHeader.el.select("."+s),(k=i.item(g)).animate({width:h},u),k.css("overflow","");for(var E=o.columnIndex+1,L=n.length,R=0,D=E;R<D;R++){(M=(B=n.item(R)).attr("group-index"))&&(S[M]=!0)}for(;E<L;E++){var _=i.item(E),B=n.item(E);_.animate({left:parseInt(_.css("left"))-f-T},u),B.hasCls(c)&&S[B.attr("index")]||B.animate({left:parseInt(B.css("left"))-f-T},u)}p.animate({width:parseInt(p.css("width"))-f-T},u),C.animate({width:parseInt(C.css("width"))-f-T+"px"},u),a.columns.length&&(m.animate({left:parseInt(m.css("left"))-f-T,width:l},u),y.animate({width:parseInt(y.css("width"))+f+T},u),b.animate({width:parseInt(b.css("width"))+f+T},u));break;case"center":r=a.columns[g],a.columns[o.columnIndex].width=h,i=a.body.el.select("."+d),n=a.header.el.select("."+s),(k=i.item(g)).animate({width:h},u),k.css("overflow","");for(E=o.columnIndex+1,L=n.length,R=0,D=E;R<D;R++){(M=(B=n.item(R)).attr("group-index"))&&(S[M]=!0)}for(;E<L;E++){_=i.item(E),B=n.item(E);var F=parseInt(_.css("left"))-f-T,H=parseInt(B.css("left"))-f-T;B.attr("group-index")&&(x[B.attr("group-index")]={}),_.animate({left:F},u),B.hasCls(c)&&S[B.attr("index")]||B.animate({left:H},u)}break;case"right":if((l=parseInt(m.css("width"))+f+T)<I)return;var k;r=a.rightColumns[g],a.rightColumns[o.columnIndex].width=h,i=a.rightBody.el.select("."+d),n=a.rightHeader.el.select("."+s),(k=i.item(g)).animate({width:h+"px"},u),k.css("overflow","");for(E=o.columnIndex+1,L=n.length,R=0,D=E;R<D;R++){var M;(M=(B=n.item(R)).attr("group-index"))&&(S[M]=!0)}for(;E<L;E++){_=i.item(E),B=n.item(E);_.animate({left:parseInt(_.css("left"))-f-T},u),B.hasCls(c)&&S[B.attr("index")]||B.animate({left:parseInt(B.css("left"))-f-T},u)}v.animate({width:parseInt(v.css("width"))-f-T},u),w.animate({width:parseInt(w.css("width"))-f-T+"px"},u),a.columns.length&&(m.animate({width:l},u),y.animate({width:parseInt(y.css("width"))+f+T},u),b.animate({width:parseInt(b.css("width"))+f+T},u))}var O,A=t(o.cell),N=A.attr("group-index");if(A.animate({width:h+"px"},u),N)(O=a.el.select("[index='"+N+"']")).animate({width:parseInt(O.css("width"))-f-T},u);else for(var W in x)(O=a.el.select("[index='"+W+"']")).css("left",parseInt(O.css("left"))-(x[W].delta||0)-T);if(a.fire("columnresize",{cell:A.dom,width:h,column:r,side:o.activeSide}),/sparkline/.test(r.type))switch(o.activeSide){case"left":a.leftBody.updateRows(void 0,g);break;case"center":a.body.updateRows(void 0,g);break;case"right":a.rightBody.updateRows(void 0,g)}else switch(r.type){case"progressbar":case"hbar":a.update()}}},getPrevCell:function(t){var i,n=this.widget;switch(t.side){case"left":i=n.leftHeader;break;case"center":i=n.header;break;case"right":i=n.rightHeader}var r=i.el.select("."+s).item(t.index-1).dom;return"none"===e.get(r).css("display")&&0!==t.index?(t.cell=r,t.index--,this.getPrevCell(t)):r},getCell:function(e){var t,i=this.widget;switch(e.side){case"left":t=i.leftHeader;break;case"center":t=i.header;break;case"right":t=i.rightHeader}return t.el.select("."+s).item(e.index).dom},updateColumnsWidth:function(t){if("all"===t)return this.updateColumnsWidth("left"),this.updateColumnsWidth("right"),void this.updateColumnsWidth("center");var i=1;e.nojQuery&&(i=0);for(var n=this.widget,r=(t=t||"center",n.getHeader(t)),l=n.getBody(t),o=n.getColumns(t),s=0,a=o.length,d=0,c=n.leftEl,h=n.rightEl,g=n.leftHeader.el,f=n.rightHeader.el;s<a;s++){var p=o[s];p.hidden||(d+=p.width,this.setColumnWidth(s,p.width,t))}switch(n.header&&(r.setCellsPosition(),r.updateCellsSizes()),l.updateColumnsSizes(),t){case"center":break;case"left":var m=parseInt(c.css("width")),v=parseInt(g.css("width")),C=m-d;c.animate({width:m-C-i},u),g.animate({width:v-C-i},u),n.columns.length&&this.updateCenterSideWidth();break;case"right":var y=parseInt(c.css("width"));v=parseInt(g.css("width")),C=y-d;h.animate({width:y-C},u),f.animate({width:v-C},u),n.columns.length&&this.updateCenterSideWidth()}},updateCenterSideWidth:function(){var t=this.widget,i=t.centerEl,n=t.header.el,r=t.body.el,l=0,o=0,s=t.getColumns("left"),a=t.getColumns("right"),d=t.width;t.panel?(d-=t.panelBodyBorders[1],d-=t.panelBodyBorders[3],d-=t.gridBorders[1],d-=t.gridBorders[3]):(d-=t.gridWithoutPanelBorders[1],d-=t.gridWithoutPanelBorders[3]);var c=1;e.nojQuery&&(c=0),e.each(s,function(e){e.hidden||(l+=e.width)}),e.each(a,function(e){e.hidden||(o+=e.width)}),d-=l,d-=o,d+=c,i.animate({left:l-c,width:d},u),i.animate({width:d},u),n.animate({width:d},u),r.animate({width:d},u)},setColumnWidth:function(e,i,n){var r,l,o=this.widget,s=o.getColumns(n),a=o.getBody(n),d=t(a.getDomColumn(e));(o.header&&(r=o.getHeader(n).getCell(e)),parseInt(d.css("width"))!==i)&&(o.header&&(l=r.dom),o.fire("columnresize",{cell:l,width:i,column:s[e],side:n}))},getNextVisibleIndex:function(e,t){for(var i=this.widget.getColumns(t),n=e+1,r=i.length;n<r;n++){if(!i[n].hidden)return n}}})}(),Fancy.define("Fancy.grid.plugin.Licence",{extend:Fancy.Plugin,ptype:"grid.licence",inWidgetName:"licence",constructor:function(){this.Super("const",arguments)},init:function(){this.Super("init",arguments),this.ons()},ons:function(){var e=this;e.widget.once("render",function(){e.render()})},render:function(){var e=this,t=e.widget,i=t.body,n=Fancy.get(document.createElement("div"));/fancygrid/.test(location.host)&&!t.watermark||(!0!==e.checkLicence()||t.watermark)&&(n.css({position:"absolute","z-index":2,width:"30px",height:"30px"}),t.nativeScroller?n.css({top:"2px",left:"2px"}):n.css({right:"4px",bottom:"0px"}),Fancy.get(i.el.append(n.dom)),e.licenceEl=n,t.watermark&&e.configWatermark(),e.showConsoleText())},showConsoleText:function(){window.console&&console.log&&Fancy.isChrome},configWatermark:function(){var e=this.widget.watermark;if(e.text){var t=this.licenceEl.firstChild();t.css("background-image","none"),t.css("font-size","11px"),t.update(e.text),this.licenceEl.css("width","initial")}e.style&&this.licenceEl.css(e.style)},checkLicence:function(){var e=this,t="FancyGrid";if(!Fancy.LICENSE&&!FancyGrid.LICENSE)return!1;var i,n,r=String(e.md5(location.host.replace(/^www\./,""),t)),l=Fancy.LICENSE||FancyGrid.LICENSE||[],o=e.md5("UNIVERSAL",t),s=e.md5("SAAS",t),a=e.md5("INTERNAL",t),d=e.md5("OEM",t),c=e.md5("ENTERPRISE",t);for(i=0,n=l.length;i<n;i++)switch(String(l[i])){case r:case o:case s:case a:case d:case c:return!0}return!1},md5:function(e,t,i){var n=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},r=function(e,t,i,r,l,o){return n((s=n(n(t,e),n(r,o)))<<(a=l)|s>>>32-a,i);var s,a},l=function(e,t,i,n,l,o,s){return r(t&i|~t&n,e,t,l,o,s)},o=function(e,t,i,n,l,o,s){return r(t&n|i&~n,e,t,l,o,s)},s=function(e,t,i,n,l,o,s){return r(t^i^n,e,t,l,o,s)},a=function(e,t,i,n,l,o,s){return r(i^(t|~n),e,t,l,o,s)},d=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var i,r,d,c,h,u=1732584193,g=-271733879,f=-1732584194,p=271733878;for(i=0;i<e.length;i+=16)r=u,d=g,c=f,h=p,u=l(u,g,f,p,e[i],7,-680876936),p=l(p,u,g,f,e[i+1],12,-389564586),f=l(f,p,u,g,e[i+2],17,606105819),g=l(g,f,p,u,e[i+3],22,-1044525330),u=l(u,g,f,p,e[i+4],7,-176418897),p=l(p,u,g,f,e[i+5],12,1200080426),f=l(f,p,u,g,e[i+6],17,-1473231341),g=l(g,f,p,u,e[i+7],22,-45705983),u=l(u,g,f,p,e[i+8],7,1770035416),p=l(p,u,g,f,e[i+9],12,-1958414417),f=l(f,p,u,g,e[i+10],17,-42063),g=l(g,f,p,u,e[i+11],22,-1990404162),u=l(u,g,f,p,e[i+12],7,1804603682),p=l(p,u,g,f,e[i+13],12,-40341101),f=l(f,p,u,g,e[i+14],17,-1502002290),g=l(g,f,p,u,e[i+15],22,1236535329),u=o(u,g,f,p,e[i+1],5,-165796510),p=o(p,u,g,f,e[i+6],9,-1069501632),f=o(f,p,u,g,e[i+11],14,643717713),g=o(g,f,p,u,e[i],20,-373897302),u=o(u,g,f,p,e[i+5],5,-701558691),p=o(p,u,g,f,e[i+10],9,38016083),f=o(f,p,u,g,e[i+15],14,-660478335),g=o(g,f,p,u,e[i+4],20,-405537848),u=o(u,g,f,p,e[i+9],5,568446438),p=o(p,u,g,f,e[i+14],9,-1019803690),f=o(f,p,u,g,e[i+3],14,-187363961),g=o(g,f,p,u,e[i+8],20,1163531501),u=o(u,g,f,p,e[i+13],5,-1444681467),p=o(p,u,g,f,e[i+2],9,-51403784),f=o(f,p,u,g,e[i+7],14,1735328473),g=o(g,f,p,u,e[i+12],20,-1926607734),u=s(u,g,f,p,e[i+5],4,-378558),p=s(p,u,g,f,e[i+8],11,-2022574463),f=s(f,p,u,g,e[i+11],16,1839030562),g=s(g,f,p,u,e[i+14],23,-35309556),u=s(u,g,f,p,e[i+1],4,-1530992060),p=s(p,u,g,f,e[i+4],11,1272893353),f=s(f,p,u,g,e[i+7],16,-155497632),g=s(g,f,p,u,e[i+10],23,-1094730640),u=s(u,g,f,p,e[i+13],4,681279174),p=s(p,u,g,f,e[i],11,-358537222),f=s(f,p,u,g,e[i+3],16,-722521979),g=s(g,f,p,u,e[i+6],23,76029189),u=s(u,g,f,p,e[i+9],4,-640364487),p=s(p,u,g,f,e[i+12],11,-421815835),f=s(f,p,u,g,e[i+15],16,530742520),g=s(g,f,p,u,e[i+2],23,-995338651),u=a(u,g,f,p,e[i],6,-198630844),p=a(p,u,g,f,e[i+7],10,1126891415),f=a(f,p,u,g,e[i+14],15,-1416354905),g=a(g,f,p,u,e[i+5],21,-57434055),u=a(u,g,f,p,e[i+12],6,1700485571),p=a(p,u,g,f,e[i+3],10,-1894986606),f=a(f,p,u,g,e[i+10],15,-1051523),g=a(g,f,p,u,e[i+1],21,-2054922799),u=a(u,g,f,p,e[i+8],6,1873313359),p=a(p,u,g,f,e[i+15],10,-30611744),f=a(f,p,u,g,e[i+6],15,-1560198380),g=a(g,f,p,u,e[i+13],21,1309151649),u=a(u,g,f,p,e[i+4],6,-145523070),p=a(p,u,g,f,e[i+11],10,-1120210379),f=a(f,p,u,g,e[i+2],15,718787259),g=a(g,f,p,u,e[i+9],21,-343485551),u=n(u,r),g=n(g,d),f=n(f,c),p=n(p,h);return[u,g,f,p]},c=function(e){var t,i="";for(t=0;t<32*e.length;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i},h=function(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;for(t=0;t<8*e.length;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i},u=function(e){var t,i,n="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n},g=function(e){return unescape(encodeURIComponent(e))},f=function(e){return function(e){return c(d(h(e),8*e.length))}(g(e))},p=function(e,t){return function(e,t){var i,n,r=h(e),l=[],o=[];for(l[15]=o[15]=void 0,r.length>16&&(r=d(r,8*e.length)),i=0;i<16;i+=1)l[i]=909522486^r[i],o[i]=1549556828^r[i];return n=d(l.concat(h(t)),512+8*t.length),c(d(o.concat(n),640))}(g(e),g(t))};return function(e,t,i){return t?i?p(t,e):u(p(t,e)):i?f(e):u(f(e))}(e,t,i)}}),function(){var e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_EVEN_CLS,n=e.GRID_CELL_SELECTED_CLS,r=e.GRID_COLUMN_CLS,l=e.GRID_COLUMN_TEXT_CLS,o=e.GRID_COLUMN_ELLIPSIS_CLS,s=e.GRID_COLUMN_ORDER_CLS,a=e.GRID_COLUMN_SELECT_CLS,d=e.GRID_COLUMN_TREE_CLS,c=e.GRID_CELL_INNER_CLS,h=e.GRID_CELL_DIRTY_CLS,u=e.GRID_CELL_DIRTY_EL_CLS,g=e.GRID_PSEUDO_CELL_CLS,f=e.GRID_EMPTY_CLS,p=e.GRID_COLUMN_SPARKLINE_CLS,m=e.GRID_COLUMN_SPARKLINE_BULLET_CLS,v=e.GRID_COLUMN_CHART_CIRCLE_CLS,C=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,y=e.GRID_COLUMN_GROSSLOSS_CLS,w=e.GRID_COLUMN_PROGRESS_CLS,b=e.GRID_COLUMN_PROGRESS_BAR_CLS,x=e.GRID_COLUMN_H_BAR_CLS,S=e.GRID_COLUMN_ROW_DRAG_CLS,I=e.GRID_ROW_DRAG_EL_CLS;e.ns("Fancy.grid.body.mixin"),e.grid.body.mixin.Updater=function(){},e.grid.body.mixin.Updater.prototype={update:function(e){var t,i=this,n=i.widget,r=n.store;switch(e){case"cell":case"cells":break;case"waitstate":return void i.checkDomColumns();default:i.checkDomColumns()}if(!r.loading){switch(e){case"row":case"rows":for(var l in t=r.changed){var o=t[l],s=n.getRowById(l);for(var a in o)switch(a){case"length":break;default:i.updateRows(s)}}break;case"cell":case"cells":for(var l in t=r.changed){o=t[l],s=n.getRowById(l);for(var a in o)switch(a){case"length":break;default:var d=n.getColumnOrderByKey(a);i.updateRows(s,d.order)}}break;default:i.checkDomCells(),i.updateRows()}i.showEmptyText()}},checkDomColumns:function(){var t=this,i=t.widget,n=t.el.select("."+r).length,c=t.getColumns(),h=0,u=c.length;if(!(u<=n)){for(;h<u;h++){var g=c[h],f=g.width,p=e.get(document.createElement("div"));if(g.hidden&&p.css("display","none"),p.addCls(r),p.attr("grid",i.id),p.attr("role","presentation"),"$selected"===g.index||g.select)p.addCls(a);else switch(g.type){case"order":p.addCls(s);break;case"rowdrag":p.addCls(S)}if("tree"===g.type&&(p.addCls(d),g.folder&&p.addCls("fancy-grid-tree-column-folder")),g.rowdrag&&p.addCls(S),g.cls&&p.addCls(g.cls),"text"===g.type&&p.addCls(l),p.css({width:f+"px"}),p.attr("index",h),g.cellAlign&&p.css("text-align",g.cellAlign),!0===g.ellipsis)switch(g.type){case"string":case"text":case"number":case"currency":case"date":case"combo":case"tree":p.addCls(o)}t.el.dom.appendChild(p.dom)}t.fire("adddomcolumns")}},checkDomCells:function(l){var o,s,a=this,d=a.widget,c=d.body,h=d.store,u=0,f=h.dataView.length,p=0;switch(h.infinite&&(f=h.infiniteDisplayedRows)>h.dataView.length&&(f=h.dataView.length),a.side){case"left":s=d.leftColumns;break;case"center":s=d.columns;break;case"right":s=d.rightColumns}o=s.length;var m=a.el.select("."+r),v=h.getLength(),C=a.cellTpl;for(d.cellWrapper&&(C=a.cellWrapperTpl),void 0!==l&&(p=l,o=l);p<o;p++){var y=m.item(p);for(u=f-(v-y.select("."+t).length);u<f;u++){var w=C.getHTML({});(b=e.get(document.createElement("div"))).attr("role","gridcell"),b.css({height:d.cellHeight+"px"}),b.addCls(t),b.attr("index",u),u%2!=0&&d.striped&&b.addCls(i),b.update(w),y.dom.appendChild(b.dom),c.el.select("."+t+"."+n+'[index="'+u+'"]').length&&b.addCls(n)}if(d.nativeScroller&&("left"===a.side||"right"===a.side)){y.select("."+g).destroy();var b;w=C.getHTML({cellValue:"&nbsp;"});(b=e.get(document.createElement("div"))).attr("role","gridcell"),b.css({height:d.cellHeight+"px"}),b.addCls(g),b.update(w),y.dom.appendChild(b.dom)}}},updateRows:function(e,t){var i,n,r=this,l=r.widget,o=0;switch(void 0===e?r.clearDirty():r.clearDirty(e),r.side){case"left":i=l.leftColumns;break;case"center":i=l.columns;break;case"right":i=l.rightColumns}if(n=i.length,!(void 0!==t&&(o=t,(n=t+1)>i.length))){for(;o<n;o++){var s=i[o];switch(s.type){case"string":case"number":case"combo":case"action":case"text":case"date":case"currency":r.renderUniversal(o,e);break;case"tree":r.renderTree(o,e);break;case"order":r.renderOrder(o,e);break;case"expand":r.renderExpand(o,e);break;case"select":r.renderSelect(o,e);break;case"color":r.renderColor(o,e);break;case"checkbox":r.renderCheckbox(o,e);break;case"switcher":r.renderCheckbox(o,e,!0);break;case"image":r.renderImage(o,e);break;case"sparklineline":r.renderSparkLine(o,e,"line");break;case"sparklinebar":r.renderSparkLine(o,e,"bar");break;case"sparklinetristate":r.renderSparkLine(o,e,"tristate");break;case"sparklinediscrete":r.renderSparkLine(o,e,"discrete");break;case"sparklinebullet":r.renderSparkLine(o,e,"bullet");break;case"sparklinepie":r.renderSparkLine(o,e,"pie");break;case"sparklinebox":r.renderSparkLine(o,e,"box");break;case"circle":r.renderCircle(o,e);break;case"progressdonut":r.renderProgressDonut(o,e);break;case"progressbar":r.renderProgressBar(o,e);break;case"hbar":r.renderHBar(o,e);break;case"grossloss":r.renderGrossLoss(o,e);break;case"rowdrag":r.renderRowDrag(o,e);break;default:throw new Error("[FancyGrid error] - not existed column type "+s.type)}s.select&&r.renderSelect(o,e,!0),s.rowdrag&&r.renderRowDrag(o,e,!0)}r.removeNotUsedCells()}},renderUniversal:function(e,i){var n,l,o,s=this,a=s.widget,d=a.lang,h=a.emptyValue,u=a.store,g=s.getColumns()[e],f=s.el.select("."+r).item(e),p=f.select("."+t),m=f.select("."+t+" ."+c),v=g.currency||d.currencySign,C=!1;g.select&&(C=!0),g.rowdrag&&(C=!0),n=void 0!==g.index?g.index:"action"===g.type?"none":void 0,void 0!==i?(l=i,o=i+1):(l=0,o=u.getLength());var y=0;if(a.infinite){y=u.infiniteScrolledToRow;var w=a.getNumOfVisibleCells();o>w&&(o=w)}for(;l<o;l++){if(a.infinite){var b=u.dataView[l+y],x=p.item(l);if(void 0===b){a.el.select("."+t+'[index="'+l+'"]').css("visibility","hidden");break}if("hidden"===x.css("visibility")){a.el.select("."+t+'[index="'+l+'"]').css("visibility","");break}}var S,I=u.get(l+y),T=u.getId(l+y),E=m.item(l),L=(x=p.item(l),{rowIndex:l,data:I,style:{},column:g,id:T,item:u.getItem(l+y),inner:E,cell:x}),R=!1;switch(u.changed[L.id]&&u.changed[L.id][g.index]&&(R=!0),S=g.smartIndexFn?g.smartIndexFn(I):void 0===n?"":u.get(l+y,n),L.value=S,g.format&&(L.value=s.format(L.value,g.format,g.precision),S=L.value),g.type){case"currency":""!==S&&(S=v+S),L.value=S}switch(g.render&&(S=(L=g.render(L)).value),S){case"":case null:case void 0:S=h}if(a.cellStylingCls&&s.clearCls(x),L.cls&&x.addCls(L.cls),R&&a.dirtyEnabled&&s.enableCellDirty(x),x.css(L.style),C){var D=[];g.rowdrag&&D.push('<div class="fancy-grid-cell-inner-rowdrag"></div>'),g.select?D.push('<div class="fancy-grid-cell-inner-select"></div>'):g.rowdrag&&D.push('<div class="fancy-grid-cell-inner-rowdrag-fix"></div>');var _=E.select(".fancy-grid-cell-inner-text");_.length?_.update(S):(D.push('<span class="fancy-grid-cell-inner-text">'+S+"</span>"),E.update(D.join(" ")))}else L.column.widget||E.update(S);if(L.column.autoHeight){x.css("height","");var B=parseInt(x.css("height"))+4;a.rowheight.waitToShow(),B<a.cellHeight&&(B=a.cellHeight),a.rowheight.add(T,B,L.rowIndex)}}},renderOrder:function(e){var i=this.widget,n=i.store,l=this.getColumns()[e],o=this.el.select("."+r).item(e),s=o.select("."+t),a=o.select("."+t+" ."+c),d=0,h=n.getLength(),u=0;if(i.paging&&(u+=n.showPage*n.pageSize),i.infinite){var g=i.getNumOfVisibleCells();h>g&&(h=g),u=n.infiniteScrolledToRow}for(;d<h;d++){var f=n.get(d),p=n.getId(d),m={rowIndex:d,data:f,style:{},column:l,id:p,item:n.getItem(d)},v=d+1+u;i.grouping&&(v+=i.grouping.getCollapsedRowsBefore(p)),m.value=v,l.render&&(v=(m=l.render(m)).value);var C=s.item(d);i.cellStylingCls&&this.clearCls(C),m.cls&&C.addCls(m.cls),C.css(m.style),a.item(d).update(v)}i.grouping&&delete i.grouping.collapsedRowsBefore},renderRowDrag:function(e,i,n){var l=this.widget,o=l.store,s=this.getColumns()[e],a=this.el.select("."+r).item(e),d=a.select("."+t),h=a.select("."+t+" ."+c),u=0,g=o.getLength();if(l.infinite){var f=l.getNumOfVisibleCells();g>f&&(g=f)}for(;u<g;u++){var p={rowIndex:u,data:o.get(u),style:{},column:s,id:o.getId(u),item:o.getItem(u)},m='<svg class="'+I+'" style="opacity: 0;" viewBox="0 0 6 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 2h2V0H0v2zm0 4h2V4H0v2zm0 3.999h2V8H0v1.999zM0 14h2v-2H0v2zM4 0v2h2V0H4zm0 6h2V4H4v2zm0 3.999h2V8H4v1.999zM4 14h2v-2H4v2z"></path></svg>';p.value=m;var v=d.item(u);if(l.cellStylingCls&&this.clearCls(v),p.cls&&v.addCls(p.cls),v.css(p.style),n)h.item(u).select(".fancy-grid-cell-inner-rowdrag").item(0).update(m);else h.item(u).update(m)}},renderTree:function(e,i){var n,l,o=this.widget,s=o.store,a=this.getColumns()[e],d=this.el.select("."+r).item(e).select("."+t+" ."+c),h=a.index;if(void 0!==i?(n=i,l=i+1):(n=0,l=s.getLength()),o.infinite){var u=o.getNumOfVisibleCells();l>u&&(l=u)}for(;n<l;n++){var g=d.item(n),f=o.get(n),p=f.get(h),m=Number(f.get("$deep"))-1,v="fancy-grid-tree-expander";f.get("leaf")&&(v="fancy-grid-tree-expander-leaf"),f.get("expanded")&&(v+=" fancy-grid-tree-expander-expanded");var C=15*m,y="";if(a.render){var w=a.render({item:f,data:f.data,deep:m,leaf:f.get("leaf"),rowIndex:i,column:a,value:p});w.nodeImgCls&&(y='<span class="fancy-grid-tree-expander-node '+w.nodeImgCls+'"></span>'),void 0!==w.value&&(p=w.value)}if(a.folder){var b=f.get("leaf"),x=f.get("expanded");y=b?'<span class="fancy-grid-tree-folder-file"></span>':x?'<span class="fancy-grid-tree-folder-opened"></span>':'<span class="fancy-grid-tree-folder-closed"></span>'}f.get("leaf")&&(C-=8);var S=[];S.push('<span class="'+v+'" style="margin-left: '+C+'px;"></span>'),a.select&&S.push('<span class="fancy-grid-cell-inner-select" style="margin-left: 6px;"></span>'),S.push(y),S.push('<span class="fancy-grid-tree-expander-text">'+p+"</span>"),g.update(S.join(""))}},renderExpand:function(i,n){var l,o,s=this.widget,a=s.store,d=this.getColumns()[i],h=this.el.select("."+r).item(i).select("."+t+" ."+c);if(void 0!==n?(l=n,o=n+1):(l=0,o=a.getLength()),s.infinite){var u=s.getNumOfVisibleCells();o>u&&(o=u)}for(;l<o;l++){var g,f=h.item(l).select(".fancy-field-checkbox"),p=0!==f.length,m=s.get(l).id;!1===p?(h.item(l).update(""),f=new e.CheckBox({renderTo:h.item(l).dom,renderId:!0,value:!1,label:!1,expander:!0,style:{padding:"0px",display:"inline-block"},events:[{change:function(e,t){n=e.el.parent().parent().attr("index"),t?s.expander.expand(n):s.expander.collapse(n)}}]})):(g=f.dom.id,f=e.getWidget(g),s.expander._expandedIds[m]?f.set(!0,!1):f.set(!1,!1));var v={rowIndex:l,data:a.get(l),style:{},column:d,id:a.getId(l),item:a.getItem(l)};d.render&&(!0===d.render(v).hidden?f.hide():f.show())}},clearCls:function(t){var i=this.widget;e.each(i.cellStylingCls,function(e){t.removeCls(e)})},renderColor:function(e,i){var n,l,o=this.widget,s=o.store,a=this.getColumns()[e],d=a.index,h=this.el.select("."+r).item(e).select("."+t);if(void 0!==i?(n=i,l=i+1):(n=0,l=s.getLength()),o.infinite){var u=o.getNumOfVisibleCells();l>u&&(l=u)}for(;n<l;n++){var g,f=s.get(n),p={rowIndex:n,data:f,style:{},column:a};g=a.smartIndexFn?a.smartIndexFn(f):s.get(n,d),a.render&&(g=(p=a.render(p)).value),p.value=g;var m=h.item(n);m.css(p.style),m.select("."+c).update('<div class="fancy-grid-color-cell" style="background: '+g+';"></div>')}},renderCombo:function(e,i){var n,l,o=this.widget.store,s=this.getColumns()[e],a=s.index,d=this.el.select("."+r).item(e),h=d.select("."+t),u=d.select("."+t+" ."+c);for(void 0!==i?(n=i,l=i+1):(n=0,l=o.getLength());n<l;n++){var g=o.get(n,a),f={rowIndex:n,value:g,style:{}};s.render&&(g=(f=s.render(f)).value),h.item(n).css(f.style),u.item(n).update(g)}},renderCheckbox:function(i,n,l){var o,s,a=this,d=a.widget,h=d.store,u=a.getColumns()[i],g=u.index,f=a.el.select("."+r).item(i),p=f.select("."+t),m=f.select("."+t+" ."+c),v="CheckBox";if(l&&(v="Switcher"),void 0!==n?(o=n,s=n+1):(o=0,s=h.getLength()),d.infinite){var C=d.getNumOfVisibleCells();s>C&&(s=C)}for(;o<s;o++){var y,w=h.get(o),b=h.get(o,g),x=m.item(o),S=p.item(o),I=l?x.select(".fancy-field-switcher"):x.select(".fancy-field-checkbox"),T=0!==I.length,E=!1,L=h.getId(o),R={rowIndex:o,data:w,style:{},column:u,id:L,item:h.getItem(o),value:b};if(h.changed[R.id]&&h.changed[R.id][u.index]&&(E=!0),u.render&&(b=(R=u.render(R)).value),!1===T)if(R.stopped)m.item(o).update(b);else{var D=!0;d.rowEdit&&(D=!1),m.item(o).update(""),new e[v]({renderTo:m.item(o).dom,renderId:!0,value:b,label:!1,editable:D,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(e){"$selected"===u.index||u.select||!0!==u.editable&&(e.canceledChange=!0)}},{change:function(e,t){"$selected"===u.index||u.select||(d.celledit.checkBoxChangedValue=t)}}]})}else y=I.dom.id,I=e.getWidget(y),R.stopped?(I.destroy(),m.item(o).update(b)):I.set(b,!1);d.cellStylingCls&&a.clearCls(S),R.cls&&S.addCls(R.cls),S.css(R.style),E&&d.dirtyEnabled&&(S=p.item(o),a.enableCellDirty(S))}},renderSelect:function(i,l,o){var s,a,d=this.widget,h=d.store,u=this.getColumns()[i],g=this.el.select("."+r).item(i).select("."+t+" ."+c);if(void 0!==l?(s=l,a=l+1):(s=0,a=h.getLength()),d.infinite){var f=d.getNumOfVisibleCells();a>f&&(a=f)}for(;s<a;s++){var p,m,v=!1,C=h.get(s,"id"),y=g.item(s),w=0!==(E=y.select(".fancy-field-checkbox")).length,b=!0;if(d.selection.memory){if(d.selection.memory.all&&!d.selection.memory.excepted[C]?(v=!0,d.selection.domSelectRow(s)):d.selection.memory.has(C)?(v=!0,d.selection.domSelectRow(s)):(v=!1,d.selection.domDeSelectRow(s)),h.isTree){var x=(p=h.getItem(s)).get("$selected");if(x){var S=function(t){e.each(t,function(e){e.fields&&(!1!==e.get("$selected")?(p.set("$selected",void 0),e.set("$selected",!0),d.selection.memory.add(e.id),e.data.child&&e.data.child[0]&&e.data.child[0].fields&&S(e.data.child)):d.selection.memory.remove(e.id))})};S(p.data.child)}}}else y.parent().hasClass(n)&&(v=!0);if("select"===u.type||u.select)if(d.selection.disabled&&(b=!1),!1===w){var I=g.item(s);o?(I=I.select(".fancy-grid-cell-inner-select").item(0).dom,Fancy.isBoolean(v)||(v=!1)):(g.item(s).update(""),I=I.dom);var T={renderTo:I,renderId:!0,value:v,label:!1,stopIfCTRL:!0,editable:b,disabled:!b,style:{padding:"0px",display:"inline-block"},events:[{beforechange:function(e){d.selection.stopOneTick&&(e.canceledChange=!0)}}]},E=new e.CheckBox(T);if(h.isTree&&d.selection.memory&&d.selection.memory.tree.selected[C]&&!d.selection.memory.tree.allSelected[C]&&p){var L=p.get("child");L&&L.length&&E.setMiddle(!0)}}else m=E.dom.id,(E=e.getWidget(m)).set(v,!1)}},renderImage:function(e,i){var n,l,o=this.widget,s=o.store,a=this.getColumns()[e],d=a.index,h=this.el.select("."+r).item(e),u=h.select("."+t),g=h.select("."+t+" ."+c);if(void 0!==i?(n=i,l=i+1):(n=0,l=s.getLength()),o.infinite){var f=o.getNumOfVisibleCells();l>f&&(l=f)}for(;n<l;n++){var p=s.get(n,d),m={rowIndex:n,value:p,data:s.get(n),style:{}},v="";if(a.render&&(p=(m=a.render(m)).value),m.attr)for(var C in m.attr)v+=C+'="'+m.attr[C]+'"';p="<img "+v+' src="'+m.value+'">',u.item(n).css(m.style),g.item(n).update(p)}},renderSparkLine:function(i,n,l){var o,s,a=this.widget,d=a.cellHeight,h=a.store,u=this.getColumns()[i],g=u.width,f=u.index,v=this.el.select("."+r).item(i),C=v.select("."+t),y=v.select("."+t+" ."+c),w=u.sparkConfig||{};v.addCls(p),void 0!==n?(o=n,s=n+1):(o=0,s=h.getLength());var b,x=d-1,S=g-20;switch(l){case"line":case"pie":case"box":b="width";break;case"bullet":b="width",x-=11,v.addCls(m);break;case"discrete":b="width",S=g,x-=2;break;case"bar":case"tristate":b="barWidth"}if(a.infinite){var I=a.getNumOfVisibleCells();s>I&&(s=I)}for(;o<s;o++){var T=h.get(o,f),E={rowIndex:o,value:T,data:h.get(o),style:{}};if(u.render&&(T=(E=u.render(E)).value),e.isArray(u.values)){var L=0,R=u.values.length;for(T=[];L<R;L++)T.push(h.get(o,u.values[L]))}C.item(o).css(E.style);var D=y.item(o).dom,_={type:l,fillColor:"transparent",height:x};e.apply(_,w),"bar"!==l&&"tristate"!==l||(S=g-20,S/=T.length),_[b]=S,e.$(D).sparkline(T,_)}},renderProgressDonut:function(i,n){var l,o,s=this.widget,a=s.store,d=this.getColumns()[i],h=d.index,u=this.el.select("."+r).item(i),g=u.select("."+t),f=u.select("."+t+" ."+c);if(u.addCls(C),void 0!==n?(l=n,o=n+1):(l=0,o=a.getLength()),s.infinite){var p=s.getNumOfVisibleCells();o>p&&(o=p)}for(;l<o;l++){var m,v=a.get(l),y={rowIndex:l,data:v,style:{},column:d};m=d.smartIndexFn?d.smartIndexFn(v):a.get(l,h),y.value=m,d.format&&(y.value=this.format(y.value,d.format),m=y.value),d.render&&(m=(y=d.render(y)).value),g.item(l).css(y.style);var w=d.sparkConfig||{},b=f.item(l).dom;e.apply(w,{renderTo:b,value:m}),w.size||w.height||w.width||(w.size=s.cellHeaderHeight-6),e.get(b).update(""),new e.spark.ProgressDonut(w)}},renderGrossLoss:function(i,n){var l,o,s=this.widget,a=s.store,d=this.getColumns()[i],h=d.index,u=this.el.select("."+r).item(i),g=u.select("."+t),f=u.select("."+t+" ."+c);u.addCls(y),void 0!==n?(l=n,o=n+1):(l=0,o=a.getLength());var p=d.sparkConfig||{};if(p.showOnMax&&(p.maxValue=Math.max.apply(Math,a.getColumnData(h,d.smartIndexFn))),s.infinite){var m=s.getNumOfVisibleCells();o>m&&(o=m)}for(;l<o;l++){var v,C=a.get(l),w={rowIndex:l,data:C,style:{},column:d};v=d.smartIndexFn?d.smartIndexFn(C):a.get(l,h),w.value=v,d.format&&(w.value=this.format(w.value,d.format),v=w.value),d.render&&(v=(w=d.render(w)).value),g.item(l).css(w.style),e.apply(p,{renderTo:f.item(l).dom,value:v,column:d}),new e.spark.GrossLoss(p)}},renderProgressBar:function(i,n){var l,o,s=this,a=s.widget,d=a.store,h=s.getColumns()[i],u=h.index,g=s.el.select("."+r).item(i),f=g.select("."+t),p=g.select("."+t+" ."+c),m=100;g.addCls(w),void 0!==n?(l=n,o=n+1):(l=0,o=d.getLength());var v=h.sparkConfig||{};if(!1===v.percents&&(m=Math.max.apply(Math,d.getColumnData(u))),a.infinite){var C=a.getNumOfVisibleCells();o>C&&(o=C)}for(;l<o;l++){var y,x=d.get(l),S={rowIndex:l,data:x,style:{},column:h},I=f.item(l);y=h.smartIndexFn?h.smartIndexFn(x):d.get(l,u),S.value=y,h.format&&(S.value=s.format(S.value,h.format),y=S.value),h.render&&(y=(S=h.render(S)).value),I.css(S.style),a.cellStylingCls&&s.clearCls(I),S.cls&&I.addCls(S.cls);var T=e.get(p.item(l).dom);if(T.select("."+b).length){var E=e.getWidget(T.select("."+b).item(0).attr("id"));E.value=y,E.maxValue=m,E.update()}else e.apply(v,{renderTo:p.item(l).dom,value:y,column:h,maxValue:m}),new e.spark.ProgressBar(v)}},renderHBar:function(i,n){var l,o,s=this.widget,a=s.store,d=this.getColumns()[i],h=d.index,u=this.el.select("."+r).item(i),g=u.select("."+t),f=u.select("."+t+" ."+c),p=d.sparkConfig||{},m=d.disabled||{};u.addCls(x);var v,C,y={},w=(i=0,Number.MIN_VALUE);if(e.isArray(d.index))for(v=d.index.length;i<v;i++){var b=d.index[i];if(!m[b])y[b]=a.getColumnData(b),(L=Math.max.apply(Math,y[b]))>w&&(w=L),C=y[b].length}else{var S=[];for(v=(F=a.getColumnData(d.index)).length;i<v;i++)for(var I=0,T=F[i].length;I<T;I++)m[I]||(y[I]=y[I]||[],y[I].push(F[i][I]));for(var E in y){var L=Math.max.apply(Math,y[E]);S.push(E),L>w&&(w=L),C=y[E].length}d.fields||(d.fields=S)}for(var R=[],D=0;D<C;D++)for(var E in R[D]=0,y)d.fields&&m[d.index+"."+E]||m[E]||(R[D]+=y[E][D]);var _=Math.max.apply(Math,R);if(p.maxItemValue=w,void 0!==n?(l=n,o=n+1):(l=0,o=a.getLength()),s.infinite){var B=s.getNumOfVisibleCells();o>B&&(o=B)}for(;l<o;l++){var F,H,k={rowIndex:l,data:F=a.get(l),style:{},column:d};H=d.smartIndexFn?d.smartIndexFn(F):a.get(l,h),k.value=H,d.format&&(k.value=this.format(k.value,d.format),H=k.value),d.render&&(H=(k=d.render(k)).value),g.item(l).css(k.style);var M=e.get(f.item(l).dom);if(M.select(".fancy-spark-hbar").length){var O=e.getWidget(M.select(".fancy-spark-hbar").item(0).attr("id"));O.maxValue=_,O.maxItemValue=w,O.update(F)}else e.apply(p,{renderTo:f.item(l).dom,value:H,data:F,column:d,maxValue:_,height:s.cellHeight-1}),new e.spark.HBar(p)}},renderCircle:function(e,i){var n,l,o=this.widget,s=o.store,a=this.getColumns()[e],d=a.index,h=this.el.select("."+r).item(e),u=h.select("."+t+" ."+c),g=o.cellHeight-4;function f(e,t){var i="http://www.w3.org/2000/svg",n=document.createElementNS(i,"svg:svg");n.setAttribute("width",t),n.setAttribute("height",t),n.setAttribute("viewBox","0 0 "+t+" "+t);var r=document.createElementNS(i,"circle");r.setAttributeNS(null,"cx",t/2),r.setAttributeNS(null,"cy",t/2),r.setAttributeNS(null,"r",t/2);var l="#F0F0F0";t>50&&(l="F0F0F0"),e<0&&(l="#F9DDE0"),r.setAttributeNS(null,"fill",l),n.appendChild(r);var o=document.createElementNS(i,"path"),s=e*(2*Math.PI/100)-.001,a=t/2+t/2*Math.sin(0),d=t/2-t/2*Math.cos(0),c=t/2+t/2*Math.sin(s),h=t/2-t/2*Math.cos(s),u=0;s-0>Math.PI&&(u=1);var g="M "+t/2+","+t/2+" L "+a+","+d+" A "+t/2+","+t/2+" 0 "+u+" 1 "+c+","+h+" Z";o.setAttribute("d",g),e<0?o.setAttribute("fill","#EA7369"):o.setAttribute("fill","#44A4D3"),n.appendChild(o);var f=document.createElementNS(i,"circle");return f.setAttributeNS(null,"cx",t/2),f.setAttributeNS(null,"cy",t/2),f.setAttributeNS(null,"r",.25*t),f.setAttributeNS(null,"fill","#fff"),n.appendChild(f),n}if(h.addCls(v),void 0!==i?(n=i,l=i+1):(n=0,l=s.getLength()),o.infinite){var p=o.getNumOfVisibleCells();l>p&&(l=p)}for(;n<l;n++){var m,C=s.get(n),y={rowIndex:n,data:C,style:{}};m=a.smartIndexFn?a.smartIndexFn(C):s.get(n,d),y.value=m,a.render&&(m=(y=a.render(y)).value);var w=u.item(n).dom;""===w.innerHTML&&w.appendChild(f(m,g))}},removeNotUsedCells:function(){for(var e=this.widget.store,i=this.el.select("."+r),n=0,l=i.length;n<l;n++)for(var o=i.item(n).select("."+t),s=e.getLength(),a=o.length;s<a;s++)o.item(s).remove()},getFormat:function(t){var i=this.widget.lang;switch(t){case"number":return function(e,t){if(void 0===e)return"";var n=e.toString().split(i.decimalSeparator);if(t=t||0,n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,i.thousandSeparator),n[1]){if(t>0){if(n[1].length<t){for(var r="",l=n[1].length;l<t;l++)r+="0";return n[0]+i.decimalSeparator+n[1]+r}return n[1]=String(n[1]).substring(0,t),n[0]+i.decimalSeparator+n[1]}return n[0]}if(t>0&&""!==n[0]){for(r="",l=0;l<t;l++)r+="0";return n[0]+i.decimalSeparator+r}return n[0]};case"date":return function(n){var r=e.Date.parse(n,i.date.read,t.mode);return n=e.Date.format(r,i.date.write,t.mode)}}switch(t.type){case"date":return function(i){if(!i||0===i.length)return"";if(e.isDate(i))var n=i;else n=e.Date.parse(i,t.read,t.mode);return i=e.Date.format(n,t.write,void 0,t.mode)}}},format:function(t,i,n){switch(e.typeOf(i)){case"string":t=this.getFormat(i)(t,n);break;case"function":t=i(t);break;case"object":var r=this.getFormat(i);r&&(t=r(t))}return t},enableCellDirty:function(e){e.hasCls(h)||(e.addCls(h),e.append('<div class="'+u+'"></div>'))},clearDirty:function(e){if(void 0!==e)return this.el.select("."+t+'[index="'+e+'"] .'+u).destroy(),void this.el.select("."+h+'[index="'+e+'"]').removeCls(h);this.el.select("."+u).destroy(),this.el.select("."+h).removeCls(h)},showEmptyText:function(){var t=this,i=t.widget,n=i.store;if("center"===t.side&&(t.emptyTextEl&&(t.emptyTextEl.destroy(),delete t.emptyTextEl),0===n.dataView.length)){var r=e.get(document.createElement("div"));r.addCls(f),r.update(i.emptyText),t.emptyTextEl=e.get(t.el.dom.appendChild(r.dom))}}}}(),function(){var e=Fancy,t=e.GRID_CELL_CLS,i=e.GRID_CELL_INNER_CLS,n=e.GRID_COLUMN_CLS,r=e.GRID_BODY_CLS,l=e.GRID_CELL_WRAPPER_CLS,o=e.GRID_COLUMN_SELECT_CLS,s=e.GRID_COLUMN_ELLIPSIS_CLS,a=e.GRID_COLUMN_ORDER_CLS,d=e.GRID_COLUMN_TEXT_CLS,c=e.GRID_COLUMN_TREE_CLS,h=e.GRID_COLUMN_SPARKLINE_CLS,u=e.GRID_COLUMN_CHART_CIRCLE_CLS,g=e.GRID_COLUMN_SPARK_PROGRESS_DONUT_CLS,f=e.GRID_COLUMN_GROSSLOSS_CLS,p=e.GRID_COLUMN_PROGRESS_CLS,m=e.GRID_COLUMN_H_BAR_CLS,v=e.GRID_COLUMN_ROW_DRAG_CLS,C=e.GRID_ROW_EXPAND_CLS,y=e.ANIMATE_DURATION,w={sparklineline:h,sparklinebar:h,sparklinetristate:h,sparklinediscrete:h,sparklinebullet:h,sparklinepie:h,sparklinebox:h,circle:u,progressdonut:g,grossloss:f,progressbar:p,hbar:m};e.define("Fancy.grid.Body",{extend:e.Widget,mixins:[e.grid.body.mixin.Updater],cls:r,cellTpl:['<div class="'+i+'">{cellValue}</div>'],cellWrapperTpl:['<div class="'+l+'">','<div class="'+i+'">{cellValue}</div>',"</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var e=this;e.Super("init",arguments),e.addEvents("adddomcolumns"),e.initTpl(),e.render(),e.ons()},initTpl:function(){this.cellTpl=new e.Template(this.cellTpl),this.cellWrapperTpl=new e.Template(this.cellWrapperTpl)},ons:function(){var i=this,r=i.widget,l=r.id;r.on("afterrender",i.onAfterRender,i);var o="."+n+'[grid="'+l+'"]',s=o+" div."+t;i.el.on("click",i.onCellClick,i,s),i.el.on("dblclick",i.onCellDblClick,i,s),i.el.on("mouseenter",i.onCellMouseEnter,i,s),i.el.on("mouseleave",i.onCellMouseLeave,i,s),e.isTouch?i.el.on("touchend",i.onCellMouseDown,i,s):i.el.on("mousedown",i.onCellMouseDown,i,s),i.el.on("mouseenter",i.onColumnMouseEnter,i,o),i.el.on("mouseleave",i.onColumnMouseLeave,i,o),e.isTouch?i.initTouchContextMenu(s):i.el.on("contextmenu",i.onContextMenu,i,s),i.el.on("mouseleave",i.onBodyLeave,i)},render:function(){var t,i=this.widget,n=e.get(document.createElement("div"));n.addCls(r),n.attr("role","presentation"),t=i.el.select(".fancy-grid-"+this.side).dom,this.el=e.get(t.appendChild(n.dom))},onAfterRender:function(){var e=this,t=e.widget,i=t.store;("left"!==e.side||t.leftColumns.length)&&("right"!==e.side||t.rightColumns.length)&&(!t.grouping||t.grouping&&!t.grouping.by?t.state&&t.state.startState&&(t.state.startState.sorters||t.state.startState.filters||void 0!==t.state.startState.page)?e.update("waitstate"):e.update():t.grouping&&"server"===i.proxyType&&e.update(),e.setHeight())},setColumnsPosition:function(t,i){var r=this.widget,l=this.getColumns(),o=0,s=l.length,a=0,d=this.el.select("."+n+'[grid="'+r.id+'"]');for(a+=t=t||this.scrollLeft||0;o<s;o++){var c=l[o],h=d.item(o);i&&!e.nojQuery?h.animate({left:a+"px"},e.ANIMATE_DURATION):h.css({left:a+"px"}),c.hidden||(a+=c.width)}},wheelScroll:function(e){var t=this.widget,i=(t.store,t.knobOffSet),r=this.el.select("."+n+'[grid="'+t.id+'"]');if(0!==r.length){var l=parseInt(r.item(0).css("top")),o=0,s=r.length,a=t.getBodyHeight(),d=t.getCellsViewHeight()-a+i,c={oldScroll:parseInt(r.item(0).css("top")),newScroll:parseInt(r.item(0).css("top"))+30*e,deltaScroll:30*e};for(d<0&&(d=0);o<s;o++){var h=r.item(o),u=parseInt(h.css("top"))+30*e;u>0?(u=0,c.newScroll=0):Math.abs(u)>d&&(u=-d-i,c.newScroll=u),u>0&&(u=0),h.css("top",u+"px")}return c.scrolled=l!==parseInt(r.item(0).css("top")),c}},scroll:function(e,t,i){var r=this,l=r.widget,o=l.scroller,s=l.store,a=r.el.select("."+n+'[grid="'+l.id+'"]'),d=0,c=a.length,h={};if(!1!==e&&null!=e)if(h.scrollTop=e,l.infinite){if(o.scrollTop!==e){var u=Math.round(e/l.cellHeight);if(s.infiniteScrolledToRow!==u){if(s.infiniteScrolledToRow=u,r.infiniteTimeOut)new Date-r.infiniteTimeOutDate<100&&clearInterval(r.infiniteTimeOut);else r.infiniteTimeOutDate=new Date;r.infiniteTimeOut=setTimeout(function(){l.leftBody.update(),l.body.update(),l.rightBody.update(),clearInterval(r.infiniteTimeOut),delete r.infiniteTimeOut,delete r.infiniteTimeOutDate},1)}}}else for(;d<c;d++){a.item(d).css("top",-e+"px")}return!1!==t&&null!=t&&(h.scrollLeft=t,l.header&&l.header.scroll(t,i),r.scrollLeft=t,l.body.setColumnsPosition(t,i),"center"===r.side&&(l.grouping&&l.grouping.by&&l.grouping.scrollLeft(t),l.summary&&l.summary.scrollLeft(t),l.subHeaderFilter&&l.filter.scrollLeft(t))),h},setHeight:function(){var e=this.widget.getBodyHeight();this.css("height",e+"px")},onCellClick:function(e){var t=this.widget;t.fire("cellclick",this.getEventParams(e)),t.fire("rowclick",this.getEventParams(e)),t.fire("columnclick",this.getColumnEventParams(e)),!1===t.activated&&(t.activated=!0,t.fire("activate"))},onCellDblClick:function(e){var t=this.widget;t.fire("celldblclick",this.getEventParams(e)),t.fire("rowdblclick",this.getEventParams(e)),t.fire("columndblclick",this.getColumnEventParams(e))},getEventParams:function(t){var i=this.widget.store,n=this.getColumns(),r=t.currentTarget,l=e.get(t.currentTarget),o=l.parent();if(void 0===l.parent().dom)return!1;if(0===i.getLength())return!1;if(void 0===o.attr("index"))return!1;var s=i.infiniteScrolledToRow||0,a=parseInt(o.attr("index")),d=parseInt(l.attr("index")),c=n[a],h=c.index,u=i.get(d+s,h),g=i.getId(d+s),f=i.get(d+s),p=i.getById(g);return c.smartIndexFn&&(u=c.smartIndexFn(f)),{e:t,id:g,side:this.side,cell:r,column:c,rowIndex:d,infiniteRowIndex:d+s,columnIndex:a,value:u,data:f,item:p}},getColumnEventParams:function(t){var i=this.widget,n=i.store,r=e.get(t.currentTarget),l=r.parent(),o=parseInt(l.attr("index")),s=this.getColumns()[o],a={e:t,side:this.side,columnIndex:o,column:s,columnDom:l.dom,cell:r.dom};return i.columnClickData&&(a.data=n.getColumnData(s.index,s.smartIndexFn)),a},getColumnHoverEventParams:function(i){var n=e.get(i.currentTarget),r=parseInt(n.attr("index")),l=this.getColumns()[r],o=i.target;return e.get(o).hasCls(t)||(o=e.get(o).parent("."+t).dom),{e:i,side:this.side,columnIndex:r,column:l,columnDom:n.dom,cell:o}},getColumns:function(){return this.widget.getColumns(this.side)},onCellMouseEnter:function(t){var i=this,n=i.widget,r=i.getEventParams(t),l=i.prevCellOver;e.nojQuery&&l&&i.fixZeptoBug&&(r.rowIndex===l.rowIndex&&r.columnIndex===l.columnIndex&&r.side===l.side||(n.fire("cellleave",l),r.rowIndex!==l.rowIndex&&n.fire("rowleave",l))),l?r.rowIndex!==i.prevCellOver.rowIndex&&n.fire("rowenter",r):n.fire("rowenter",r),n.fire("cellenter",r),i.prevCellOver=r},onCellMouseDown:function(t){var i=this.widget,n=this.getEventParams(t),r={e:n.e,side:n.side,columnDom:e.get(n.cell).parent().dom,column:n.column,columnIndex:n.columnIndex,cell:n.cell};2===t.button&&2===t.buttons||3===t.which||(i.fire("beforecellmousedown",n),i.fire("cellmousedown",n),i.fire("columnmousedown",r),!1===i.activated&&(i.activated=!0,i.fire("activate")))},onCellMouseLeave:function(t){var i=this,n=i.widget,r=i.getEventParams(t),l=i.prevCellOver;if(e.nojQuery){if(void 0===l)return;i.fixZeptoBug=r}else n.fire("rowleave",l),n.fire("cellleave",l),delete i.prevCellOver},onColumnMouseEnter:function(e){var t=this,i=t.widget,n=t.getColumnHoverEventParams(e);t.prevColumnOver?t.prevCellOver&&n.rowIndex!==t.prevCellOver.rowIndex&&i.fire("rowenter",n):i.fire("columnenter",n),t.prevColumnOver=n},onColumnMouseLeave:function(){this.widget.fire("columnleave",this.prevColumnOver),delete this.prevColumnOver},getCell:function(e,i){var r=this.widget;return this.el.select("."+n+'[index="'+i+'"][grid="'+r.id+'"] .'+t+'[index="'+e+'"]')},getDomCell:function(e,i){var r=this.widget;return this.el.select("."+n+'[index="'+i+'"][grid="'+r.id+'"] .'+t+'[index="'+e+'"]').dom},getDomColumn:function(e){var t=this.widget;return this.el.select("."+n+'[index="'+e+'"][grid="'+t.id+'"]').dom},destroy:function(){var i=this,r=i.el,l="div."+t,o="div."+n;r.un("click",i.onCellClick,i,l),r.un("dblclick",i.onCellDblClick,i,l),r.un("mouseenter",i.onCellMouseEnter,i,l),r.un("mouseleave",i.onCellMouseLeave,i,l),e.isTouch?r.un("touchend",i.onCellMouseDown,i,l):r.un("mousedown",i.onCellMouseDown,i,l),r.un("mouseenter",i.onColumnMouseEnter,i,o),r.un("mouseleave",i.onColumnMouseLeave,i,o)},hideColumn:function(e){var t=this.widget,i=this.getColumns(),r=this.el.select("."+n),l=r.item(e),o=0,s=i.length,a=0;for("center"===this.side&&(a-=t.scroller.scrollLeft),l.hide();o<s;o++){l=r.item(o);var d=i[o],c=parseInt(l.css("left"));d.hidden||(c!==a&&(l.stop(),l.animate({left:a},y)),a+=d.width)}},showColumn:function(t,i){var r=this.widget,l=this.getColumns(),o=this.el.select("."+n),s=o.item(t),a=0,d=0,c=l.length;for("center"===this.side&&(a-=r.scroller.scrollLeft),e.isNumber(i)&&s.css("width",i+"px"),s.show();d<c;d++){s=o.item(d);parseInt(s.css("left"));var h=l[d];h.hidden||(s.stop(),s.animate({left:a},y),a+=h.width)}},removeColumn:function(e){var t=this.el.select("."+n),i=t.item(e),r=parseInt(i.css("width")),l=e+1,o=t.length;for(i.destroy();l<o;l++){var s=t.item(l),a=parseInt(s.css("left"))-r;s.attr("index",l-1),s.css("left",a)}},insertColumn:function(t,i){var r,l=this,h=l.widget,u=l.getColumns(),g=l.el.select("."+n),f=i.width,p=e.get(document.createElement("div")),m=t,C=g.length,y=0,w=0,b=t;for("center"===l.side&&(y=-h.scroller.scrollLeft);w<b;w++)u[w].hidden||(y+=u[w].width);for(r=y;m<C;m++)if(!u[m].hidden){var x=g.item(m);y=parseInt(x.css("left"))+i.width,x.css("left",y),x.attr("index",m+1)}if(p.attr("role","presentation"),p.addCls(n),p.attr("grid",h.id),"$selected"===i.index||i.select)p.addCls(o);else switch(i.type){case"order":p.addCls(a);break;case"rowdrag":p.addCls(v)}if(i.cls&&p.addCls(i.cls),"tree"===i.type&&(p.addCls(c),i.folder&&p.addCls("fancy-grid-tree-column-folder")),"text"===i.type&&p.addCls(d),p.css({width:f+"px"}),p.attr("index",t),i.cellAlign&&p.css("text-align",i.cellAlign),!0===i.ellipsis)switch(i.type){case"string":case"text":case"number":case"date":case"combo":case"tree":p.addCls(s)}var S=h.scroller.getScroll();p.css("top",-S),0===t&&g.length?(p.css("left","0px"),l.el.dom.insertBefore(p.dom,g.item(t).dom)):0!==t&&g.length?t===g.length?(p.css("left",y+"px"),l.el.dom.appendChild(p.dom)):(p.css("left",r+"px"),l.el.dom.insertBefore(p.dom,g.item(t).dom)):(p.css("left",y+"px"),l.el.dom.appendChild(p.dom)),l.checkDomCells(),l.updateRows(void 0,t)},reSetIndexes:function(){this.el.select("."+n).each(function(e,t){e.attr("index",t)})},clearColumnsStyles:function(){this.el.select("div."+t).each(function(e){e.css("color",""),e.css("background-color","")})},updateColumnsSizes:function(){var t=this,i=t.widget,r=t.getColumns(),l=0;"center"===t.side&&(l=-i.scroller.scrollLeft),e.each(r,function(e,i){if(!e.hidden){var r=t.el.select("."+n+'[index="'+i+'"]');Fancy.nojQuery?r.css({width:e.width,left:l}):(r.$dom.stop(),r.animate({width:e.width,left:l},y,void 0,function(){r.css("overflow","")})),l+=e.width}})},reSetColumnsAlign:function(){var e=this.getColumns();this.el.select("."+n).each(function(t,i){var n=e[i];t.css("text-align",n.cellAlign||"")})},reSetColumnsCls:function(){var t=this.getColumns();this.el.select("."+n).each(function(i,r){var l=t[r],d=i.attr("class").split(" ");if(e.each(d,function(e){switch(e){case n:case l.cls:case w[l.type]:break;default:i.removeCls(e)}}),l.cls&&i.addCls(l.cls),l.ellipsis)switch(l.type){case"checkbox":break;default:i.addCls(s)}switch(l.type){case"order":i.addCls(a);break;case"select":i.addCls(o);break;case"rowdrag":i.addCls(v);break;case"tree":i.addCls(c),l.folder&&i.addCls("fancy-grid-tree-column-folder")}l.select&&i.addCls(o),l.rowdrag&&i.addCls(v)})},initTouchContextMenu:function(e){this.el.on("touchstart",this.onTouchStart,this,e)},onTouchStart:function(e){var t=this;t.touchEvent=e,t.intTouchStart=setTimeout(function(){t.touchLongPress=!0},1e3),t.el.once("touchend",t.onTouchEnd,t),t.el.once("touchmove",t.onTouchMove,t)},onTouchEnd:function(){var e=this,t=e.widget;e.touchLongPress&&t.fire("contextmenu",e.getEventParams(e.touchEvent)),clearInterval(e.intTouchStart),e.el.un("touchmove",e.onTouchMove),delete e.touchLongPress},onTouchMove:function(){clearInterval(this.intTouchStart),delete this.touchLongPress,this.un("touchend",this.onTouchEnd)},onContextMenu:function(e){this.widget.fire("contextmenu",this.getEventParams(e))},updateColumnsVisibility:function(){var e=this.getColumns();this.el.parent().select(":not(."+C+") ."+n).each(function(t,i){e[i].hidden?t.hide():"none"===t.css("display")&&t.show()})},onBodyLeave:function(){delete this.prevCellOver}})}(),function(){var e=Fancy,t=e.GRID_HEADER_CLS,i=e.GRID_HEADER_CELL_CLS,n=e.GRID_HEADER_CELL_CONTAINER_CLS,r=e.GRID_HEADER_CELL_TEXT_CLS,l=e.GRID_HEADER_CELL_LEFT_IMAGE_CLS,o=e.GRID_HEADER_CELL_CONTAINS_LI,s=e.GRID_HEADER_CELL_TRIGGER_CLS,a=e.GRID_HEADER_CELL_TRIGGER_IMAGE_CLS,d=e.GRID_HEADER_CELL_TRIGGER_DISABLED_CLS,c=e.GRID_HEADER_CELL_GROUP_LEVEL_1_CLS,h=e.GRID_HEADER_CELL_GROUP_LEVEL_2_CLS,u=e.GRID_HEADER_CELL_SELECT_CLS,g=e.GRID_HEADER_CELL_FILTER_FULL_CLS,f=e.GRID_HEADER_CELL_FILTER_SMALL_CLS,p=e.GRID_HEADER_CELL_TRIPLE_CLS,m=e.GRID_HEADER_CELL_CHECKBOX_CLS,v=e.GRID_HEADER_CELL_SORTABLE_CLS,C=e.GRID_HEADER_CELL_NOT_SORTABLE_CLS,y=e.FIELD_CHECKBOX_CLS,w=e.ANIMATE_DURATION;e.define("Fancy.grid.Header",{extend:e.Widget,cls:t,mixins:["Fancy.grid.header.mixin.Menu"],cellTpl:['<div role="columnheader" col-id="{id}" class="'+i+' {cls}" style="display:{display};width:{columnWidth}px;height: {height};left: {left};" {groupIndex} index="{index}">','<div class="'+n+'" style="height: {height};">','<span class="'+l+' {headerLImageCls}">&nbsp;</span>','<span class="'+r+'">{columnName}</span>','<span class="'+s+'">','<div class="'+a+'"></div>',"</span>","</div>","</div>"],constructor:function(){this.Super("const",arguments)},init:function(){var e=this;e.Super("init",arguments),e.initTpl(),e.render(),e.renderHeaderCheckBox(),e.setAlign(),e.setCellsPosition(),e.ons()},initTpl:function(){this.cellTpl=new e.Template(this.cellTpl)},ons:function(){var e=this,t=e.widget,n=e.el,l="div."+i;t.on("render",e.onAfterRender,e),t.on("docmove",e.onDocMove,e),t.on("columndrag",e.onColumnDrag,e),n.on("click",e.onTriggerClick,e,"span."+s),n.on("click",e.onCellClick,e,l),n.on("mousemove",e.onCellMouseMove,e,l),n.on("mousedown",e.onCellMouseDown,e,l),n.on("mousedown",e.onMouseDown,e),n.on("dblclick",e.onCellTextDBLClick,e,"."+r),n.on("mouseenter",e.onCellMouseEnter,e,l),n.on("mouseleave",e.onCellMouseLeave,e,l)},render:function(){var t,i=this,n=i.widget,r=i.getColumns(),l=e.get(document.createElement("div")),s="",a=0,h=r.length,p=1,m={},y=0,w=n.filter&&n.filter.header&&!n.subHeaderFilter,b="full",x=n.cellHeaderHeight;for(n.groupheader&&(w&&!n.filter.groupHeader?b="small":p=2),w&&p++;a<h;a++){var S=r[a],I=S.title||S.header,T=x,E="",L="";if(void 0!==I&&""!==I&&" "!==I||(I="&nbsp;"),1!==p)if(S.grouping){if(!m[S.grouping]){var R=n.groupheader.groupsMap[S.grouping];m[S.grouping]={width:0,title:S.grouping,left:y,cls:R.headerCls||""}}T=w&&n.filter.groupHeader?2*x+"px":x+"px",S.hidden||(m[S.grouping].width+=S.width),L='group-index="'+S.grouping+'"',E=c}else T=p*x+"px";if(y+=S.width,("$selected"===S.index||S.select)&&(E+=" "+u),S.menu||(E+=" "+d),S.filter&&S.filter.header)switch(b){case"small":E+=" "+f;break;case"full":n.subHeaderFilter||(E+=" "+g)}S.headerLImageCls&&(E+=" "+o),S.headerCls&&(E+=" "+S.headerCls),S.sortable?E+=" "+v:E+=" "+C,e.isNumber(T)&&(T+="px");var D={cls:E,columnName:I,columnWidth:S.width,index:a,height:T,left:"initial",groupIndex:L,display:S.hidden?"none":"",id:S.id||"",headerLImageCls:S.headerLImageCls||""};s+=i.cellTpl.getHTML(D)}l.css({height:x*p+"px",width:i.getColumnsWidth()}),l.attr("role","presentation"),l.addCls(i.cls),n.groupheader&&(l.addCls("fancy-grid-header-grouped"),s+=i.getGroupingCellsHTML(m)),l.update(s),t=n.el.select(".fancy-grid-"+i.side).dom,i.el=e.get(t.appendChild(l.dom))},insertCell:function(t,i){var n,r=this,l=r.widget,o=r.getCells(),s=r.getColumns(),a="",c=i.title||i.header,g=0;if(o.length&&(n=parseInt(o.item(0).css("height"))),n=parseInt(l.header.el.css("height")),"center"===r.side&&(g=-l.scroller.scrollLeft),l.groupheader){var f=r.el.select("."+h);t!==l.columns.length-1&&f.each(function(e){var t=parseInt(e.css("left")||0)+i.width;e.css("left",t)})}("$selected"===i.index||i.select)&&(a+=" "+u),i.menu||(a+=" "+d);for(var p=0,m=t;p<m;p++)s[p].hidden||(g+=s[p].width);"center"===r.side&&(g+=l.scroller.scrollLeft||0),i.headerCls&&(a+=" "+i.headerCls),i.sortable?a+=" "+v:a+=" "+C;var y=r.cellTpl.getHTML({cls:a,columnName:c,columnWidth:i.width,index:t,height:String(n)+"px",left:String(g)+"px",groupIndex:"",id:i.id||""});0===t&&o.length?e.get(o.item(0).before(y)):0!==t&&o.length?t===o.length?r.el.append(y):e.get(o.item(t).before(y)):r.el.append(y);var w=0,b=s.length,x=0;for(g=0,"center"===r.side&&(g-=l.scroller.scrollLeft),o=r.getCells();w<b;w++){if(!(i=s[w]).hidden)o.item(w).css("left",g),g+=i.width,x+=i.width}var S=parseInt(r.css("width"));S>x&&(x=S),r.css("width",x),l.subHeaderFilter&&l.filter.addSubHeaderFilterCellContainer(r.side),r.reSetColumnsAlign(),r.reSetIndexes(),l.subHeaderFilter&&l.filter.updateSubHeaderFilterSizes()},setAlign:function(){for(var e=this.getColumns(),t=0,i=e.length;t<i;t++){var n=e[t];n.align&&this.getDomCell(t).css("text-align",n.align)}},onAfterRender:function(){},setCellsPosition:function(t){var i=this,n=i.widget,r=i.getColumns(),l=0,o=i.getCells();(l+=i.scrollLeft||0,e.each(r,function(e,t){var i=o.item(t),r="0px";e.grouping&&(r=n.cellHeaderHeight+"px"),i.css({top:r,left:l+"px"}),e.hidden||(l+=e.width)}),n.groupheader)&&i.el.select("."+h).each(function(n){var l=n.attr("index"),o=(i.el.select('[group-index="'+l+'"]'),i.scrollLeft||0),s=0;e.each(r,function(e){if(e.grouping===l)return!0;e.hidden||(o+=e.width)}),e.each(r,function(e){e.grouping!==l||e.hidden||(s+=e.width)}),t&&!e.nojQuery?(n.css({left:o,width:s}),0===s&&n.css({display:"none"})):n.css({left:o,width:s})})},fixGroupHeaderSizing:function(){var t=this,i=t.widget,r=i.cellHeaderHeight,l=t.getColumns(),o=t.getCells(),s=0,a={},d={},u={},p=t.calcRows(),m=i.filter&&i.filter.header&&!i.subHeaderFilter,v=!1;for(var C in"center"===t.side&&(s=i.scroller.scrollLeft),m&&e.each(l,function(e){e.grouping&&e.filter&&e.filter.header&&(v=!0)}),e.each(l,function(e,t){var l=o.item(t),h=e.grouping,C="0px",y=r*p;a[h]=!0,h?(void 0===d[h]?(d[h]=e.width,u[h]=s):d[h]+=e.width,l.addCls(c),C=r+"px",y=r,v&&(y=2*r),e.filter&&e.filter.header&&m&&setTimeout(function(){l.addCls(g)},30)):(l.removeCls(c),e.filter&&e.filter.header&&m&&(setTimeout(function(){l.addCls(f)},30),l.addCls(f))),!i.groupheader||y!==r||h||e.filter||m||(y=2*r),l.css({top:C,height:y}),l.select("."+n).css({height:y}),s+=e.width}),d){t.el.select('[index="'+C+'"]').css({left:u[C],width:d[C]})}t.el.select("."+h).each(function(e){var t=e.attr("index");a[t]||e.destroy()})},getColumnsWidth:function(){for(var e=this.getColumns(),t=0,i=0,n=e.length;i<n;i++){t+=e[i].width}return t},getColumns:function(){var e,t=this.widget;switch(this.side){case"left":e=t.leftColumns;break;case"center":e=t.columns;break;case"right":e=t.rightColumns}return e},getDomCell:function(e){return this.getCells().item(e)},onCellClick:function(t){var i=this,n=i.widget,r=n.columndrag,l=t.currentTarget,o=e.get(t.target),d=parseInt(e.get(l).attr("index")),c=i.getColumns()[d];r&&"dragging"===r.status||o.hasCls(s)||o.hasCls(a)||e.get(l).hasCls(h)||i.textDBLClick||(c.titleEditable?setTimeout(function(){i.textDBLClick?setTimeout(function(){delete i.textDBLClick},400):n.fire("headercellclick",{e:t,side:i.side,cell:l,index:d,column:c})},300):n.fire("headercellclick",{e:t,side:i.side,cell:l,index:d,column:c}))},onCellMouseMove:function(t){var i=this.widget,n=t.currentTarget,r=e.get(n).hasCls(h),l=parseInt(e.get(n).attr("index"));r||i.fire("headercellmousemove",{e:t,side:this.side,cell:n,index:l})},onMouseDown:function(t){"INPUT"===e.get(t.target).prop("tagName")||t.preventDefault()},onCellMouseDown:function(t){var i=this.widget,n=t.currentTarget,r=parseInt(e.get(n).attr("index"));i.fire("headercellmousedown",{e:t,side:this.side,cell:n,index:r})},scroll:function(e,t){this.scrollLeft=e,this.setCellsPosition(t)},getGroupingCellsHTML:function(t){var i=this,n=i.widget,r="";return e.each(t,function(e,t){r+=i.cellTpl.getHTML({cls:h+" "+e.cls,columnName:e.title,columnWidth:e.width,index:t,height:n.cellHeaderHeight+"px",left:e.left+"px",groupIndex:"",id:e.id||""})}),r},destroy:function(){var e=this,t=e.el,n="div."+i;t.un("click",e.onCellClick,e,n),t.un("mousemove",e.onCellMouseMove,e,n),t.un("mousedown",e.onCellMouseDown,e,n),t.un("mousedown",e.onMouseDown,e),t.un("mouseenter",e.onCellMouseEnter,e,n),t.un("mouseleave",e.onCellMouseLeave,e,n)},getCell:function(e){return this.el.select("."+i+'[index="'+e+'"]')},onTriggerClick:function(t){var i=e.get(t.currentTarget).parent().parent(),n=parseInt(i.attr("index")),r=this.getColumns(),l=r[n];t.stopPropagation(),this.showMenu(i,n,l,r)},hideCell:function(t){var i=this,n=i.widget,r=i.getCells(),l=r.item(t),o=parseInt(l.css("width")),s=0,a=r.length,d=i.getColumns();if(l.hasCls(c)){var u=l.attr("group-index"),g=i.el.select("."+h+'[index="'+u+'"]').item(0),f=parseInt(g.css("width"));g.stop(),f-o==0?g.css({display:"none",width:f-o}):g.animate({width:f-o},w)}l.hide();var p={},m=0,v=0;for("center"===i.side&&(m-=v=n.scroller.scrollLeft);s<a;s++){var C=r.item(s),y=parseInt(C.css("left")),b=d[s];b.hidden||(b.grouping&&d[t].grouping!==b.grouping&&(p[b.grouping]=!0),y!==m&&(C.stop(),C.animate({left:m},w)),m+=b.width)}e.each(p,function(t,r){var l=i.el.select("."+h+'[index="'+r+'"]').item(0),o=0;"center"===i.side&&(v=n.scroller.scrollLeft,o-=v),e.each(d,function(e){if(!e.hidden)return e.grouping===r||void(o+=e.width)}),l.stop(),l.animate({left:o},w)})},showCell:function(t,i){var n,r=this,l=r.widget,o=r.getCells(),s=o.item(t),a=0,d=0,u=o.length,g=r.getColumns();if(e.isNumber(i)&&s.css("width",i+"px"),s.show(),n=parseInt(s.css("width")),s.hasCls(c)){var f=s.attr("group-index"),p=r.el.select("."+h+'[index="'+f+'"]').item(0),m=parseInt(p.css("width"));p.stop(),"none"===p.css("display")&&p.show(),p.animate({width:m+n},w)}var v=0;"center"===r.side&&(a-=v=l.scroller.scrollLeft);for(var C={};d<u;d++){var y=o.item(d),b=(parseInt(y.css("left")),g[d]);b.hidden||(b.grouping&&g[t].grouping!==b.grouping&&(C[b.grouping]=!0),y.stop(),y.animate({left:a},w),a+=b.width)}e.each(C,function(t,i){var n=r.el.select("."+h+'[index="'+i+'"]').item(0),o=0;"center"===r.side&&(v=l.scroller.scrollLeft,o-=v),e.each(g,function(e){if(!e.hidden)return e.grouping===i||void(o+=e.width)}),n.stop(),n.animate({left:o},w)})},removeCell:function(e){var t=this,i=t.widget,n=t.getCells(),r=n.item(e),l=parseInt(r.css("width")),o=e+1,s=n.length,a={},d=!1;for(r.attr("group-index")&&(a[d=r.attr("group-index")]=!0),r.destroy();o<s;o++){var c=n.item(o),h=parseInt(c.css("left"))-l;c.attr("group-index")&&(a[c.attr("group-index")]=!0),c.attr("index",o-1),c.css("left",h)}for(var u in a){var g=t.el.select('[index="'+u+'"]'),f=parseInt(g.css("width"))-l,p=parseInt(g.css("left"))-l;d&&g?(g.css("width",f),g.attr("index")!==d&&g.css("left",p)):g.css("left",p)}d&&0===t.el.select('[group-index="'+d+'"]').length&&(g=t.el.select('[index="'+d+'"]')).destroy(),"center"!==t.side&&t.css("width",parseInt(t.css("width"))-l),i.subHeaderFilter&&i.filter.removeSubHeaderCell(t.side,e),t.reSetIndexes()},renderHeaderCheckBox:function(){for(var t=this.widget,i=this.getColumns(),n=0,l=i.length,o=this.getCells();n<l;n++){var s=i[n];if(e.isObject(s.headerCheckBox)){var a=s.headerCheckBox.el,d=a.attr("id");(a=e.get(d)).dom||(s.headerCheckBox=!0)}if(!0===s.headerCheckBox&&"select"!==s.type){var c=o.item(n),h=c.firstChild(),g=c.select("."+r),f=!!s.title&&s.title,p=0;switch(s.type){case"checkbox":case"switcher":c.addCls(m);break;case"select":c.addCls(u)}g.update(""),f.length&&(p=15*f.width),s.headerCheckBox=new e.CheckBox({renderTo:h.dom,renderId:!0,labelWidth:p,value:!1,label:!1,labelAlign:"right",style:{padding:"0px",display:"inline-block"},events:[{change:function(e,i){for(var n=0,r=t.getViewTotal();n<r;n++)t.set(n,s.index,i)}}]})}}},reSetIndexes:function(){var e=this.widget,t=this.getCells(),n=this.getColumns();(t.each(function(e,t){e.attr("index",t);var i=n[t];e.attr("col-id",i.id)}),e.subHeaderFilter)&&e.filter.getSubHeaderFilterEl(this.side).select("."+i).each(function(e,t){e.attr("index",t)})},reSetGroupIndexes:function(){var e=this.getColumns();this.getCells().each(function(t,i){var n=e[i].grouping;t.attr("group-index")&&!n?t.removeAttr("group-index"):n&&t.attr("group-index")!==n&&t.attr("group-index",n)})},updateTitles:function(){var t=this,n=t.getColumns();e.each(n,function(e,n){e.headerCheckBox||t.el.select("div."+i+'[index="'+n+'"] .'+r).update(e.title||"")})},updateCellsSizes:function(){var t=this,n=t.widget,r=t.getColumns(),l=0;"center"===t.side&&(l=n.nativeScroller?-n.body.el.dom.scrollLeft:-n.scroller.scrollLeft),e.each(r,function(e,n){if(!e.hidden){var r=t.el.select("div."+i+'[index="'+n+'"]'),o=parseInt(r.css("left")),s=parseInt(r.css("width"));o!==l||s!==e.width?(Fancy.nojQuery?r.css({width:e.width,left:l}):r.animate({width:e.width,left:l},w),l+=e.width):l+=e.width}})},calcRows:function(){var e=this.widget,t=e.columns.concat(e.leftColumns).concat(e.rightColumns),i=1;(Fancy.each(t,function(t){t.grouping&&(i<2&&(i=2),t.filter&&t.filter.header&&!e.subHeaderFilter&&i<3&&(i=3)),t.filter&&t.filter.header&&!e.subHeaderFilter&&i<2&&(i=2)}),e.groupheader&&2===i)&&(e.el.select("."+p).length&&(i=3));return i},reSetColumnsAlign:function(){var e=this.getColumns();this.getCells().each(function(t,i){var n=e[i];t.css("text-align",n.align||"")})},destroyMenus:function(){},onDocMove:function(){var e=this.widget;("none"===e.el.css("display")||e.panel&&e.panel.el&&"none"===e.panel.el.css("display")&&this.hideMenu)&&this.hideMenu()},reSetColumnsCls:function(){var t=this.getColumns(),i=this.getCells(),n=[];e.each(t,function(e){e.headerCls&&n.push(e.headerCls),e.sortable?n.push(v):n.push(C)}),i.each(function(i,r){var l=t[r];e.each(n,function(e){i.removeCls(e)}),l.headerCls&&i.addCls(l.headerCls),l.sortable?i.addCls(v):i.addCls(C),l.menu?i.removeCls(d):i.addCls(d)})},updateCellsVisibility:function(){var e=this.getColumns();this.getCells().each(function(t,i){e[i].hidden?t.hide():"none"===t.css("display")&&t.show()})},reSetCheckBoxes:function(){var t=this.getColumns(),i=this.getCells();e.each(t,function(t,n){var r=i.item(n),l=r.select("."+y);if(l.length){if("select"===t.type||t.select)return;var o=e.getWidget(l.item(0).attr("id"));switch(r.removeCls(m),r.removeCls(u),t.type){case"select":r.addCls(u);break;case"checkbox":r.addCls(m);break;default:t.headerCheckBox||o.destroy()}}}),this.renderHeaderCheckBox()},onCellTextDBLClick:function(e){var t=this,i=t.widget,n=Fancy.get(e.target).parent().parent(),r=n.attr("index"),l=t.getColumns()[r],o=l.title;l.titleEditable&&(t.textDBLClick=!0,t.activeEditColumnField&&(t.activeEditColumnField.destroy(),delete t.activeEditColumnField),t.activeEditColumnField=new Fancy.StringField({renderTo:t.el.dom,label:!1,theme:i.theme,padding:"0px 0px 0px",width:l.width+1,value:l.title||"",inputHeight:i.cellHeaderHeight+1,events:[{enter:function(e){e.destroy()}},{esc:function(e){i.setColumnTitle(l.index,o,t.side),e.destroy(),delete t.activeEditColumnField}},{input:function(e,n){i.setColumnTitle(l.index,n,t.side),delete t.activeEditColumnField}},{render:function(e){e.focus(),delete t.activeEditColumnField}}],style:{position:"absolute",top:-1,left:parseInt(n.css("left"))-1}}),i.once("scroll",function(){t.activeEditColumnField&&(t.activeEditColumnField.destroy(),delete t.activeEditColumnField)}))},onCellMouseEnter:function(t){var i=this,n=i.widget,r=i.getEventParams(t),l=i.prevCellOver;if(e.nojQuery&&l&&i.fixZeptoBug){if(r.columnIndex===l.columnIndex&&r.side===l.side)return;n.fire("headercellleave",l)}n.fire("headercellenter",r),i.prevCellOver=r},onCellMouseLeave:function(t){var i=this,n=i.widget,r=i.getEventParams(t),l=i.prevCellOver;if(t.toElement&&i.el.within(t.toElement)||(n.fire("headercellleave",l),delete i.prevCellOver),e.nojQuery){if(void 0===l)return;i.fixZeptoBug=r}else n.fire("headercellleave",l),delete i.prevCellOver},getEventParams:function(t){var i=this.widget.store,n=this.getColumns(),r=t.currentTarget,l=e.get(t.currentTarget);if(void 0===l.parent().dom)return!1;if(0===i.getLength())return!1;if(void 0===l.attr("index"))return!1;var o=parseInt(l.attr("index")),s=n[o];return{e:t,side:this.side,cell:r,column:s,columnIndex:o}},updateLImages:function(){var t=this.getCells(),i=this.getColumns();t.each(function(t){var n=t.attr("index"),r=i[n],s=r.headerLImageCls,a=t.select("."+l),d=a.getCls();e.each(d,function(e){e!==l&&(s&&e===r.headerLImageCls||a.removeCls(e))}),s?(a.addCls(s),t.addCls(o)):t.removeCls(o)})},getCells:function(){return this.el.select("."+i+":not(."+h+")")},onColumnDrag:function(){this.reSetIndexes()}})}();